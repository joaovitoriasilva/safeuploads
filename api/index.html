
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="..">
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.22">
    
    
      
        <title>API - safeuploads documentation</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.84d31ad4.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#api-reference" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="safeuploads documentation" class="md-header__button md-logo" aria-label="safeuploads documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            safeuploads documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              API
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
    
      <div class="md-header__source">
        <a href="https://github.com/joaovitoriasilva/safeuploads" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="safeuploads documentation" class="md-nav__button md-logo" aria-label="safeuploads documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    safeuploads documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/joaovitoriasilva/safeuploads" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    API
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    API
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#safeuploads" class="md-nav__link">
    <span class="md-ellipsis">
      safeuploads
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#safeuploads.BaseValidator" class="md-nav__link">
    <span class="md-ellipsis">
      BaseValidator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="BaseValidator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#safeuploads.BaseValidator.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#safeuploads.BaseValidator.validate" class="md-nav__link">
    <span class="md-ellipsis">
      validate
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#safeuploads.CompoundExtensionCategory" class="md-nav__link">
    <span class="md-ellipsis">
      CompoundExtensionCategory
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#safeuploads.CompressionSecurityError" class="md-nav__link">
    <span class="md-ellipsis">
      CompressionSecurityError
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#safeuploads.CompressionSecurityValidator" class="md-nav__link">
    <span class="md-ellipsis">
      CompressionSecurityValidator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CompressionSecurityValidator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#safeuploads.CompressionSecurityValidator.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#safeuploads.CompressionSecurityValidator.validate" class="md-nav__link">
    <span class="md-ellipsis">
      validate
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#safeuploads.CompressionSecurityValidator.validate_zip_compression_ratio" class="md-nav__link">
    <span class="md-ellipsis">
      validate_zip_compression_ratio
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#safeuploads.ConfigValidationError" class="md-nav__link">
    <span class="md-ellipsis">
      ConfigValidationError
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#safeuploads.DangerousExtensionCategory" class="md-nav__link">
    <span class="md-ellipsis">
      DangerousExtensionCategory
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#safeuploads.ErrorCode" class="md-nav__link">
    <span class="md-ellipsis">
      ErrorCode
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#safeuploads.ExtensionSecurityError" class="md-nav__link">
    <span class="md-ellipsis">
      ExtensionSecurityError
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#safeuploads.ExtensionSecurityValidator" class="md-nav__link">
    <span class="md-ellipsis">
      ExtensionSecurityValidator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ExtensionSecurityValidator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#safeuploads.ExtensionSecurityValidator.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#safeuploads.ExtensionSecurityValidator.validate" class="md-nav__link">
    <span class="md-ellipsis">
      validate
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#safeuploads.ExtensionSecurityValidator.validate_extensions" class="md-nav__link">
    <span class="md-ellipsis">
      validate_extensions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#safeuploads.FileProcessingError" class="md-nav__link">
    <span class="md-ellipsis">
      FileProcessingError
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#safeuploads.FileSecurityConfig" class="md-nav__link">
    <span class="md-ellipsis">
      FileSecurityConfig
    </span>
  </a>
  
    <nav class="md-nav" aria-label="FileSecurityConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#safeuploads.FileSecurityConfig.__init_subclass__" class="md-nav__link">
    <span class="md-ellipsis">
      __init_subclass__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#safeuploads.FileSecurityConfig.get_compound_extensions_by_category" class="md-nav__link">
    <span class="md-ellipsis">
      get_compound_extensions_by_category
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#safeuploads.FileSecurityConfig.get_extension_category" class="md-nav__link">
    <span class="md-ellipsis">
      get_extension_category
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#safeuploads.FileSecurityConfig.get_extensions_by_category" class="md-nav__link">
    <span class="md-ellipsis">
      get_extensions_by_category
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#safeuploads.FileSecurityConfig.get_unicode_chars_by_category" class="md-nav__link">
    <span class="md-ellipsis">
      get_unicode_chars_by_category
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#safeuploads.FileSecurityConfig.is_extension_in_category" class="md-nav__link">
    <span class="md-ellipsis">
      is_extension_in_category
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#safeuploads.FileSecurityConfig.validate_and_report" class="md-nav__link">
    <span class="md-ellipsis">
      validate_and_report
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#safeuploads.FileSecurityConfig.validate_configuration" class="md-nav__link">
    <span class="md-ellipsis">
      validate_configuration
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#safeuploads.FileSecurityConfigurationError" class="md-nav__link">
    <span class="md-ellipsis">
      FileSecurityConfigurationError
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#safeuploads.FileSecurityError" class="md-nav__link">
    <span class="md-ellipsis">
      FileSecurityError
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#safeuploads.FileSignatureError" class="md-nav__link">
    <span class="md-ellipsis">
      FileSignatureError
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#safeuploads.FileSizeError" class="md-nav__link">
    <span class="md-ellipsis">
      FileSizeError
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#safeuploads.FileValidationError" class="md-nav__link">
    <span class="md-ellipsis">
      FileValidationError
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#safeuploads.FileValidator" class="md-nav__link">
    <span class="md-ellipsis">
      FileValidator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="FileValidator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#safeuploads.FileValidator.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#safeuploads.FileValidator.validate_image_file" class="md-nav__link">
    <span class="md-ellipsis">
      validate_image_file
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#safeuploads.FileValidator.validate_zip_file" class="md-nav__link">
    <span class="md-ellipsis">
      validate_zip_file
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#safeuploads.FilenameSecurityError" class="md-nav__link">
    <span class="md-ellipsis">
      FilenameSecurityError
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#safeuploads.MimeTypeError" class="md-nav__link">
    <span class="md-ellipsis">
      MimeTypeError
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#safeuploads.SecurityLimits" class="md-nav__link">
    <span class="md-ellipsis">
      SecurityLimits
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#safeuploads.SuspiciousFilePattern" class="md-nav__link">
    <span class="md-ellipsis">
      SuspiciousFilePattern
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#safeuploads.UnicodeAttackCategory" class="md-nav__link">
    <span class="md-ellipsis">
      UnicodeAttackCategory
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#safeuploads.UnicodeSecurityError" class="md-nav__link">
    <span class="md-ellipsis">
      UnicodeSecurityError
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#safeuploads.UnicodeSecurityValidator" class="md-nav__link">
    <span class="md-ellipsis">
      UnicodeSecurityValidator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="UnicodeSecurityValidator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#safeuploads.UnicodeSecurityValidator.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#safeuploads.UnicodeSecurityValidator.validate" class="md-nav__link">
    <span class="md-ellipsis">
      validate
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#safeuploads.UnicodeSecurityValidator.validate_unicode_security" class="md-nav__link">
    <span class="md-ellipsis">
      validate_unicode_security
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#safeuploads.WindowsReservedNameError" class="md-nav__link">
    <span class="md-ellipsis">
      WindowsReservedNameError
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#safeuploads.WindowsSecurityValidator" class="md-nav__link">
    <span class="md-ellipsis">
      WindowsSecurityValidator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="WindowsSecurityValidator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#safeuploads.WindowsSecurityValidator.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#safeuploads.WindowsSecurityValidator.validate" class="md-nav__link">
    <span class="md-ellipsis">
      validate
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#safeuploads.WindowsSecurityValidator.validate_windows_reserved_names" class="md-nav__link">
    <span class="md-ellipsis">
      validate_windows_reserved_names
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#safeuploads.ZipBombError" class="md-nav__link">
    <span class="md-ellipsis">
      ZipBombError
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#safeuploads.ZipContentError" class="md-nav__link">
    <span class="md-ellipsis">
      ZipContentError
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#safeuploads.ZipContentInspector" class="md-nav__link">
    <span class="md-ellipsis">
      ZipContentInspector
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ZipContentInspector">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#safeuploads.ZipContentInspector.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#safeuploads.ZipContentInspector.inspect_zip_content" class="md-nav__link">
    <span class="md-ellipsis">
      inspect_zip_content
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#safeuploads.ZipThreatCategory" class="md-nav__link">
    <span class="md-ellipsis">
      ZipThreatCategory
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#safeuploads" class="md-nav__link">
    <span class="md-ellipsis">
      safeuploads
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#safeuploads.BaseValidator" class="md-nav__link">
    <span class="md-ellipsis">
      BaseValidator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="BaseValidator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#safeuploads.BaseValidator.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#safeuploads.BaseValidator.validate" class="md-nav__link">
    <span class="md-ellipsis">
      validate
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#safeuploads.CompoundExtensionCategory" class="md-nav__link">
    <span class="md-ellipsis">
      CompoundExtensionCategory
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#safeuploads.CompressionSecurityError" class="md-nav__link">
    <span class="md-ellipsis">
      CompressionSecurityError
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#safeuploads.CompressionSecurityValidator" class="md-nav__link">
    <span class="md-ellipsis">
      CompressionSecurityValidator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CompressionSecurityValidator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#safeuploads.CompressionSecurityValidator.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#safeuploads.CompressionSecurityValidator.validate" class="md-nav__link">
    <span class="md-ellipsis">
      validate
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#safeuploads.CompressionSecurityValidator.validate_zip_compression_ratio" class="md-nav__link">
    <span class="md-ellipsis">
      validate_zip_compression_ratio
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#safeuploads.ConfigValidationError" class="md-nav__link">
    <span class="md-ellipsis">
      ConfigValidationError
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#safeuploads.DangerousExtensionCategory" class="md-nav__link">
    <span class="md-ellipsis">
      DangerousExtensionCategory
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#safeuploads.ErrorCode" class="md-nav__link">
    <span class="md-ellipsis">
      ErrorCode
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#safeuploads.ExtensionSecurityError" class="md-nav__link">
    <span class="md-ellipsis">
      ExtensionSecurityError
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#safeuploads.ExtensionSecurityValidator" class="md-nav__link">
    <span class="md-ellipsis">
      ExtensionSecurityValidator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ExtensionSecurityValidator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#safeuploads.ExtensionSecurityValidator.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#safeuploads.ExtensionSecurityValidator.validate" class="md-nav__link">
    <span class="md-ellipsis">
      validate
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#safeuploads.ExtensionSecurityValidator.validate_extensions" class="md-nav__link">
    <span class="md-ellipsis">
      validate_extensions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#safeuploads.FileProcessingError" class="md-nav__link">
    <span class="md-ellipsis">
      FileProcessingError
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#safeuploads.FileSecurityConfig" class="md-nav__link">
    <span class="md-ellipsis">
      FileSecurityConfig
    </span>
  </a>
  
    <nav class="md-nav" aria-label="FileSecurityConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#safeuploads.FileSecurityConfig.__init_subclass__" class="md-nav__link">
    <span class="md-ellipsis">
      __init_subclass__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#safeuploads.FileSecurityConfig.get_compound_extensions_by_category" class="md-nav__link">
    <span class="md-ellipsis">
      get_compound_extensions_by_category
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#safeuploads.FileSecurityConfig.get_extension_category" class="md-nav__link">
    <span class="md-ellipsis">
      get_extension_category
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#safeuploads.FileSecurityConfig.get_extensions_by_category" class="md-nav__link">
    <span class="md-ellipsis">
      get_extensions_by_category
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#safeuploads.FileSecurityConfig.get_unicode_chars_by_category" class="md-nav__link">
    <span class="md-ellipsis">
      get_unicode_chars_by_category
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#safeuploads.FileSecurityConfig.is_extension_in_category" class="md-nav__link">
    <span class="md-ellipsis">
      is_extension_in_category
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#safeuploads.FileSecurityConfig.validate_and_report" class="md-nav__link">
    <span class="md-ellipsis">
      validate_and_report
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#safeuploads.FileSecurityConfig.validate_configuration" class="md-nav__link">
    <span class="md-ellipsis">
      validate_configuration
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#safeuploads.FileSecurityConfigurationError" class="md-nav__link">
    <span class="md-ellipsis">
      FileSecurityConfigurationError
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#safeuploads.FileSecurityError" class="md-nav__link">
    <span class="md-ellipsis">
      FileSecurityError
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#safeuploads.FileSignatureError" class="md-nav__link">
    <span class="md-ellipsis">
      FileSignatureError
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#safeuploads.FileSizeError" class="md-nav__link">
    <span class="md-ellipsis">
      FileSizeError
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#safeuploads.FileValidationError" class="md-nav__link">
    <span class="md-ellipsis">
      FileValidationError
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#safeuploads.FileValidator" class="md-nav__link">
    <span class="md-ellipsis">
      FileValidator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="FileValidator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#safeuploads.FileValidator.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#safeuploads.FileValidator.validate_image_file" class="md-nav__link">
    <span class="md-ellipsis">
      validate_image_file
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#safeuploads.FileValidator.validate_zip_file" class="md-nav__link">
    <span class="md-ellipsis">
      validate_zip_file
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#safeuploads.FilenameSecurityError" class="md-nav__link">
    <span class="md-ellipsis">
      FilenameSecurityError
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#safeuploads.MimeTypeError" class="md-nav__link">
    <span class="md-ellipsis">
      MimeTypeError
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#safeuploads.SecurityLimits" class="md-nav__link">
    <span class="md-ellipsis">
      SecurityLimits
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#safeuploads.SuspiciousFilePattern" class="md-nav__link">
    <span class="md-ellipsis">
      SuspiciousFilePattern
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#safeuploads.UnicodeAttackCategory" class="md-nav__link">
    <span class="md-ellipsis">
      UnicodeAttackCategory
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#safeuploads.UnicodeSecurityError" class="md-nav__link">
    <span class="md-ellipsis">
      UnicodeSecurityError
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#safeuploads.UnicodeSecurityValidator" class="md-nav__link">
    <span class="md-ellipsis">
      UnicodeSecurityValidator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="UnicodeSecurityValidator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#safeuploads.UnicodeSecurityValidator.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#safeuploads.UnicodeSecurityValidator.validate" class="md-nav__link">
    <span class="md-ellipsis">
      validate
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#safeuploads.UnicodeSecurityValidator.validate_unicode_security" class="md-nav__link">
    <span class="md-ellipsis">
      validate_unicode_security
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#safeuploads.WindowsReservedNameError" class="md-nav__link">
    <span class="md-ellipsis">
      WindowsReservedNameError
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#safeuploads.WindowsSecurityValidator" class="md-nav__link">
    <span class="md-ellipsis">
      WindowsSecurityValidator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="WindowsSecurityValidator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#safeuploads.WindowsSecurityValidator.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#safeuploads.WindowsSecurityValidator.validate" class="md-nav__link">
    <span class="md-ellipsis">
      validate
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#safeuploads.WindowsSecurityValidator.validate_windows_reserved_names" class="md-nav__link">
    <span class="md-ellipsis">
      validate_windows_reserved_names
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#safeuploads.ZipBombError" class="md-nav__link">
    <span class="md-ellipsis">
      ZipBombError
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#safeuploads.ZipContentError" class="md-nav__link">
    <span class="md-ellipsis">
      ZipContentError
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#safeuploads.ZipContentInspector" class="md-nav__link">
    <span class="md-ellipsis">
      ZipContentInspector
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ZipContentInspector">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#safeuploads.ZipContentInspector.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#safeuploads.ZipContentInspector.inspect_zip_content" class="md-nav__link">
    <span class="md-ellipsis">
      inspect_zip_content
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#safeuploads.ZipThreatCategory" class="md-nav__link">
    <span class="md-ellipsis">
      ZipThreatCategory
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="api-reference">API Reference</h1>


<div class="doc doc-object doc-module">



<a id="safeuploads"></a>
    <div class="doc doc-contents first">

        <p>File Security Module</p>
<p>A comprehensive file security system for validating uploads and preventing attacks.</p>










  <div class="doc doc-children">









<div class="doc doc-object doc-class">



<h2 id="safeuploads.BaseValidator" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">BaseValidator</span>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="abc.ABC">ABC</span></code></p>


        <p>Abstract base class for file security validators.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="safeuploads.BaseValidator.config">config</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>File security configuration parameters.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="quote">
                <summary>Source code in <code>safeuploads/validators/base.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">BaseValidator</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Abstract base class for file security validators.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        config: File security configuration parameters.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">FileSecurityConfig</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize validator with configuration.</span>

<span class="sd">        Args:</span>
<span class="sd">            config: File security settings to apply.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">config</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validate data using subclass-specific logic.</span>

<span class="sd">        Args:</span>
<span class="sd">            *args: Positional arguments for concrete validator.</span>
<span class="sd">            **kwargs: Keyword arguments for concrete validator.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Validated result defined by subclass.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="safeuploads.BaseValidator.__init__" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">__init__</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">__init__</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Initialize validator with configuration.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>config</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="FileSecurityConfig (safeuploads.config.FileSecurityConfig)" href="#safeuploads.FileSecurityConfig">FileSecurityConfig</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>File security settings to apply.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>safeuploads/validators/base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">FileSecurityConfig</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Initialize validator with configuration.</span>

<span class="sd">    Args:</span>
<span class="sd">        config: File security settings to apply.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">config</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="safeuploads.BaseValidator.validate" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">validate</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">validate</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Validate data using subclass-specific logic.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>*args</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Positional arguments for concrete validator.</p>
              </div>
            </td>
            <td>
                  <code>()</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>**kwargs</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Keyword arguments for concrete validator.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Validated result defined by subclass.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>safeuploads/validators/base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@abstractmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validate data using subclass-specific logic.</span>

<span class="sd">    Args:</span>
<span class="sd">        *args: Positional arguments for concrete validator.</span>
<span class="sd">        **kwargs: Keyword arguments for concrete validator.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Validated result defined by subclass.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="safeuploads.CompoundExtensionCategory" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">CompoundExtensionCategory</span>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="enum.Enum">Enum</span></code></p>


        <p>Categorized compound file extensions that combine multiple suffixes.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="safeuploads.CompoundExtensionCategory.COMPRESSED_ARCHIVES">COMPRESSED_ARCHIVES</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Multi-part archive formats.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="safeuploads.CompoundExtensionCategory.JAVASCRIPT_VARIANTS">JAVASCRIPT_VARIANTS</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Specialized JavaScript files.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="safeuploads.CompoundExtensionCategory.WEB_CONTENT">WEB_CONTENT</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Minified static web assets.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="quote">
                <summary>Source code in <code>safeuploads/enums.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">CompoundExtensionCategory</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Categorized compound file extensions that combine multiple suffixes.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        COMPRESSED_ARCHIVES: Multi-part archive formats.</span>
<span class="sd">        JAVASCRIPT_VARIANTS: Specialized JavaScript files.</span>
<span class="sd">        WEB_CONTENT: Minified static web assets.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Compressed archive formats</span>
    <span class="n">COMPRESSED_ARCHIVES</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;.tar.xz&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.tar.gz&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.tar.bz2&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.tar.lz&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.tar.lzma&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.tar.Z&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.tgz&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.tbz2&quot;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="c1"># JavaScript related compound extensions</span>
    <span class="n">JAVASCRIPT_VARIANTS</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;.user.js&quot;</span><span class="p">,</span> <span class="s2">&quot;.backup.js&quot;</span><span class="p">,</span> <span class="s2">&quot;.min.js&quot;</span><span class="p">,</span> <span class="s2">&quot;.worker.js&quot;</span><span class="p">}</span>

    <span class="c1"># Web content compound extensions</span>
    <span class="n">WEB_CONTENT</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;.min.css&quot;</span><span class="p">,</span> <span class="s2">&quot;.min.html&quot;</span><span class="p">}</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="safeuploads.CompressionSecurityError" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">CompressionSecurityError</span>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="FileValidationError (safeuploads.exceptions.FileValidationError)" href="#safeuploads.FileValidationError">FileValidationError</a></code></p>


        <p>Compressed file security check failed.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>message</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Human-readable error description.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>filename</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional filename of compressed file.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>error_code</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional error code (defaults to
COMPRESSION_GENERIC).</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="quote">
                <summary>Source code in <code>safeuploads/exceptions.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">CompressionSecurityError</span><span class="p">(</span><span class="n">FileValidationError</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compressed file security check failed.</span>

<span class="sd">    Args:</span>
<span class="sd">        message: Human-readable error description.</span>
<span class="sd">        filename: Optional filename of compressed file.</span>
<span class="sd">        error_code: Optional error code (defaults to</span>
<span class="sd">            COMPRESSION_GENERIC).</span>

<span class="sd">    Attributes:</span>
<span class="sd">        None beyond inherited FileValidationError attributes.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="safeuploads.CompressionSecurityValidator" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">CompressionSecurityValidator</span>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="BaseValidator (safeuploads.validators.base.BaseValidator)" href="#safeuploads.BaseValidator">BaseValidator</a></code></p>


        <p>Validates ZIP uploads against zip bombs and compression attacks.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="safeuploads.CompressionSecurityValidator.config">config</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Security configuration for validation limits.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="quote">
                <summary>Source code in <code>safeuploads/validators/compression_validator.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">CompressionSecurityValidator</span><span class="p">(</span><span class="n">BaseValidator</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validates ZIP uploads against zip bombs and compression attacks.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        config: Security configuration for validation limits.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">FileSecurityConfig</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize the compression validator.</span>

<span class="sd">        Args:</span>
<span class="sd">            config: Security configuration with compression limits.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">validate_zip_compression_ratio</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">file_content</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">compressed_size</span><span class="p">:</span> <span class="nb">int</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validate ZIP archive against security limits.</span>

<span class="sd">        Args:</span>
<span class="sd">            file_content: Raw bytes of the ZIP archive.</span>
<span class="sd">            compressed_size: Size of the compressed archive in bytes.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ZipBombError: If compression ratio exceeds maximum allowed</span>
<span class="sd">                or total uncompressed size is too large.</span>
<span class="sd">            CompressionSecurityError: If ZIP structure is invalid, too</span>
<span class="sd">                many entries, nested archives detected, or individual</span>
<span class="sd">                file too large.</span>
<span class="sd">            FileProcessingError: If unexpected error occurs during</span>
<span class="sd">                validation such as memory errors or I/O errors.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Create a BytesIO object from file content for zipfile analysis</span>
            <span class="n">zip_bytes</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">file_content</span><span class="p">)</span>

            <span class="c1"># Track analysis metrics</span>
            <span class="n">total_uncompressed_size</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">total_compressed_size</span> <span class="o">=</span> <span class="n">compressed_size</span>
            <span class="n">file_count</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">nested_archives</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">max_compression_ratio</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">overall_compression_ratio</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Initialize to avoid unbound variable</span>

            <span class="c1"># Analyze ZIP file structure with timeout protection</span>
            <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

            <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">zip_bytes</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zip_file</span><span class="p">:</span>
                <span class="c1"># Check for excessive number of files</span>
                <span class="n">zip_entries</span> <span class="o">=</span> <span class="n">zip_file</span><span class="o">.</span><span class="n">infolist</span><span class="p">()</span>
                <span class="n">file_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">zip_entries</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">file_count</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">limits</span><span class="o">.</span><span class="n">max_zip_entries</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                        <span class="s2">&quot;ZIP contains too many files&quot;</span><span class="p">,</span>
                        <span class="n">extra</span><span class="o">=</span><span class="p">{</span>
                            <span class="s2">&quot;error_type&quot;</span><span class="p">:</span> <span class="s2">&quot;zip_too_many_entries&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;file_count&quot;</span><span class="p">:</span> <span class="n">file_count</span><span class="p">,</span>
                            <span class="s2">&quot;max_entries&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">limits</span><span class="o">.</span><span class="n">max_zip_entries</span><span class="p">,</span>
                        <span class="p">},</span>
                    <span class="p">)</span>
                    <span class="k">raise</span> <span class="n">CompressionSecurityError</span><span class="p">(</span>
                        <span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;ZIP contains too many files: </span><span class="si">{</span><span class="n">file_count</span><span class="si">}</span><span class="s2">. &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;Maximum allowed: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">limits</span><span class="o">.</span><span class="n">max_zip_entries</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                        <span class="n">error_code</span><span class="o">=</span><span class="n">ErrorCode</span><span class="o">.</span><span class="n">ZIP_TOO_MANY_ENTRIES</span><span class="p">,</span>
                    <span class="p">)</span>

                <span class="c1"># Analyze each entry in the ZIP</span>
                <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">zip_entries</span><span class="p">:</span>
                    <span class="c1"># Check for timeout</span>
                    <span class="k">if</span> <span class="p">(</span>
                        <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>
                        <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">limits</span><span class="o">.</span><span class="n">zip_analysis_timeout</span>
                    <span class="p">):</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                            <span class="s2">&quot;ZIP analysis timeout&quot;</span><span class="p">,</span>
                            <span class="n">extra</span><span class="o">=</span><span class="p">{</span>
                                <span class="s2">&quot;error_type&quot;</span><span class="p">:</span> <span class="s2">&quot;zip_analysis_timeout&quot;</span><span class="p">,</span>
                                <span class="s2">&quot;timeout&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">limits</span><span class="o">.</span><span class="n">zip_analysis_timeout</span><span class="p">,</span>
                            <span class="p">},</span>
                        <span class="p">)</span>
                        <span class="k">raise</span> <span class="n">ZipBombError</span><span class="p">(</span>
                            <span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;ZIP analysis timeout after </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">limits</span><span class="o">.</span><span class="n">zip_analysis_timeout</span><span class="si">}</span><span class="s2">s - potential zip bomb&quot;</span><span class="p">,</span>
                            <span class="n">compression_ratio</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                        <span class="p">)</span>

                    <span class="c1"># Skip directories</span>
                    <span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">is_dir</span><span class="p">():</span>
                        <span class="k">continue</span>

                    <span class="c1"># Track uncompressed size</span>
                    <span class="n">uncompressed_size</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">file_size</span>
                    <span class="n">compressed_size_entry</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">compress_size</span>
                    <span class="n">total_uncompressed_size</span> <span class="o">+=</span> <span class="n">uncompressed_size</span>

                    <span class="c1"># Check individual file compression ratio</span>
                    <span class="k">if</span> <span class="n">compressed_size_entry</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># Avoid division by zero</span>
                        <span class="n">compression_ratio</span> <span class="o">=</span> <span class="n">uncompressed_size</span> <span class="o">/</span> <span class="n">compressed_size_entry</span>
                        <span class="n">max_compression_ratio</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span>
                            <span class="n">max_compression_ratio</span><span class="p">,</span> <span class="n">compression_ratio</span>
                        <span class="p">)</span>

                        <span class="k">if</span> <span class="n">compression_ratio</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">limits</span><span class="o">.</span><span class="n">max_compression_ratio</span><span class="p">:</span>
                            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                                <span class="s2">&quot;Excessive compression ratio detected&quot;</span><span class="p">,</span>
                                <span class="n">extra</span><span class="o">=</span><span class="p">{</span>
                                    <span class="s2">&quot;error_type&quot;</span><span class="p">:</span> <span class="s2">&quot;compression_ratio_exceeded&quot;</span><span class="p">,</span>
                                    <span class="s2">&quot;file_name&quot;</span><span class="p">:</span> <span class="n">entry</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span>
                                    <span class="s2">&quot;compression_ratio&quot;</span><span class="p">:</span> <span class="n">compression_ratio</span><span class="p">,</span>
                                    <span class="s2">&quot;max_ratio&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">limits</span><span class="o">.</span><span class="n">max_compression_ratio</span><span class="p">,</span>
                                <span class="p">},</span>
                            <span class="p">)</span>
                            <span class="k">raise</span> <span class="n">ZipBombError</span><span class="p">(</span>
                                <span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Excessive compression ratio detected: </span><span class="si">{</span><span class="n">compression_ratio</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">:1 for &#39;</span><span class="si">{</span><span class="n">entry</span><span class="o">.</span><span class="n">filename</span><span class="si">}</span><span class="s2">&#39;. &quot;</span>
                                <span class="sa">f</span><span class="s2">&quot;Maximum allowed: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">limits</span><span class="o">.</span><span class="n">max_compression_ratio</span><span class="si">}</span><span class="s2">:1&quot;</span><span class="p">,</span>
                                <span class="n">compression_ratio</span><span class="o">=</span><span class="n">compression_ratio</span><span class="p">,</span>
                            <span class="p">)</span>

                    <span class="c1"># Check for nested archive files</span>
                    <span class="n">filename_lower</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">filename</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span>
                        <span class="n">filename_lower</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">ext</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">ext</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;.zip&quot;</span><span class="p">,</span> <span class="s2">&quot;.rar&quot;</span><span class="p">,</span> <span class="s2">&quot;.7z&quot;</span><span class="p">,</span> <span class="s2">&quot;.tar&quot;</span><span class="p">,</span> <span class="s2">&quot;.gz&quot;</span><span class="p">,</span> <span class="s2">&quot;.bz2&quot;</span><span class="p">]</span>
                    <span class="p">):</span>
                        <span class="n">nested_archives</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>

                    <span class="c1"># Check for excessively large individual files</span>
                    <span class="c1"># Use the configurable max_individual_file_size limit</span>
                    <span class="k">if</span> <span class="n">uncompressed_size</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">limits</span><span class="o">.</span><span class="n">max_individual_file_size</span><span class="p">:</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                            <span class="s2">&quot;Individual file too large&quot;</span><span class="p">,</span>
                            <span class="n">extra</span><span class="o">=</span><span class="p">{</span>
                                <span class="s2">&quot;error_type&quot;</span><span class="p">:</span> <span class="s2">&quot;file_too_large&quot;</span><span class="p">,</span>
                                <span class="s2">&quot;file_name&quot;</span><span class="p">:</span> <span class="n">entry</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span>
                                <span class="s2">&quot;size_mb&quot;</span><span class="p">:</span> <span class="n">uncompressed_size</span> <span class="o">//</span> <span class="p">(</span><span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">),</span>
                                <span class="s2">&quot;max_size_mb&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">limits</span><span class="o">.</span><span class="n">max_individual_file_size</span>
                                <span class="o">//</span> <span class="p">(</span><span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">),</span>
                            <span class="p">},</span>
                        <span class="p">)</span>
                        <span class="k">raise</span> <span class="n">CompressionSecurityError</span><span class="p">(</span>
                            <span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Individual file too large: &#39;</span><span class="si">{</span><span class="n">entry</span><span class="o">.</span><span class="n">filename</span><span class="si">}</span><span class="s2">&#39; would expand to </span><span class="si">{</span><span class="n">uncompressed_size</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="p">(</span><span class="mi">1024</span><span class="o">*</span><span class="mi">1024</span><span class="p">)</span><span class="si">}</span><span class="s2">MB. &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;Maximum allowed: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">limits</span><span class="o">.</span><span class="n">max_individual_file_size</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="p">(</span><span class="mi">1024</span><span class="o">*</span><span class="mi">1024</span><span class="p">)</span><span class="si">}</span><span class="s2">MB&quot;</span><span class="p">,</span>
                            <span class="n">error_code</span><span class="o">=</span><span class="n">ErrorCode</span><span class="o">.</span><span class="n">FILE_TOO_LARGE</span><span class="p">,</span>
                        <span class="p">)</span>

                <span class="c1"># Check total uncompressed size</span>
                <span class="k">if</span> <span class="n">total_uncompressed_size</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">limits</span><span class="o">.</span><span class="n">max_uncompressed_size</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                        <span class="s2">&quot;Total uncompressed size too large&quot;</span><span class="p">,</span>
                        <span class="n">extra</span><span class="o">=</span><span class="p">{</span>
                            <span class="s2">&quot;error_type&quot;</span><span class="p">:</span> <span class="s2">&quot;zip_too_large&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;total_size_mb&quot;</span><span class="p">:</span> <span class="n">total_uncompressed_size</span> <span class="o">//</span> <span class="p">(</span><span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">),</span>
                            <span class="s2">&quot;max_size_mb&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">limits</span><span class="o">.</span><span class="n">max_uncompressed_size</span>
                            <span class="o">//</span> <span class="p">(</span><span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">),</span>
                        <span class="p">},</span>
                    <span class="p">)</span>
                    <span class="k">raise</span> <span class="n">ZipBombError</span><span class="p">(</span>
                        <span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Total uncompressed size too large: </span><span class="si">{</span><span class="n">total_uncompressed_size</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="p">(</span><span class="mi">1024</span><span class="o">*</span><span class="mi">1024</span><span class="p">)</span><span class="si">}</span><span class="s2">MB. &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;Maximum allowed: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">limits</span><span class="o">.</span><span class="n">max_uncompressed_size</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="p">(</span><span class="mi">1024</span><span class="o">*</span><span class="mi">1024</span><span class="p">)</span><span class="si">}</span><span class="s2">MB&quot;</span><span class="p">,</span>
                        <span class="n">compression_ratio</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                        <span class="n">uncompressed_size</span><span class="o">=</span><span class="n">total_uncompressed_size</span><span class="p">,</span>
                        <span class="n">max_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">limits</span><span class="o">.</span><span class="n">max_uncompressed_size</span><span class="p">,</span>
                    <span class="p">)</span>

                <span class="c1"># Check overall compression ratio</span>
                <span class="k">if</span> <span class="n">total_compressed_size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">overall_compression_ratio</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="n">total_uncompressed_size</span> <span class="o">/</span> <span class="n">total_compressed_size</span>
                    <span class="p">)</span>
                    <span class="k">if</span> <span class="p">(</span>
                        <span class="n">overall_compression_ratio</span>
                        <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">limits</span><span class="o">.</span><span class="n">max_compression_ratio</span>
                    <span class="p">):</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                            <span class="s2">&quot;Overall compression ratio too high&quot;</span><span class="p">,</span>
                            <span class="n">extra</span><span class="o">=</span><span class="p">{</span>
                                <span class="s2">&quot;error_type&quot;</span><span class="p">:</span> <span class="s2">&quot;compression_ratio_exceeded&quot;</span><span class="p">,</span>
                                <span class="s2">&quot;overall_ratio&quot;</span><span class="p">:</span> <span class="n">overall_compression_ratio</span><span class="p">,</span>
                                <span class="s2">&quot;max_ratio&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">limits</span><span class="o">.</span><span class="n">max_compression_ratio</span><span class="p">,</span>
                            <span class="p">},</span>
                        <span class="p">)</span>
                        <span class="k">raise</span> <span class="n">ZipBombError</span><span class="p">(</span>
                            <span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Overall compression ratio too high: </span><span class="si">{</span><span class="n">overall_compression_ratio</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">:1. &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;Maximum allowed: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">limits</span><span class="o">.</span><span class="n">max_compression_ratio</span><span class="si">}</span><span class="s2">:1&quot;</span><span class="p">,</span>
                            <span class="n">compression_ratio</span><span class="o">=</span><span class="n">overall_compression_ratio</span><span class="p">,</span>
                            <span class="n">max_ratio</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">limits</span><span class="o">.</span><span class="n">max_compression_ratio</span><span class="p">,</span>
                        <span class="p">)</span>

                <span class="c1"># Reject nested archives (potential security risk)</span>
                <span class="k">if</span> <span class="n">nested_archives</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                        <span class="s2">&quot;Nested archives detected&quot;</span><span class="p">,</span>
                        <span class="n">extra</span><span class="o">=</span><span class="p">{</span>
                            <span class="s2">&quot;error_type&quot;</span><span class="p">:</span> <span class="s2">&quot;zip_nested_archive&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;nested_archives&quot;</span><span class="p">:</span> <span class="n">nested_archives</span><span class="p">,</span>
                        <span class="p">},</span>
                    <span class="p">)</span>
                    <span class="k">raise</span> <span class="n">CompressionSecurityError</span><span class="p">(</span>
                        <span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Nested archives are not allowed: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">nested_archives</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                        <span class="n">error_code</span><span class="o">=</span><span class="n">ErrorCode</span><span class="o">.</span><span class="n">ZIP_NESTED_ARCHIVE</span><span class="p">,</span>
                    <span class="p">)</span>

                <span class="c1"># Log analysis results</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                    <span class="s2">&quot;ZIP analysis: </span><span class="si">%s</span><span class="s2"> files, </span><span class="si">%s</span><span class="s2">MB uncompressed, max ratio: </span><span class="si">%.1f</span><span class="s2">:1, overall ratio: </span><span class="si">%.1f</span><span class="s2">:1&quot;</span><span class="p">,</span>
                    <span class="n">file_count</span><span class="p">,</span>
                    <span class="n">total_uncompressed_size</span> <span class="o">//</span> <span class="p">(</span><span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">),</span>
                    <span class="n">max_compression_ratio</span><span class="p">,</span>
                    <span class="n">overall_compression_ratio</span><span class="p">,</span>
                <span class="p">)</span>

        <span class="k">except</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">BadZipFile</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Invalid or corrupted ZIP file&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">CompressionSecurityError</span><span class="p">(</span>
                <span class="n">message</span><span class="o">=</span><span class="s2">&quot;Invalid or corrupted ZIP file&quot;</span><span class="p">,</span>
                <span class="n">error_code</span><span class="o">=</span><span class="n">ErrorCode</span><span class="o">.</span><span class="n">ZIP_CORRUPT</span><span class="p">,</span>
            <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">err</span>
        <span class="k">except</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">LargeZipFile</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;ZIP file too large to process&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">CompressionSecurityError</span><span class="p">(</span>
                <span class="n">message</span><span class="o">=</span><span class="s2">&quot;ZIP file too large to process safely&quot;</span><span class="p">,</span>
                <span class="n">error_code</span><span class="o">=</span><span class="n">ErrorCode</span><span class="o">.</span><span class="n">ZIP_TOO_LARGE</span><span class="p">,</span>
            <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">err</span>
        <span class="k">except</span> <span class="ne">MemoryError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;ZIP requires excessive memory&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">ZipBombError</span><span class="p">(</span>
                <span class="n">message</span><span class="o">=</span><span class="s2">&quot;ZIP file requires too much memory to process - potential zip bomb&quot;</span><span class="p">,</span>
                <span class="n">compression_ratio</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">err</span>
        <span class="k">except</span> <span class="p">(</span><span class="n">ZipBombError</span><span class="p">,</span> <span class="n">CompressionSecurityError</span><span class="p">):</span>
            <span class="c1"># Re-raise our own exceptions</span>
            <span class="k">raise</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                <span class="s2">&quot;Unexpected error during ZIP compression validation&quot;</span><span class="p">,</span>
                <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">raise</span> <span class="n">FileProcessingError</span><span class="p">(</span>
                <span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;ZIP validation failed: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">err</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_content</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">compressed_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validate the compression ratio of a ZIP file.</span>

<span class="sd">        Args:</span>
<span class="sd">            file_content: Raw bytes of the uploaded file.</span>
<span class="sd">            compressed_size: Size of the file after compression in bytes.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ZipBombError: If compression ratio exceeds maximum allowed.</span>
<span class="sd">            CompressionSecurityError: If ZIP structure is invalid.</span>
<span class="sd">            FileProcessingError: If unexpected error occurs.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate_zip_compression_ratio</span><span class="p">(</span><span class="n">file_content</span><span class="p">,</span> <span class="n">compressed_size</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="safeuploads.CompressionSecurityValidator.__init__" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">__init__</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">__init__</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Initialize the compression validator.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>config</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="FileSecurityConfig (safeuploads.config.FileSecurityConfig)" href="#safeuploads.FileSecurityConfig">FileSecurityConfig</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Security configuration with compression limits.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>safeuploads/validators/compression_validator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">FileSecurityConfig</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Initialize the compression validator.</span>

<span class="sd">    Args:</span>
<span class="sd">        config: Security configuration with compression limits.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="safeuploads.CompressionSecurityValidator.validate" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">validate</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">validate</span><span class="p">(</span><span class="n">file_content</span><span class="p">,</span> <span class="n">compressed_size</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Validate the compression ratio of a ZIP file.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>file_content</code>
            </td>
            <td>
                  <code><span title="bytes">bytes</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Raw bytes of the uploaded file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>compressed_size</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Size of the file after compression in bytes.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="ZipBombError (safeuploads.exceptions.ZipBombError)" href="#safeuploads.ZipBombError">ZipBombError</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If compression ratio exceeds maximum allowed.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="CompressionSecurityError (safeuploads.exceptions.CompressionSecurityError)" href="#safeuploads.CompressionSecurityError">CompressionSecurityError</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If ZIP structure is invalid.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="FileProcessingError (safeuploads.exceptions.FileProcessingError)" href="#safeuploads.FileProcessingError">FileProcessingError</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If unexpected error occurs.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>safeuploads/validators/compression_validator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_content</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">compressed_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validate the compression ratio of a ZIP file.</span>

<span class="sd">    Args:</span>
<span class="sd">        file_content: Raw bytes of the uploaded file.</span>
<span class="sd">        compressed_size: Size of the file after compression in bytes.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ZipBombError: If compression ratio exceeds maximum allowed.</span>
<span class="sd">        CompressionSecurityError: If ZIP structure is invalid.</span>
<span class="sd">        FileProcessingError: If unexpected error occurs.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate_zip_compression_ratio</span><span class="p">(</span><span class="n">file_content</span><span class="p">,</span> <span class="n">compressed_size</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="safeuploads.CompressionSecurityValidator.validate_zip_compression_ratio" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">validate_zip_compression_ratio</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">validate_zip_compression_ratio</span><span class="p">(</span><span class="n">file_content</span><span class="p">,</span> <span class="n">compressed_size</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Validate ZIP archive against security limits.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>file_content</code>
            </td>
            <td>
                  <code><span title="bytes">bytes</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Raw bytes of the ZIP archive.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>compressed_size</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Size of the compressed archive in bytes.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="ZipBombError (safeuploads.exceptions.ZipBombError)" href="#safeuploads.ZipBombError">ZipBombError</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If compression ratio exceeds maximum allowed
or total uncompressed size is too large.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="CompressionSecurityError (safeuploads.exceptions.CompressionSecurityError)" href="#safeuploads.CompressionSecurityError">CompressionSecurityError</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If ZIP structure is invalid, too
many entries, nested archives detected, or individual
file too large.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="FileProcessingError (safeuploads.exceptions.FileProcessingError)" href="#safeuploads.FileProcessingError">FileProcessingError</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If unexpected error occurs during
validation such as memory errors or I/O errors.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>safeuploads/validators/compression_validator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">validate_zip_compression_ratio</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">file_content</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">compressed_size</span><span class="p">:</span> <span class="nb">int</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validate ZIP archive against security limits.</span>

<span class="sd">    Args:</span>
<span class="sd">        file_content: Raw bytes of the ZIP archive.</span>
<span class="sd">        compressed_size: Size of the compressed archive in bytes.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ZipBombError: If compression ratio exceeds maximum allowed</span>
<span class="sd">            or total uncompressed size is too large.</span>
<span class="sd">        CompressionSecurityError: If ZIP structure is invalid, too</span>
<span class="sd">            many entries, nested archives detected, or individual</span>
<span class="sd">            file too large.</span>
<span class="sd">        FileProcessingError: If unexpected error occurs during</span>
<span class="sd">            validation such as memory errors or I/O errors.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Create a BytesIO object from file content for zipfile analysis</span>
        <span class="n">zip_bytes</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">file_content</span><span class="p">)</span>

        <span class="c1"># Track analysis metrics</span>
        <span class="n">total_uncompressed_size</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">total_compressed_size</span> <span class="o">=</span> <span class="n">compressed_size</span>
        <span class="n">file_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">nested_archives</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">max_compression_ratio</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">overall_compression_ratio</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Initialize to avoid unbound variable</span>

        <span class="c1"># Analyze ZIP file structure with timeout protection</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

        <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">zip_bytes</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zip_file</span><span class="p">:</span>
            <span class="c1"># Check for excessive number of files</span>
            <span class="n">zip_entries</span> <span class="o">=</span> <span class="n">zip_file</span><span class="o">.</span><span class="n">infolist</span><span class="p">()</span>
            <span class="n">file_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">zip_entries</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">file_count</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">limits</span><span class="o">.</span><span class="n">max_zip_entries</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="s2">&quot;ZIP contains too many files&quot;</span><span class="p">,</span>
                    <span class="n">extra</span><span class="o">=</span><span class="p">{</span>
                        <span class="s2">&quot;error_type&quot;</span><span class="p">:</span> <span class="s2">&quot;zip_too_many_entries&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;file_count&quot;</span><span class="p">:</span> <span class="n">file_count</span><span class="p">,</span>
                        <span class="s2">&quot;max_entries&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">limits</span><span class="o">.</span><span class="n">max_zip_entries</span><span class="p">,</span>
                    <span class="p">},</span>
                <span class="p">)</span>
                <span class="k">raise</span> <span class="n">CompressionSecurityError</span><span class="p">(</span>
                    <span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;ZIP contains too many files: </span><span class="si">{</span><span class="n">file_count</span><span class="si">}</span><span class="s2">. &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;Maximum allowed: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">limits</span><span class="o">.</span><span class="n">max_zip_entries</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="n">error_code</span><span class="o">=</span><span class="n">ErrorCode</span><span class="o">.</span><span class="n">ZIP_TOO_MANY_ENTRIES</span><span class="p">,</span>
                <span class="p">)</span>

            <span class="c1"># Analyze each entry in the ZIP</span>
            <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">zip_entries</span><span class="p">:</span>
                <span class="c1"># Check for timeout</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>
                    <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">limits</span><span class="o">.</span><span class="n">zip_analysis_timeout</span>
                <span class="p">):</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                        <span class="s2">&quot;ZIP analysis timeout&quot;</span><span class="p">,</span>
                        <span class="n">extra</span><span class="o">=</span><span class="p">{</span>
                            <span class="s2">&quot;error_type&quot;</span><span class="p">:</span> <span class="s2">&quot;zip_analysis_timeout&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;timeout&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">limits</span><span class="o">.</span><span class="n">zip_analysis_timeout</span><span class="p">,</span>
                        <span class="p">},</span>
                    <span class="p">)</span>
                    <span class="k">raise</span> <span class="n">ZipBombError</span><span class="p">(</span>
                        <span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;ZIP analysis timeout after </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">limits</span><span class="o">.</span><span class="n">zip_analysis_timeout</span><span class="si">}</span><span class="s2">s - potential zip bomb&quot;</span><span class="p">,</span>
                        <span class="n">compression_ratio</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                    <span class="p">)</span>

                <span class="c1"># Skip directories</span>
                <span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">is_dir</span><span class="p">():</span>
                    <span class="k">continue</span>

                <span class="c1"># Track uncompressed size</span>
                <span class="n">uncompressed_size</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">file_size</span>
                <span class="n">compressed_size_entry</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">compress_size</span>
                <span class="n">total_uncompressed_size</span> <span class="o">+=</span> <span class="n">uncompressed_size</span>

                <span class="c1"># Check individual file compression ratio</span>
                <span class="k">if</span> <span class="n">compressed_size_entry</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># Avoid division by zero</span>
                    <span class="n">compression_ratio</span> <span class="o">=</span> <span class="n">uncompressed_size</span> <span class="o">/</span> <span class="n">compressed_size_entry</span>
                    <span class="n">max_compression_ratio</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span>
                        <span class="n">max_compression_ratio</span><span class="p">,</span> <span class="n">compression_ratio</span>
                    <span class="p">)</span>

                    <span class="k">if</span> <span class="n">compression_ratio</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">limits</span><span class="o">.</span><span class="n">max_compression_ratio</span><span class="p">:</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                            <span class="s2">&quot;Excessive compression ratio detected&quot;</span><span class="p">,</span>
                            <span class="n">extra</span><span class="o">=</span><span class="p">{</span>
                                <span class="s2">&quot;error_type&quot;</span><span class="p">:</span> <span class="s2">&quot;compression_ratio_exceeded&quot;</span><span class="p">,</span>
                                <span class="s2">&quot;file_name&quot;</span><span class="p">:</span> <span class="n">entry</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span>
                                <span class="s2">&quot;compression_ratio&quot;</span><span class="p">:</span> <span class="n">compression_ratio</span><span class="p">,</span>
                                <span class="s2">&quot;max_ratio&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">limits</span><span class="o">.</span><span class="n">max_compression_ratio</span><span class="p">,</span>
                            <span class="p">},</span>
                        <span class="p">)</span>
                        <span class="k">raise</span> <span class="n">ZipBombError</span><span class="p">(</span>
                            <span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Excessive compression ratio detected: </span><span class="si">{</span><span class="n">compression_ratio</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">:1 for &#39;</span><span class="si">{</span><span class="n">entry</span><span class="o">.</span><span class="n">filename</span><span class="si">}</span><span class="s2">&#39;. &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;Maximum allowed: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">limits</span><span class="o">.</span><span class="n">max_compression_ratio</span><span class="si">}</span><span class="s2">:1&quot;</span><span class="p">,</span>
                            <span class="n">compression_ratio</span><span class="o">=</span><span class="n">compression_ratio</span><span class="p">,</span>
                        <span class="p">)</span>

                <span class="c1"># Check for nested archive files</span>
                <span class="n">filename_lower</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">filename</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                <span class="k">if</span> <span class="nb">any</span><span class="p">(</span>
                    <span class="n">filename_lower</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">ext</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">ext</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;.zip&quot;</span><span class="p">,</span> <span class="s2">&quot;.rar&quot;</span><span class="p">,</span> <span class="s2">&quot;.7z&quot;</span><span class="p">,</span> <span class="s2">&quot;.tar&quot;</span><span class="p">,</span> <span class="s2">&quot;.gz&quot;</span><span class="p">,</span> <span class="s2">&quot;.bz2&quot;</span><span class="p">]</span>
                <span class="p">):</span>
                    <span class="n">nested_archives</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>

                <span class="c1"># Check for excessively large individual files</span>
                <span class="c1"># Use the configurable max_individual_file_size limit</span>
                <span class="k">if</span> <span class="n">uncompressed_size</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">limits</span><span class="o">.</span><span class="n">max_individual_file_size</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                        <span class="s2">&quot;Individual file too large&quot;</span><span class="p">,</span>
                        <span class="n">extra</span><span class="o">=</span><span class="p">{</span>
                            <span class="s2">&quot;error_type&quot;</span><span class="p">:</span> <span class="s2">&quot;file_too_large&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;file_name&quot;</span><span class="p">:</span> <span class="n">entry</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span>
                            <span class="s2">&quot;size_mb&quot;</span><span class="p">:</span> <span class="n">uncompressed_size</span> <span class="o">//</span> <span class="p">(</span><span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">),</span>
                            <span class="s2">&quot;max_size_mb&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">limits</span><span class="o">.</span><span class="n">max_individual_file_size</span>
                            <span class="o">//</span> <span class="p">(</span><span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">),</span>
                        <span class="p">},</span>
                    <span class="p">)</span>
                    <span class="k">raise</span> <span class="n">CompressionSecurityError</span><span class="p">(</span>
                        <span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Individual file too large: &#39;</span><span class="si">{</span><span class="n">entry</span><span class="o">.</span><span class="n">filename</span><span class="si">}</span><span class="s2">&#39; would expand to </span><span class="si">{</span><span class="n">uncompressed_size</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="p">(</span><span class="mi">1024</span><span class="o">*</span><span class="mi">1024</span><span class="p">)</span><span class="si">}</span><span class="s2">MB. &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;Maximum allowed: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">limits</span><span class="o">.</span><span class="n">max_individual_file_size</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="p">(</span><span class="mi">1024</span><span class="o">*</span><span class="mi">1024</span><span class="p">)</span><span class="si">}</span><span class="s2">MB&quot;</span><span class="p">,</span>
                        <span class="n">error_code</span><span class="o">=</span><span class="n">ErrorCode</span><span class="o">.</span><span class="n">FILE_TOO_LARGE</span><span class="p">,</span>
                    <span class="p">)</span>

            <span class="c1"># Check total uncompressed size</span>
            <span class="k">if</span> <span class="n">total_uncompressed_size</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">limits</span><span class="o">.</span><span class="n">max_uncompressed_size</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="s2">&quot;Total uncompressed size too large&quot;</span><span class="p">,</span>
                    <span class="n">extra</span><span class="o">=</span><span class="p">{</span>
                        <span class="s2">&quot;error_type&quot;</span><span class="p">:</span> <span class="s2">&quot;zip_too_large&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;total_size_mb&quot;</span><span class="p">:</span> <span class="n">total_uncompressed_size</span> <span class="o">//</span> <span class="p">(</span><span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">),</span>
                        <span class="s2">&quot;max_size_mb&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">limits</span><span class="o">.</span><span class="n">max_uncompressed_size</span>
                        <span class="o">//</span> <span class="p">(</span><span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">),</span>
                    <span class="p">},</span>
                <span class="p">)</span>
                <span class="k">raise</span> <span class="n">ZipBombError</span><span class="p">(</span>
                    <span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Total uncompressed size too large: </span><span class="si">{</span><span class="n">total_uncompressed_size</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="p">(</span><span class="mi">1024</span><span class="o">*</span><span class="mi">1024</span><span class="p">)</span><span class="si">}</span><span class="s2">MB. &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;Maximum allowed: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">limits</span><span class="o">.</span><span class="n">max_uncompressed_size</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="p">(</span><span class="mi">1024</span><span class="o">*</span><span class="mi">1024</span><span class="p">)</span><span class="si">}</span><span class="s2">MB&quot;</span><span class="p">,</span>
                    <span class="n">compression_ratio</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                    <span class="n">uncompressed_size</span><span class="o">=</span><span class="n">total_uncompressed_size</span><span class="p">,</span>
                    <span class="n">max_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">limits</span><span class="o">.</span><span class="n">max_uncompressed_size</span><span class="p">,</span>
                <span class="p">)</span>

            <span class="c1"># Check overall compression ratio</span>
            <span class="k">if</span> <span class="n">total_compressed_size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">overall_compression_ratio</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">total_uncompressed_size</span> <span class="o">/</span> <span class="n">total_compressed_size</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="n">overall_compression_ratio</span>
                    <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">limits</span><span class="o">.</span><span class="n">max_compression_ratio</span>
                <span class="p">):</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                        <span class="s2">&quot;Overall compression ratio too high&quot;</span><span class="p">,</span>
                        <span class="n">extra</span><span class="o">=</span><span class="p">{</span>
                            <span class="s2">&quot;error_type&quot;</span><span class="p">:</span> <span class="s2">&quot;compression_ratio_exceeded&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;overall_ratio&quot;</span><span class="p">:</span> <span class="n">overall_compression_ratio</span><span class="p">,</span>
                            <span class="s2">&quot;max_ratio&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">limits</span><span class="o">.</span><span class="n">max_compression_ratio</span><span class="p">,</span>
                        <span class="p">},</span>
                    <span class="p">)</span>
                    <span class="k">raise</span> <span class="n">ZipBombError</span><span class="p">(</span>
                        <span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Overall compression ratio too high: </span><span class="si">{</span><span class="n">overall_compression_ratio</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">:1. &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;Maximum allowed: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">limits</span><span class="o">.</span><span class="n">max_compression_ratio</span><span class="si">}</span><span class="s2">:1&quot;</span><span class="p">,</span>
                        <span class="n">compression_ratio</span><span class="o">=</span><span class="n">overall_compression_ratio</span><span class="p">,</span>
                        <span class="n">max_ratio</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">limits</span><span class="o">.</span><span class="n">max_compression_ratio</span><span class="p">,</span>
                    <span class="p">)</span>

            <span class="c1"># Reject nested archives (potential security risk)</span>
            <span class="k">if</span> <span class="n">nested_archives</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="s2">&quot;Nested archives detected&quot;</span><span class="p">,</span>
                    <span class="n">extra</span><span class="o">=</span><span class="p">{</span>
                        <span class="s2">&quot;error_type&quot;</span><span class="p">:</span> <span class="s2">&quot;zip_nested_archive&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;nested_archives&quot;</span><span class="p">:</span> <span class="n">nested_archives</span><span class="p">,</span>
                    <span class="p">},</span>
                <span class="p">)</span>
                <span class="k">raise</span> <span class="n">CompressionSecurityError</span><span class="p">(</span>
                    <span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Nested archives are not allowed: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">nested_archives</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="n">error_code</span><span class="o">=</span><span class="n">ErrorCode</span><span class="o">.</span><span class="n">ZIP_NESTED_ARCHIVE</span><span class="p">,</span>
                <span class="p">)</span>

            <span class="c1"># Log analysis results</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                <span class="s2">&quot;ZIP analysis: </span><span class="si">%s</span><span class="s2"> files, </span><span class="si">%s</span><span class="s2">MB uncompressed, max ratio: </span><span class="si">%.1f</span><span class="s2">:1, overall ratio: </span><span class="si">%.1f</span><span class="s2">:1&quot;</span><span class="p">,</span>
                <span class="n">file_count</span><span class="p">,</span>
                <span class="n">total_uncompressed_size</span> <span class="o">//</span> <span class="p">(</span><span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">),</span>
                <span class="n">max_compression_ratio</span><span class="p">,</span>
                <span class="n">overall_compression_ratio</span><span class="p">,</span>
            <span class="p">)</span>

    <span class="k">except</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">BadZipFile</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Invalid or corrupted ZIP file&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">CompressionSecurityError</span><span class="p">(</span>
            <span class="n">message</span><span class="o">=</span><span class="s2">&quot;Invalid or corrupted ZIP file&quot;</span><span class="p">,</span>
            <span class="n">error_code</span><span class="o">=</span><span class="n">ErrorCode</span><span class="o">.</span><span class="n">ZIP_CORRUPT</span><span class="p">,</span>
        <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">err</span>
    <span class="k">except</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">LargeZipFile</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;ZIP file too large to process&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">CompressionSecurityError</span><span class="p">(</span>
            <span class="n">message</span><span class="o">=</span><span class="s2">&quot;ZIP file too large to process safely&quot;</span><span class="p">,</span>
            <span class="n">error_code</span><span class="o">=</span><span class="n">ErrorCode</span><span class="o">.</span><span class="n">ZIP_TOO_LARGE</span><span class="p">,</span>
        <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">err</span>
    <span class="k">except</span> <span class="ne">MemoryError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;ZIP requires excessive memory&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">ZipBombError</span><span class="p">(</span>
            <span class="n">message</span><span class="o">=</span><span class="s2">&quot;ZIP file requires too much memory to process - potential zip bomb&quot;</span><span class="p">,</span>
            <span class="n">compression_ratio</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">err</span>
    <span class="k">except</span> <span class="p">(</span><span class="n">ZipBombError</span><span class="p">,</span> <span class="n">CompressionSecurityError</span><span class="p">):</span>
        <span class="c1"># Re-raise our own exceptions</span>
        <span class="k">raise</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
            <span class="s2">&quot;Unexpected error during ZIP compression validation&quot;</span><span class="p">,</span>
            <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">raise</span> <span class="n">FileProcessingError</span><span class="p">(</span>
            <span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;ZIP validation failed: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">err</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="safeuploads.ConfigValidationError" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">ConfigValidationError</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h2>


    <div class="doc doc-contents ">


        <p>Configuration validation issue with severity and recommendation.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="safeuploads.ConfigValidationError.error_type">error_type</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Type of the validation error.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="safeuploads.ConfigValidationError.message">message</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Human-readable error message.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="safeuploads.ConfigValidationError.severity">severity</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Error severity level ('error', 'warning', 'info').</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="safeuploads.ConfigValidationError.component">component</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Component that failed validation.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="safeuploads.ConfigValidationError.recommendation">recommendation</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional recommendation to fix the issue.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="quote">
                <summary>Source code in <code>safeuploads/exceptions.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">ConfigValidationError</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Configuration validation issue with severity and recommendation.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        error_type: Type of the validation error.</span>
<span class="sd">        message: Human-readable error message.</span>
<span class="sd">        severity: Error severity level (&#39;error&#39;, &#39;warning&#39;, &#39;info&#39;).</span>
<span class="sd">        component: Component that failed validation.</span>
<span class="sd">        recommendation: Optional recommendation to fix the issue.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">error_type</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">message</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">severity</span><span class="p">:</span> <span class="nb">str</span>  <span class="c1"># &#39;error&#39;, &#39;warning&#39;, &#39;info&#39;</span>
    <span class="n">component</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">recommendation</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="safeuploads.DangerousExtensionCategory" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">DangerousExtensionCategory</span>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="enum.Enum">Enum</span></code></p>


        <p>File extension categories considered potentially dangerous for uploads.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="safeuploads.DangerousExtensionCategory.WINDOWS_EXECUTABLES">WINDOWS_EXECUTABLES</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Traditional Windows executable formats.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="safeuploads.DangerousExtensionCategory.SCRIPT_FILES">SCRIPT_FILES</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Script files that can execute code.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="safeuploads.DangerousExtensionCategory.WEB_SCRIPTS">WEB_SCRIPTS</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Web server and dynamic content scripts.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="safeuploads.DangerousExtensionCategory.UNIX_EXECUTABLES">UNIX_EXECUTABLES</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Unix/Linux executables and shell scripts.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="safeuploads.DangerousExtensionCategory.MACOS_EXECUTABLES">MACOS_EXECUTABLES</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>macOS specific executables and applications.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="safeuploads.DangerousExtensionCategory.JAVA_EXECUTABLES">JAVA_EXECUTABLES</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Java related executables and bytecode.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="safeuploads.DangerousExtensionCategory.MOBILE_APPS">MOBILE_APPS</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Mobile application packages.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="safeuploads.DangerousExtensionCategory.BROWSER_EXTENSIONS">BROWSER_EXTENSIONS</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Browser extensions and web applications.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="safeuploads.DangerousExtensionCategory.PACKAGE_FORMATS">PACKAGE_FORMATS</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Modern package managers and distribution formats.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="safeuploads.DangerousExtensionCategory.ARCHIVE_FORMATS">ARCHIVE_FORMATS</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Archive formats that can contain executables.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="safeuploads.DangerousExtensionCategory.VIRTUALIZATION_FORMATS">VIRTUALIZATION_FORMATS</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Virtualization and container formats.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="safeuploads.DangerousExtensionCategory.OFFICE_MACROS">OFFICE_MACROS</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Office documents with macro capabilities.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="safeuploads.DangerousExtensionCategory.SYSTEM_FILES">SYSTEM_FILES</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>System shortcuts and configuration files.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="safeuploads.DangerousExtensionCategory.SYSTEM_DRIVERS">SYSTEM_DRIVERS</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>System drivers and low-level components.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="safeuploads.DangerousExtensionCategory.WINDOWS_THEMES">WINDOWS_THEMES</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Windows theme and customization files.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="safeuploads.DangerousExtensionCategory.HELP_FILES">HELP_FILES</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Help and documentation files that can execute code.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="quote">
                <summary>Source code in <code>safeuploads/enums.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">DangerousExtensionCategory</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    File extension categories considered potentially dangerous for uploads.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        WINDOWS_EXECUTABLES: Traditional Windows executable formats.</span>
<span class="sd">        SCRIPT_FILES: Script files that can execute code.</span>
<span class="sd">        WEB_SCRIPTS: Web server and dynamic content scripts.</span>
<span class="sd">        UNIX_EXECUTABLES: Unix/Linux executables and shell scripts.</span>
<span class="sd">        MACOS_EXECUTABLES: macOS specific executables and applications.</span>
<span class="sd">        JAVA_EXECUTABLES: Java related executables and bytecode.</span>
<span class="sd">        MOBILE_APPS: Mobile application packages.</span>
<span class="sd">        BROWSER_EXTENSIONS: Browser extensions and web applications.</span>
<span class="sd">        PACKAGE_FORMATS: Modern package managers and distribution formats.</span>
<span class="sd">        ARCHIVE_FORMATS: Archive formats that can contain executables.</span>
<span class="sd">        VIRTUALIZATION_FORMATS: Virtualization and container formats.</span>
<span class="sd">        OFFICE_MACROS: Office documents with macro capabilities.</span>
<span class="sd">        SYSTEM_FILES: System shortcuts and configuration files.</span>
<span class="sd">        SYSTEM_DRIVERS: System drivers and low-level components.</span>
<span class="sd">        WINDOWS_THEMES: Windows theme and customization files.</span>
<span class="sd">        HELP_FILES: Help and documentation files that can execute code.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Traditional Windows executables</span>
    <span class="n">WINDOWS_EXECUTABLES</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;.exe&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.bat&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.cmd&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.com&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.pif&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.scr&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.msi&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.dll&quot;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="c1"># Script files that can execute code</span>
    <span class="n">SCRIPT_FILES</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;.vbs&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.js&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.jse&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.wsf&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.wsh&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.hta&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.ps1&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.psm1&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.ps1xml&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.psc1&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.psd1&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.pssc&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.cdxml&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.xaml&quot;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="c1"># Web server and dynamic content scripts</span>
    <span class="n">WEB_SCRIPTS</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;.jsp&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.php&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.php3&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.php4&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.php5&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.phtml&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.asp&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.aspx&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.cer&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.cgi&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.pl&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.py&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.rb&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.go&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.lua&quot;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="c1"># Unix/Linux executables and shell scripts</span>
    <span class="n">UNIX_EXECUTABLES</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;.sh&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.bash&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.zsh&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.fish&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.csh&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.ksh&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.tcsh&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.run&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.bin&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.out&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.elf&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.so&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.a&quot;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="c1"># macOS specific executables and applications</span>
    <span class="n">MACOS_EXECUTABLES</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;.app&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.dmg&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.pkg&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.mpkg&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.command&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.tool&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.workflow&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.action&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.dylib&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.bundle&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.framework&quot;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="c1"># Java related executables and bytecode</span>
    <span class="n">JAVA_EXECUTABLES</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;.jar&quot;</span><span class="p">,</span> <span class="s2">&quot;.war&quot;</span><span class="p">,</span> <span class="s2">&quot;.ear&quot;</span><span class="p">,</span> <span class="s2">&quot;.jnlp&quot;</span><span class="p">,</span> <span class="s2">&quot;.class&quot;</span><span class="p">}</span>

    <span class="c1"># Mobile application packages</span>
    <span class="n">MOBILE_APPS</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;.apk&quot;</span><span class="p">,</span> <span class="s2">&quot;.aab&quot;</span><span class="p">,</span> <span class="s2">&quot;.ipa&quot;</span><span class="p">,</span> <span class="s2">&quot;.appx&quot;</span><span class="p">,</span> <span class="s2">&quot;.msix&quot;</span><span class="p">,</span> <span class="s2">&quot;.xap&quot;</span><span class="p">}</span>

    <span class="c1"># Browser extensions and web applications</span>
    <span class="n">BROWSER_EXTENSIONS</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;.crx&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.xpi&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.safariextz&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.oex&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.nex&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.gadget&quot;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="c1"># Modern package managers and distribution formats</span>
    <span class="n">PACKAGE_FORMATS</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;.deb&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.rpm&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.snap&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.flatpak&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.appimage&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.vsix&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.nupkg&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.gem&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.whl&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.egg&quot;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="c1"># Archive formats that can contain executables</span>
    <span class="n">ARCHIVE_FORMATS</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;.7z&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.rar&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.cab&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.ace&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.arj&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.lzh&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.lha&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.zoo&quot;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="c1"># Virtualization and container formats</span>
    <span class="n">VIRTUALIZATION_FORMATS</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;.ova&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.ovf&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.vmdk&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.vdi&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.vhd&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.vhdx&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.qcow2&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.docker&quot;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="c1"># Office documents with macro capabilities</span>
    <span class="n">OFFICE_MACROS</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;.docm&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.dotm&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.xlsm&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.xltm&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.xlam&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.pptm&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.potm&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.ppam&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.sldm&quot;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="c1"># System shortcuts and configuration files</span>
    <span class="n">SYSTEM_FILES</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;.url&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.website&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.webloc&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.desktop&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.lnk&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.application&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.manifest&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.deploy&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.msu&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.patch&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.diff&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.reg&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.inf&quot;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="c1"># System drivers and low-level components</span>
    <span class="n">SYSTEM_DRIVERS</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;.sys&quot;</span><span class="p">,</span> <span class="s2">&quot;.drv&quot;</span><span class="p">,</span> <span class="s2">&quot;.ocx&quot;</span><span class="p">,</span> <span class="s2">&quot;.cpl&quot;</span><span class="p">}</span>

    <span class="c1"># Windows theme and customization files</span>
    <span class="n">WINDOWS_THEMES</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;.theme&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.themepack&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.scf&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.shs&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.shb&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.sct&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.ws&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.job&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.msc&quot;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="c1"># Help and documentation files that can execute code</span>
    <span class="n">HELP_FILES</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;.chm&quot;</span><span class="p">,</span> <span class="s2">&quot;.hlp&quot;</span><span class="p">}</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="safeuploads.ErrorCode" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">ErrorCode</span>


</h2>


    <div class="doc doc-contents ">


        <p>Machine-readable error codes for file validation failures.</p>








              <details class="quote">
                <summary>Source code in <code>safeuploads/exceptions.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ErrorCode</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Machine-readable error codes for file validation failures.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        Error codes are class-level string constants for various</span>
<span class="sd">        validation failure types.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Filename validation errors</span>
    <span class="n">FILENAME_EMPTY</span> <span class="o">=</span> <span class="s2">&quot;FILENAME_EMPTY&quot;</span>
    <span class="n">FILENAME_INVALID</span> <span class="o">=</span> <span class="s2">&quot;FILENAME_INVALID&quot;</span>
    <span class="n">FILENAME_TOO_LONG</span> <span class="o">=</span> <span class="s2">&quot;FILENAME_TOO_LONG&quot;</span>

    <span class="c1"># Unicode security errors</span>
    <span class="n">UNICODE_SECURITY</span> <span class="o">=</span> <span class="s2">&quot;UNICODE_SECURITY&quot;</span>
    <span class="n">UNICODE_DANGEROUS_CHARS</span> <span class="o">=</span> <span class="s2">&quot;UNICODE_DANGEROUS_CHARS&quot;</span>
    <span class="n">UNICODE_NORMALIZATION_ERROR</span> <span class="o">=</span> <span class="s2">&quot;UNICODE_NORMALIZATION_ERROR&quot;</span>

    <span class="c1"># Extension validation errors</span>
    <span class="n">EXTENSION_BLOCKED</span> <span class="o">=</span> <span class="s2">&quot;EXTENSION_BLOCKED&quot;</span>
    <span class="n">EXTENSION_NOT_ALLOWED</span> <span class="o">=</span> <span class="s2">&quot;EXTENSION_NOT_ALLOWED&quot;</span>
    <span class="n">COMPOUND_EXTENSION_BLOCKED</span> <span class="o">=</span> <span class="s2">&quot;COMPOUND_EXTENSION_BLOCKED&quot;</span>
    <span class="n">EXTENSION_MISSING</span> <span class="o">=</span> <span class="s2">&quot;EXTENSION_MISSING&quot;</span>

    <span class="c1"># Windows security errors</span>
    <span class="n">WINDOWS_RESERVED_NAME</span> <span class="o">=</span> <span class="s2">&quot;WINDOWS_RESERVED_NAME&quot;</span>

    <span class="c1"># File size errors</span>
    <span class="n">FILE_TOO_LARGE</span> <span class="o">=</span> <span class="s2">&quot;FILE_TOO_LARGE&quot;</span>
    <span class="n">FILE_EMPTY</span> <span class="o">=</span> <span class="s2">&quot;FILE_EMPTY&quot;</span>
    <span class="n">FILE_SIZE_UNKNOWN</span> <span class="o">=</span> <span class="s2">&quot;FILE_SIZE_UNKNOWN&quot;</span>

    <span class="c1"># MIME type errors</span>
    <span class="n">MIME_TYPE_INVALID</span> <span class="o">=</span> <span class="s2">&quot;MIME_TYPE_INVALID&quot;</span>
    <span class="n">MIME_TYPE_MISMATCH</span> <span class="o">=</span> <span class="s2">&quot;MIME_TYPE_MISMATCH&quot;</span>
    <span class="n">MIME_DETECTION_FAILED</span> <span class="o">=</span> <span class="s2">&quot;MIME_DETECTION_FAILED&quot;</span>

    <span class="c1"># File signature errors</span>
    <span class="n">FILE_SIGNATURE_INVALID</span> <span class="o">=</span> <span class="s2">&quot;FILE_SIGNATURE_INVALID&quot;</span>
    <span class="n">FILE_SIGNATURE_MISSING</span> <span class="o">=</span> <span class="s2">&quot;FILE_SIGNATURE_MISSING&quot;</span>
    <span class="n">FILE_SIGNATURE_MISMATCH</span> <span class="o">=</span> <span class="s2">&quot;FILE_SIGNATURE_MISMATCH&quot;</span>

    <span class="c1"># Compression and ZIP errors</span>
    <span class="n">ZIP_BOMB_DETECTED</span> <span class="o">=</span> <span class="s2">&quot;ZIP_BOMB_DETECTED&quot;</span>
    <span class="n">ZIP_CONTENT_THREAT</span> <span class="o">=</span> <span class="s2">&quot;ZIP_CONTENT_THREAT&quot;</span>
    <span class="n">COMPRESSION_RATIO_EXCEEDED</span> <span class="o">=</span> <span class="s2">&quot;COMPRESSION_RATIO_EXCEEDED&quot;</span>
    <span class="n">ZIP_TOO_MANY_ENTRIES</span> <span class="o">=</span> <span class="s2">&quot;ZIP_TOO_MANY_ENTRIES&quot;</span>
    <span class="n">ZIP_INVALID_STRUCTURE</span> <span class="o">=</span> <span class="s2">&quot;ZIP_INVALID_STRUCTURE&quot;</span>
    <span class="n">ZIP_CORRUPT</span> <span class="o">=</span> <span class="s2">&quot;ZIP_CORRUPT&quot;</span>
    <span class="n">ZIP_TOO_LARGE</span> <span class="o">=</span> <span class="s2">&quot;ZIP_TOO_LARGE&quot;</span>
    <span class="n">ZIP_NESTED_ARCHIVE</span> <span class="o">=</span> <span class="s2">&quot;ZIP_NESTED_ARCHIVE&quot;</span>
    <span class="n">ZIP_DIRECTORY_TRAVERSAL</span> <span class="o">=</span> <span class="s2">&quot;ZIP_DIRECTORY_TRAVERSAL&quot;</span>
    <span class="n">ZIP_SYMLINK_DETECTED</span> <span class="o">=</span> <span class="s2">&quot;ZIP_SYMLINK_DETECTED&quot;</span>
    <span class="n">ZIP_ABSOLUTE_PATH</span> <span class="o">=</span> <span class="s2">&quot;ZIP_ABSOLUTE_PATH&quot;</span>
    <span class="n">ZIP_ANALYSIS_TIMEOUT</span> <span class="o">=</span> <span class="s2">&quot;ZIP_ANALYSIS_TIMEOUT&quot;</span>

    <span class="c1"># Processing errors</span>
    <span class="n">PROCESSING_ERROR</span> <span class="o">=</span> <span class="s2">&quot;PROCESSING_ERROR&quot;</span>
    <span class="n">IO_ERROR</span> <span class="o">=</span> <span class="s2">&quot;IO_ERROR&quot;</span>
    <span class="n">MEMORY_ERROR</span> <span class="o">=</span> <span class="s2">&quot;MEMORY_ERROR&quot;</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="safeuploads.ExtensionSecurityError" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">ExtensionSecurityError</span>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="FilenameSecurityError (safeuploads.exceptions.FilenameSecurityError)" href="#safeuploads.FilenameSecurityError">FilenameSecurityError</a></code></p>


        <p>Dangerous file extension detected.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>message</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Human-readable error description.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>filename</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional filename with dangerous extension.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>extension</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional specific extension that was blocked.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>error_code</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional error code (defaults to
EXTENSION_BLOCKED).</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="safeuploads.ExtensionSecurityError.extension">extension</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The specific extension that was blocked.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="quote">
                <summary>Source code in <code>safeuploads/exceptions.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ExtensionSecurityError</span><span class="p">(</span><span class="n">FilenameSecurityError</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Dangerous file extension detected.</span>

<span class="sd">    Args:</span>
<span class="sd">        message: Human-readable error description.</span>
<span class="sd">        filename: Optional filename with dangerous extension.</span>
<span class="sd">        extension: Optional specific extension that was blocked.</span>
<span class="sd">        error_code: Optional error code (defaults to</span>
<span class="sd">            EXTENSION_BLOCKED).</span>

<span class="sd">    Attributes:</span>
<span class="sd">        extension: The specific extension that was blocked.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">message</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">extension</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">error_code</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">extension</span> <span class="o">=</span> <span class="n">extension</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">message</span><span class="p">,</span>
            <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span>
            <span class="n">error_code</span><span class="o">=</span><span class="n">error_code</span> <span class="ow">or</span> <span class="n">ErrorCode</span><span class="o">.</span><span class="n">EXTENSION_BLOCKED</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="safeuploads.ExtensionSecurityValidator" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">ExtensionSecurityValidator</span>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="BaseValidator (safeuploads.validators.base.BaseValidator)" href="#safeuploads.BaseValidator">BaseValidator</a></code></p>


        <p>Validates filenames against configured forbidden extensions.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="safeuploads.ExtensionSecurityValidator.config">config</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>File security configuration settings.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="quote">
                <summary>Source code in <code>safeuploads/validators/extension_validator.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span>
<span class="normal">96</span>
<span class="normal">97</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ExtensionSecurityValidator</span><span class="p">(</span><span class="n">BaseValidator</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validates filenames against configured forbidden extensions.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        config: File security configuration settings.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">FileSecurityConfig</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize the validator.</span>

<span class="sd">        Args:</span>
<span class="sd">            config: File security configuration settings.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">validate_extensions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validate filename against blocked extensions.</span>

<span class="sd">        Args:</span>
<span class="sd">            filename: Name of the file to validate.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ExtensionSecurityError: If blocked compound or single</span>
<span class="sd">                extension detected in filename.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Check for compound dangerous extensions first (e.g., .tar.xz, .user.js)</span>
        <span class="n">filename_lower</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">compound_ext</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">COMPOUND_BLOCKED_EXTENSIONS</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">filename_lower</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">compound_ext</span><span class="p">):</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="s2">&quot;Dangerous compound extension detected&quot;</span><span class="p">,</span>
                    <span class="n">extra</span><span class="o">=</span><span class="p">{</span>
                        <span class="s2">&quot;error_type&quot;</span><span class="p">:</span> <span class="s2">&quot;compound_extension_blocked&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;file_name&quot;</span><span class="p">:</span> <span class="n">filename</span><span class="p">,</span>
                        <span class="s2">&quot;extension&quot;</span><span class="p">:</span> <span class="n">compound_ext</span><span class="p">,</span>
                    <span class="p">},</span>
                <span class="p">)</span>
                <span class="k">raise</span> <span class="n">ExtensionSecurityError</span><span class="p">(</span>
                    <span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Dangerous compound file extension &#39;</span><span class="si">{</span><span class="n">compound_ext</span><span class="si">}</span><span class="s2">&#39; detected in filename. &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;Upload rejected for security.&quot;</span><span class="p">,</span>
                    <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span>
                    <span class="n">extension</span><span class="o">=</span><span class="n">compound_ext</span><span class="p">,</span>
                    <span class="n">error_code</span><span class="o">=</span><span class="n">ErrorCode</span><span class="o">.</span><span class="n">COMPOUND_EXTENSION_BLOCKED</span><span class="p">,</span>
                <span class="p">)</span>

        <span class="c1"># Check ALL extensions in the filename for dangerous ones</span>
        <span class="n">parts</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)):</span>
                <span class="n">ext</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;.</span><span class="si">{</span><span class="n">parts</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="k">if</span> <span class="n">ext</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">BLOCKED_EXTENSIONS</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                        <span class="s2">&quot;Dangerous extension detected&quot;</span><span class="p">,</span>
                        <span class="n">extra</span><span class="o">=</span><span class="p">{</span>
                            <span class="s2">&quot;error_type&quot;</span><span class="p">:</span> <span class="s2">&quot;extension_blocked&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;file_name&quot;</span><span class="p">:</span> <span class="n">filename</span><span class="p">,</span>
                            <span class="s2">&quot;extension&quot;</span><span class="p">:</span> <span class="n">ext</span><span class="p">,</span>
                        <span class="p">},</span>
                    <span class="p">)</span>
                    <span class="k">raise</span> <span class="n">ExtensionSecurityError</span><span class="p">(</span>
                        <span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Dangerous file extension &#39;</span><span class="si">{</span><span class="n">ext</span><span class="si">}</span><span class="s2">&#39; detected in filename. &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;Upload rejected for security.&quot;</span><span class="p">,</span>
                        <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span>
                        <span class="n">extension</span><span class="o">=</span><span class="n">ext</span><span class="p">,</span>
                        <span class="n">error_code</span><span class="o">=</span><span class="n">ErrorCode</span><span class="o">.</span><span class="n">EXTENSION_BLOCKED</span><span class="p">,</span>
                    <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validate the given filename.</span>

<span class="sd">        Args:</span>
<span class="sd">            filename: Name of the file to validate.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ExtensionSecurityError: If filename extension is not</span>
<span class="sd">                permitted.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate_extensions</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="safeuploads.ExtensionSecurityValidator.__init__" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">__init__</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">__init__</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Initialize the validator.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>config</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="FileSecurityConfig (safeuploads.config.FileSecurityConfig)" href="#safeuploads.FileSecurityConfig">FileSecurityConfig</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>File security configuration settings.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>safeuploads/validators/extension_validator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">FileSecurityConfig</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Initialize the validator.</span>

<span class="sd">    Args:</span>
<span class="sd">        config: File security configuration settings.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="safeuploads.ExtensionSecurityValidator.validate" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">validate</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">validate</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Validate the given filename.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>filename</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the file to validate.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="ExtensionSecurityError (safeuploads.exceptions.ExtensionSecurityError)" href="#safeuploads.ExtensionSecurityError">ExtensionSecurityError</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If filename extension is not
permitted.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>safeuploads/validators/extension_validator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span>
<span class="normal">96</span>
<span class="normal">97</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validate the given filename.</span>

<span class="sd">    Args:</span>
<span class="sd">        filename: Name of the file to validate.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ExtensionSecurityError: If filename extension is not</span>
<span class="sd">            permitted.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate_extensions</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="safeuploads.ExtensionSecurityValidator.validate_extensions" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">validate_extensions</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">validate_extensions</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Validate filename against blocked extensions.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>filename</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the file to validate.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="ExtensionSecurityError (safeuploads.exceptions.ExtensionSecurityError)" href="#safeuploads.ExtensionSecurityError">ExtensionSecurityError</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If blocked compound or single
extension detected in filename.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>safeuploads/validators/extension_validator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">validate_extensions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validate filename against blocked extensions.</span>

<span class="sd">    Args:</span>
<span class="sd">        filename: Name of the file to validate.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ExtensionSecurityError: If blocked compound or single</span>
<span class="sd">            extension detected in filename.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Check for compound dangerous extensions first (e.g., .tar.xz, .user.js)</span>
    <span class="n">filename_lower</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">compound_ext</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">COMPOUND_BLOCKED_EXTENSIONS</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">filename_lower</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">compound_ext</span><span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">&quot;Dangerous compound extension detected&quot;</span><span class="p">,</span>
                <span class="n">extra</span><span class="o">=</span><span class="p">{</span>
                    <span class="s2">&quot;error_type&quot;</span><span class="p">:</span> <span class="s2">&quot;compound_extension_blocked&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;file_name&quot;</span><span class="p">:</span> <span class="n">filename</span><span class="p">,</span>
                    <span class="s2">&quot;extension&quot;</span><span class="p">:</span> <span class="n">compound_ext</span><span class="p">,</span>
                <span class="p">},</span>
            <span class="p">)</span>
            <span class="k">raise</span> <span class="n">ExtensionSecurityError</span><span class="p">(</span>
                <span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Dangerous compound file extension &#39;</span><span class="si">{</span><span class="n">compound_ext</span><span class="si">}</span><span class="s2">&#39; detected in filename. &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;Upload rejected for security.&quot;</span><span class="p">,</span>
                <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span>
                <span class="n">extension</span><span class="o">=</span><span class="n">compound_ext</span><span class="p">,</span>
                <span class="n">error_code</span><span class="o">=</span><span class="n">ErrorCode</span><span class="o">.</span><span class="n">COMPOUND_EXTENSION_BLOCKED</span><span class="p">,</span>
            <span class="p">)</span>

    <span class="c1"># Check ALL extensions in the filename for dangerous ones</span>
    <span class="n">parts</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)):</span>
            <span class="n">ext</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;.</span><span class="si">{</span><span class="n">parts</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">if</span> <span class="n">ext</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">BLOCKED_EXTENSIONS</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="s2">&quot;Dangerous extension detected&quot;</span><span class="p">,</span>
                    <span class="n">extra</span><span class="o">=</span><span class="p">{</span>
                        <span class="s2">&quot;error_type&quot;</span><span class="p">:</span> <span class="s2">&quot;extension_blocked&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;file_name&quot;</span><span class="p">:</span> <span class="n">filename</span><span class="p">,</span>
                        <span class="s2">&quot;extension&quot;</span><span class="p">:</span> <span class="n">ext</span><span class="p">,</span>
                    <span class="p">},</span>
                <span class="p">)</span>
                <span class="k">raise</span> <span class="n">ExtensionSecurityError</span><span class="p">(</span>
                    <span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Dangerous file extension &#39;</span><span class="si">{</span><span class="n">ext</span><span class="si">}</span><span class="s2">&#39; detected in filename. &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;Upload rejected for security.&quot;</span><span class="p">,</span>
                    <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span>
                    <span class="n">extension</span><span class="o">=</span><span class="n">ext</span><span class="p">,</span>
                    <span class="n">error_code</span><span class="o">=</span><span class="n">ErrorCode</span><span class="o">.</span><span class="n">EXTENSION_BLOCKED</span><span class="p">,</span>
                <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="safeuploads.FileProcessingError" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">FileProcessingError</span>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="FileSecurityError (safeuploads.exceptions.FileSecurityError)" href="#safeuploads.FileSecurityError">FileSecurityError</a></code></p>


        <p>Unexpected processing error during file validation.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>message</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Human-readable error description.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>original_error</code>
            </td>
            <td>
                  <code><span title="Exception">Exception</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional original exception that was caught.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="safeuploads.FileProcessingError.original_error">original_error</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The original exception that was caught.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="quote">
                <summary>Source code in <code>safeuploads/exceptions.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">FileProcessingError</span><span class="p">(</span><span class="n">FileSecurityError</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Unexpected processing error during file validation.</span>

<span class="sd">    Args:</span>
<span class="sd">        message: Human-readable error description.</span>
<span class="sd">        original_error: Optional original exception that was caught.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        original_error: The original exception that was caught.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">original_error</span><span class="p">:</span> <span class="ne">Exception</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">original_error</span> <span class="o">=</span> <span class="n">original_error</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">error_code</span><span class="o">=</span><span class="n">ErrorCode</span><span class="o">.</span><span class="n">PROCESSING_ERROR</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="safeuploads.FileSecurityConfig" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">FileSecurityConfig</span>


</h2>


    <div class="doc doc-contents ">


        <p>Centralizes file upload security settings and validation.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="safeuploads.FileSecurityConfig.limits">limits</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Security limits configuration instance.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="safeuploads.FileSecurityConfig.ALLOWED_IMAGE_MIMES">ALLOWED_IMAGE_MIMES</span></code></td>
            <td>
                  <code><span title="set">set</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Permitted MIME types for images.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="safeuploads.FileSecurityConfig.ALLOWED_ZIP_MIMES">ALLOWED_ZIP_MIMES</span></code></td>
            <td>
                  <code><span title="set">set</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Permitted MIME types for ZIP files.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="safeuploads.FileSecurityConfig.ALLOWED_IMAGE_EXTENSIONS">ALLOWED_IMAGE_EXTENSIONS</span></code></td>
            <td>
                  <code><span title="set">set</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Permitted image file extensions.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="safeuploads.FileSecurityConfig.ALLOWED_ZIP_EXTENSIONS">ALLOWED_ZIP_EXTENSIONS</span></code></td>
            <td>
                  <code><span title="set">set</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Permitted ZIP file extensions.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="safeuploads.FileSecurityConfig.BLOCKED_EXTENSIONS">BLOCKED_EXTENSIONS</span></code></td>
            <td>
                  <code><span title="set">set</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dangerous file extensions to block.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="safeuploads.FileSecurityConfig.COMPOUND_BLOCKED_EXTENSIONS">COMPOUND_BLOCKED_EXTENSIONS</span></code></td>
            <td>
                  <code><span title="set">set</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Multi-part extensions to block.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="safeuploads.FileSecurityConfig.DANGEROUS_UNICODE_CHARS">DANGEROUS_UNICODE_CHARS</span></code></td>
            <td>
                  <code><span title="set">set</span>[<span title="int">int</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Unicode characters for filename attacks.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="safeuploads.FileSecurityConfig.WINDOWS_RESERVED_NAMES">WINDOWS_RESERVED_NAMES</span></code></td>
            <td>
                  <code><span title="set">set</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Platform-specific reserved filenames.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="quote">
                <summary>Source code in <code>safeuploads/config.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">FileSecurityConfig</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Centralizes file upload security settings and validation.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        limits: Security limits configuration instance.</span>
<span class="sd">        ALLOWED_IMAGE_MIMES: Permitted MIME types for images.</span>
<span class="sd">        ALLOWED_ZIP_MIMES: Permitted MIME types for ZIP files.</span>
<span class="sd">        ALLOWED_IMAGE_EXTENSIONS: Permitted image file extensions.</span>
<span class="sd">        ALLOWED_ZIP_EXTENSIONS: Permitted ZIP file extensions.</span>
<span class="sd">        BLOCKED_EXTENSIONS: Dangerous file extensions to block.</span>
<span class="sd">        COMPOUND_BLOCKED_EXTENSIONS: Multi-part extensions to block.</span>
<span class="sd">        DANGEROUS_UNICODE_CHARS: Unicode characters for filename attacks.</span>
<span class="sd">        WINDOWS_RESERVED_NAMES: Platform-specific reserved filenames.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Security limits configuration</span>
    <span class="n">limits</span> <span class="o">=</span> <span class="n">SecurityLimits</span><span class="p">()</span>

    <span class="c1"># Allowed MIME types for images</span>
    <span class="n">ALLOWED_IMAGE_MIMES</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;image/jpeg&quot;</span><span class="p">,</span> <span class="s2">&quot;image/jpg&quot;</span><span class="p">,</span> <span class="s2">&quot;image/png&quot;</span><span class="p">}</span>

    <span class="c1"># Allowed MIME types for ZIP files</span>
    <span class="n">ALLOWED_ZIP_MIMES</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;application/zip&quot;</span><span class="p">,</span>
        <span class="s2">&quot;application/x-zip-compressed&quot;</span><span class="p">,</span>
        <span class="s2">&quot;multipart/x-zip&quot;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="c1"># Allowed file extensions</span>
    <span class="n">ALLOWED_IMAGE_EXTENSIONS</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;.jpg&quot;</span><span class="p">,</span> <span class="s2">&quot;.jpeg&quot;</span><span class="p">,</span> <span class="s2">&quot;.png&quot;</span><span class="p">}</span>
    <span class="n">ALLOWED_ZIP_EXTENSIONS</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;.zip&quot;</span><span class="p">}</span>

    <span class="c1"># Generate dangerous file extensions from categorized enums</span>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_generate_blocked_extensions</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Aggregate all dangerous extension categories.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Combined set of blocked file extensions.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">blocked_extensions</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

        <span class="c1"># Combine all dangerous extension categories</span>
        <span class="k">for</span> <span class="n">category</span> <span class="ow">in</span> <span class="n">DangerousExtensionCategory</span><span class="p">:</span>
            <span class="n">blocked_extensions</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">category</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">blocked_extensions</span>

    <span class="c1"># Generate compound dangerous file extensions from categorized enums</span>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_generate_compound_blocked_extensions</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Aggregate all compound extension categories.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Combined set of blocked compound file extensions.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">compound_extensions</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

        <span class="c1"># Combine all compound extension categories</span>
        <span class="k">for</span> <span class="n">category</span> <span class="ow">in</span> <span class="n">CompoundExtensionCategory</span><span class="p">:</span>
            <span class="n">compound_extensions</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">category</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">compound_extensions</span>

    <span class="c1"># Generate dangerous Unicode characters from categorized enums</span>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_generate_dangerous_unicode_chars</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">set</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Aggregate all dangerous Unicode code points.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Combined set of dangerous Unicode code points.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dangerous_chars</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

        <span class="c1"># Combine all Unicode attack categories</span>
        <span class="k">for</span> <span class="n">category</span> <span class="ow">in</span> <span class="n">UnicodeAttackCategory</span><span class="p">:</span>
            <span class="n">dangerous_chars</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">category</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">dangerous_chars</span>

    <span class="c1"># Dangerous file extensions to explicitly block (generated from enums)</span>
    <span class="n">BLOCKED_EXTENSIONS</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">_generate_blocked_extensions</span><span class="p">()</span>

    <span class="c1"># Compound dangerous file extensions (multi-part extensions)</span>
    <span class="c1"># These are checked as complete strings, not individual parts</span>
    <span class="n">COMPOUND_BLOCKED_EXTENSIONS</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">_generate_compound_blocked_extensions</span><span class="p">()</span>

    <span class="c1"># Dangerous Unicode characters that can be used for filename attacks</span>
    <span class="c1"># These characters can disguise file extensions or cause rendering issues</span>
    <span class="n">DANGEROUS_UNICODE_CHARS</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">_generate_dangerous_unicode_chars</span><span class="p">()</span>

    <span class="c1"># Windows reserved names that cannot be used as filenames</span>
    <span class="c1"># These names are reserved by Windows regardless of extension</span>
    <span class="n">WINDOWS_RESERVED_NAMES</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;con&quot;</span><span class="p">,</span>
        <span class="s2">&quot;prn&quot;</span><span class="p">,</span>
        <span class="s2">&quot;aux&quot;</span><span class="p">,</span>
        <span class="s2">&quot;nul&quot;</span><span class="p">,</span>
        <span class="s2">&quot;com1&quot;</span><span class="p">,</span>
        <span class="s2">&quot;com2&quot;</span><span class="p">,</span>
        <span class="s2">&quot;com3&quot;</span><span class="p">,</span>
        <span class="s2">&quot;com4&quot;</span><span class="p">,</span>
        <span class="s2">&quot;com5&quot;</span><span class="p">,</span>
        <span class="s2">&quot;com6&quot;</span><span class="p">,</span>
        <span class="s2">&quot;com7&quot;</span><span class="p">,</span>
        <span class="s2">&quot;com8&quot;</span><span class="p">,</span>
        <span class="s2">&quot;com9&quot;</span><span class="p">,</span>
        <span class="s2">&quot;lpt1&quot;</span><span class="p">,</span>
        <span class="s2">&quot;lpt2&quot;</span><span class="p">,</span>
        <span class="s2">&quot;lpt3&quot;</span><span class="p">,</span>
        <span class="s2">&quot;lpt4&quot;</span><span class="p">,</span>
        <span class="s2">&quot;lpt5&quot;</span><span class="p">,</span>
        <span class="s2">&quot;lpt6&quot;</span><span class="p">,</span>
        <span class="s2">&quot;lpt7&quot;</span><span class="p">,</span>
        <span class="s2">&quot;lpt8&quot;</span><span class="p">,</span>
        <span class="s2">&quot;lpt9&quot;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="c1"># Configuration validation trigger</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">__init_subclass__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Hook for subclass creation to validate configuration.</span>

<span class="sd">        Args:</span>
<span class="sd">            **kwargs: Subclass initialization arguments.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init_subclass__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="c1"># Perform validation with warnings allowed (non-strict mode)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">validate_and_report</span><span class="p">(</span><span class="n">strict</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Configuration validation failed: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_extensions_by_category</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span> <span class="n">category</span><span class="p">:</span> <span class="n">DangerousExtensionCategory</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return extensions for a dangerous extension category.</span>

<span class="sd">        Args:</span>
<span class="sd">            category: The dangerous extension category.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Copy of extensions in the specified category.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">category</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_compound_extensions_by_category</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span> <span class="n">category</span><span class="p">:</span> <span class="n">CompoundExtensionCategory</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return compound extensions for a category.</span>

<span class="sd">        Args:</span>
<span class="sd">            category: The compound extension category.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Copy of compound extensions in the specified category.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">category</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_unicode_chars_by_category</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">category</span><span class="p">:</span> <span class="n">UnicodeAttackCategory</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">set</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return Unicode code points for an attack category.</span>

<span class="sd">        Args:</span>
<span class="sd">            category: The Unicode attack category.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Copy of code points in the specified category.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">category</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">is_extension_in_category</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span> <span class="n">extension</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">category</span><span class="p">:</span> <span class="n">DangerousExtensionCategory</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check if extension belongs to a dangerous category.</span>

<span class="sd">        Args:</span>
<span class="sd">            extension: File extension to evaluate.</span>
<span class="sd">            category: Category to check against.</span>

<span class="sd">        Returns:</span>
<span class="sd">            True if extension is in the category, False otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">extension</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">category</span><span class="o">.</span><span class="n">value</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_extension_category</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span> <span class="n">extension</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DangerousExtensionCategory</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the dangerous extension category for an extension.</span>

<span class="sd">        Args:</span>
<span class="sd">            extension: The file extension to evaluate.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Matching category if dangerous, None otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">extension_lower</span> <span class="o">=</span> <span class="n">extension</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">category</span> <span class="ow">in</span> <span class="n">DangerousExtensionCategory</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">extension_lower</span> <span class="ow">in</span> <span class="n">category</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">category</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">validate_configuration</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">strict</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">ConfigValidationError</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Run all configuration validation routines.</span>

<span class="sd">        Args:</span>
<span class="sd">            strict: Reserved for future behavior adjustments.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of detected validation errors.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Validate file size limits</span>
        <span class="n">errors</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">_validate_file_size_limits</span><span class="p">())</span>

        <span class="c1"># Validate MIME type configurations</span>
        <span class="n">errors</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">_validate_mime_configurations</span><span class="p">())</span>

        <span class="c1"># Validate file extension configurations</span>
        <span class="n">errors</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">_validate_extension_configurations</span><span class="p">())</span>

        <span class="c1"># Validate ZIP compression settings</span>
        <span class="n">errors</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">_validate_compression_settings</span><span class="p">())</span>

        <span class="c1"># Validate enum consistency</span>
        <span class="n">errors</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">_validate_enum_consistency</span><span class="p">())</span>

        <span class="c1"># Validate cross-configuration dependencies</span>
        <span class="n">errors</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">_validate_cross_dependencies</span><span class="p">())</span>

        <span class="k">return</span> <span class="n">errors</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_validate_file_size_limits</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">ConfigValidationError</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validate configured file size limits.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of detected configuration issues.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Check image size limits</span>
        <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">limits</span><span class="o">.</span><span class="n">max_image_size</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">ConfigValidationError</span><span class="p">(</span>
                    <span class="n">error_type</span><span class="o">=</span><span class="s2">&quot;invalid_size_limit&quot;</span><span class="p">,</span>
                    <span class="n">message</span><span class="o">=</span><span class="s2">&quot;max_image_size must be greater than 0&quot;</span><span class="p">,</span>
                    <span class="n">severity</span><span class="o">=</span><span class="s2">&quot;error&quot;</span><span class="p">,</span>
                    <span class="n">component</span><span class="o">=</span><span class="s2">&quot;file_sizes&quot;</span><span class="p">,</span>
                    <span class="n">recommendation</span><span class="o">=</span><span class="s2">&quot;Set max_image_size to a positive value (e.g., 20MB)&quot;</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">limits</span><span class="o">.</span><span class="n">max_image_size</span> <span class="o">&gt;</span> <span class="mi">100</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">:</span>  <span class="c1"># 100MB</span>
            <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">ConfigValidationError</span><span class="p">(</span>
                    <span class="n">error_type</span><span class="o">=</span><span class="s2">&quot;excessive_size_limit&quot;</span><span class="p">,</span>
                    <span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;max_image_size (</span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="n">limits</span><span class="o">.</span><span class="n">max_image_size</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="p">(</span><span class="mi">1024</span><span class="o">*</span><span class="mi">1024</span><span class="p">)</span><span class="si">}</span><span class="s2">MB) is very large&quot;</span><span class="p">,</span>
                    <span class="n">severity</span><span class="o">=</span><span class="s2">&quot;warning&quot;</span><span class="p">,</span>
                    <span class="n">component</span><span class="o">=</span><span class="s2">&quot;file_sizes&quot;</span><span class="p">,</span>
                    <span class="n">recommendation</span><span class="o">=</span><span class="s2">&quot;Consider reducing image size limit to prevent resource exhaustion&quot;</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="c1"># Check ZIP size limits</span>
        <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">limits</span><span class="o">.</span><span class="n">max_zip_size</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">ConfigValidationError</span><span class="p">(</span>
                    <span class="n">error_type</span><span class="o">=</span><span class="s2">&quot;invalid_size_limit&quot;</span><span class="p">,</span>
                    <span class="n">message</span><span class="o">=</span><span class="s2">&quot;max_zip_size must be greater than 0&quot;</span><span class="p">,</span>
                    <span class="n">severity</span><span class="o">=</span><span class="s2">&quot;error&quot;</span><span class="p">,</span>
                    <span class="n">component</span><span class="o">=</span><span class="s2">&quot;file_sizes&quot;</span><span class="p">,</span>
                    <span class="n">recommendation</span><span class="o">=</span><span class="s2">&quot;Set max_zip_size to a positive value (e.g., 500MB)&quot;</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">limits</span><span class="o">.</span><span class="n">max_zip_size</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">:</span>  <span class="c1"># 2GB</span>
            <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">ConfigValidationError</span><span class="p">(</span>
                    <span class="n">error_type</span><span class="o">=</span><span class="s2">&quot;excessive_size_limit&quot;</span><span class="p">,</span>
                    <span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;max_zip_size (</span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="n">limits</span><span class="o">.</span><span class="n">max_zip_size</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="p">(</span><span class="mi">1024</span><span class="o">*</span><span class="mi">1024</span><span class="p">)</span><span class="si">}</span><span class="s2">MB) is very large&quot;</span><span class="p">,</span>
                    <span class="n">severity</span><span class="o">=</span><span class="s2">&quot;warning&quot;</span><span class="p">,</span>
                    <span class="n">component</span><span class="o">=</span><span class="s2">&quot;file_sizes&quot;</span><span class="p">,</span>
                    <span class="n">recommendation</span><span class="o">=</span><span class="s2">&quot;Consider reducing ZIP size limit to prevent resource exhaustion&quot;</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="c1"># Validate size relationship</span>
        <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">limits</span><span class="o">.</span><span class="n">max_zip_size</span> <span class="o">&lt;=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">limits</span><span class="o">.</span><span class="n">max_image_size</span><span class="p">:</span>
            <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">ConfigValidationError</span><span class="p">(</span>
                    <span class="n">error_type</span><span class="o">=</span><span class="s2">&quot;inconsistent_size_limits&quot;</span><span class="p">,</span>
                    <span class="n">message</span><span class="o">=</span><span class="s2">&quot;max_zip_size should typically be larger than max_image_size&quot;</span><span class="p">,</span>
                    <span class="n">severity</span><span class="o">=</span><span class="s2">&quot;warning&quot;</span><span class="p">,</span>
                    <span class="n">component</span><span class="o">=</span><span class="s2">&quot;file_sizes&quot;</span><span class="p">,</span>
                    <span class="n">recommendation</span><span class="o">=</span><span class="s2">&quot;ZIP files usually contain multiple files and should have higher limits&quot;</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">errors</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_validate_mime_configurations</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">ConfigValidationError</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validate MIME type configurations.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of detected configuration issues.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Check image MIME types</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">cls</span><span class="o">.</span><span class="n">ALLOWED_IMAGE_MIMES</span><span class="p">:</span>
            <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">ConfigValidationError</span><span class="p">(</span>
                    <span class="n">error_type</span><span class="o">=</span><span class="s2">&quot;empty_mime_set&quot;</span><span class="p">,</span>
                    <span class="n">message</span><span class="o">=</span><span class="s2">&quot;ALLOWED_IMAGE_MIMES cannot be empty&quot;</span><span class="p">,</span>
                    <span class="n">severity</span><span class="o">=</span><span class="s2">&quot;error&quot;</span><span class="p">,</span>
                    <span class="n">component</span><span class="o">=</span><span class="s2">&quot;mime_types&quot;</span><span class="p">,</span>
                    <span class="n">recommendation</span><span class="o">=</span><span class="s2">&quot;Add at least one allowed image MIME type&quot;</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="c1"># Validate image MIME type format</span>
        <span class="k">for</span> <span class="n">mime_type</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">ALLOWED_IMAGE_MIMES</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">mime_type</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;image/&quot;</span><span class="p">):</span>
                <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">ConfigValidationError</span><span class="p">(</span>
                        <span class="n">error_type</span><span class="o">=</span><span class="s2">&quot;invalid_image_mime&quot;</span><span class="p">,</span>
                        <span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Image MIME type &#39;</span><span class="si">{</span><span class="n">mime_type</span><span class="si">}</span><span class="s2">&#39; should start with &#39;image/&#39;&quot;</span><span class="p">,</span>
                        <span class="n">severity</span><span class="o">=</span><span class="s2">&quot;warning&quot;</span><span class="p">,</span>
                        <span class="n">component</span><span class="o">=</span><span class="s2">&quot;mime_types&quot;</span><span class="p">,</span>
                        <span class="n">recommendation</span><span class="o">=</span><span class="s2">&quot;Use standard image MIME types like &#39;image/jpeg&#39;, &#39;image/png&#39;&quot;</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="p">)</span>

        <span class="c1"># Check ZIP MIME types</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">cls</span><span class="o">.</span><span class="n">ALLOWED_ZIP_MIMES</span><span class="p">:</span>
            <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">ConfigValidationError</span><span class="p">(</span>
                    <span class="n">error_type</span><span class="o">=</span><span class="s2">&quot;empty_mime_set&quot;</span><span class="p">,</span>
                    <span class="n">message</span><span class="o">=</span><span class="s2">&quot;ALLOWED_ZIP_MIMES cannot be empty&quot;</span><span class="p">,</span>
                    <span class="n">severity</span><span class="o">=</span><span class="s2">&quot;error&quot;</span><span class="p">,</span>
                    <span class="n">component</span><span class="o">=</span><span class="s2">&quot;mime_types&quot;</span><span class="p">,</span>
                    <span class="n">recommendation</span><span class="o">=</span><span class="s2">&quot;Add at least one allowed ZIP MIME type&quot;</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="c1"># Check for duplicate MIME types</span>
        <span class="n">all_mimes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">ALLOWED_IMAGE_MIMES</span><span class="p">)</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">ALLOWED_ZIP_MIMES</span><span class="p">)</span>
        <span class="n">duplicates</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">mime</span> <span class="k">for</span> <span class="n">mime</span> <span class="ow">in</span> <span class="n">all_mimes</span> <span class="k">if</span> <span class="n">all_mimes</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">mime</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">duplicates</span><span class="p">:</span>
            <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">ConfigValidationError</span><span class="p">(</span>
                    <span class="n">error_type</span><span class="o">=</span><span class="s2">&quot;duplicate_mime_types&quot;</span><span class="p">,</span>
                    <span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Duplicate MIME types found: </span><span class="si">{</span><span class="n">duplicates</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="n">severity</span><span class="o">=</span><span class="s2">&quot;warning&quot;</span><span class="p">,</span>
                    <span class="n">component</span><span class="o">=</span><span class="s2">&quot;mime_types&quot;</span><span class="p">,</span>
                    <span class="n">recommendation</span><span class="o">=</span><span class="s2">&quot;Remove duplicate MIME types to avoid confusion&quot;</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">errors</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_validate_extension_configurations</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">ConfigValidationError</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validate file extension configurations.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of detected configuration issues.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Check extension format</span>
        <span class="k">for</span> <span class="n">ext_set_name</span><span class="p">,</span> <span class="n">ext_set</span> <span class="ow">in</span> <span class="p">[</span>
            <span class="p">(</span><span class="s2">&quot;ALLOWED_IMAGE_EXTENSIONS&quot;</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">ALLOWED_IMAGE_EXTENSIONS</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;ALLOWED_ZIP_EXTENSIONS&quot;</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">ALLOWED_ZIP_EXTENSIONS</span><span class="p">),</span>
        <span class="p">]:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">ext_set</span><span class="p">:</span>
                <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">ConfigValidationError</span><span class="p">(</span>
                        <span class="n">error_type</span><span class="o">=</span><span class="s2">&quot;empty_extension_set&quot;</span><span class="p">,</span>
                        <span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ext_set_name</span><span class="si">}</span><span class="s2"> cannot be empty&quot;</span><span class="p">,</span>
                        <span class="n">severity</span><span class="o">=</span><span class="s2">&quot;error&quot;</span><span class="p">,</span>
                        <span class="n">component</span><span class="o">=</span><span class="s2">&quot;extensions&quot;</span><span class="p">,</span>
                        <span class="n">recommendation</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Add at least one extension to </span><span class="si">{</span><span class="n">ext_set_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="p">)</span>

            <span class="k">for</span> <span class="n">ext</span> <span class="ow">in</span> <span class="n">ext_set</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">ext</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">):</span>
                    <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="n">ConfigValidationError</span><span class="p">(</span>
                            <span class="n">error_type</span><span class="o">=</span><span class="s2">&quot;invalid_extension_format&quot;</span><span class="p">,</span>
                            <span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Extension &#39;</span><span class="si">{</span><span class="n">ext</span><span class="si">}</span><span class="s2">&#39; in </span><span class="si">{</span><span class="n">ext_set_name</span><span class="si">}</span><span class="s2"> should start with &#39;.&#39;&quot;</span><span class="p">,</span>
                            <span class="n">severity</span><span class="o">=</span><span class="s2">&quot;error&quot;</span><span class="p">,</span>
                            <span class="n">component</span><span class="o">=</span><span class="s2">&quot;extensions&quot;</span><span class="p">,</span>
                            <span class="n">recommendation</span><span class="o">=</span><span class="s2">&quot;Use format &#39;.ext&#39; for file extensions&quot;</span><span class="p">,</span>
                        <span class="p">)</span>
                    <span class="p">)</span>

        <span class="c1"># Check blocked extensions</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">cls</span><span class="o">.</span><span class="n">BLOCKED_EXTENSIONS</span><span class="p">:</span>
            <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">ConfigValidationError</span><span class="p">(</span>
                    <span class="n">error_type</span><span class="o">=</span><span class="s2">&quot;empty_blocked_extensions&quot;</span><span class="p">,</span>
                    <span class="n">message</span><span class="o">=</span><span class="s2">&quot;BLOCKED_EXTENSIONS is empty - security risk&quot;</span><span class="p">,</span>
                    <span class="n">severity</span><span class="o">=</span><span class="s2">&quot;error&quot;</span><span class="p">,</span>
                    <span class="n">component</span><span class="o">=</span><span class="s2">&quot;extensions&quot;</span><span class="p">,</span>
                    <span class="n">recommendation</span><span class="o">=</span><span class="s2">&quot;Ensure dangerous extensions are properly blocked&quot;</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="c1"># Check for overlap between allowed and blocked extensions</span>
        <span class="n">image_blocked</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">ALLOWED_IMAGE_EXTENSIONS</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">BLOCKED_EXTENSIONS</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">image_blocked</span><span class="p">:</span>
            <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">ConfigValidationError</span><span class="p">(</span>
                    <span class="n">error_type</span><span class="o">=</span><span class="s2">&quot;extension_conflict&quot;</span><span class="p">,</span>
                    <span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Image extensions </span><span class="si">{</span><span class="n">image_blocked</span><span class="si">}</span><span class="s2"> are both allowed and blocked&quot;</span><span class="p">,</span>
                    <span class="n">severity</span><span class="o">=</span><span class="s2">&quot;error&quot;</span><span class="p">,</span>
                    <span class="n">component</span><span class="o">=</span><span class="s2">&quot;extensions&quot;</span><span class="p">,</span>
                    <span class="n">recommendation</span><span class="o">=</span><span class="s2">&quot;Remove conflicts between allowed and blocked extensions&quot;</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="n">zip_blocked</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">ALLOWED_ZIP_EXTENSIONS</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">BLOCKED_EXTENSIONS</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">zip_blocked</span><span class="p">:</span>
            <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">ConfigValidationError</span><span class="p">(</span>
                    <span class="n">error_type</span><span class="o">=</span><span class="s2">&quot;extension_conflict&quot;</span><span class="p">,</span>
                    <span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;ZIP extensions </span><span class="si">{</span><span class="n">zip_blocked</span><span class="si">}</span><span class="s2"> are both allowed and blocked&quot;</span><span class="p">,</span>
                    <span class="n">severity</span><span class="o">=</span><span class="s2">&quot;error&quot;</span><span class="p">,</span>
                    <span class="n">component</span><span class="o">=</span><span class="s2">&quot;extensions&quot;</span><span class="p">,</span>
                    <span class="n">recommendation</span><span class="o">=</span><span class="s2">&quot;Remove conflicts between allowed and blocked extensions&quot;</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="c1"># Check compound extension consistency</span>
        <span class="n">compound_overlap</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">BLOCKED_EXTENSIONS</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">COMPOUND_BLOCKED_EXTENSIONS</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">compound_overlap</span><span class="p">:</span>
            <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">ConfigValidationError</span><span class="p">(</span>
                    <span class="n">error_type</span><span class="o">=</span><span class="s2">&quot;compound_extension_overlap&quot;</span><span class="p">,</span>
                    <span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Extensions </span><span class="si">{</span><span class="n">compound_overlap</span><span class="si">}</span><span class="s2"> appear in both blocked and compound blocked lists&quot;</span><span class="p">,</span>
                    <span class="n">severity</span><span class="o">=</span><span class="s2">&quot;warning&quot;</span><span class="p">,</span>
                    <span class="n">component</span><span class="o">=</span><span class="s2">&quot;extensions&quot;</span><span class="p">,</span>
                    <span class="n">recommendation</span><span class="o">=</span><span class="s2">&quot;Compound extensions should only be in COMPOUND_BLOCKED_EXTENSIONS&quot;</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">errors</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_validate_compression_settings</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">ConfigValidationError</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validate compression-related limits.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of detected configuration issues.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Validate compression ratio</span>
        <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">limits</span><span class="o">.</span><span class="n">max_compression_ratio</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">ConfigValidationError</span><span class="p">(</span>
                    <span class="n">error_type</span><span class="o">=</span><span class="s2">&quot;invalid_compression_ratio&quot;</span><span class="p">,</span>
                    <span class="n">message</span><span class="o">=</span><span class="s2">&quot;max_compression_ratio must be greater than 0&quot;</span><span class="p">,</span>
                    <span class="n">severity</span><span class="o">=</span><span class="s2">&quot;error&quot;</span><span class="p">,</span>
                    <span class="n">component</span><span class="o">=</span><span class="s2">&quot;compression&quot;</span><span class="p">,</span>
                    <span class="n">recommendation</span><span class="o">=</span><span class="s2">&quot;Set a reasonable compression ratio limit (e.g., 100:1)&quot;</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">limits</span><span class="o">.</span><span class="n">max_compression_ratio</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span>
            <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">ConfigValidationError</span><span class="p">(</span>
                    <span class="n">error_type</span><span class="o">=</span><span class="s2">&quot;too_strict_compression&quot;</span><span class="p">,</span>
                    <span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;max_compression_ratio (</span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="n">limits</span><span class="o">.</span><span class="n">max_compression_ratio</span><span class="si">}</span><span class="s2">) is very strict&quot;</span><span class="p">,</span>
                    <span class="n">severity</span><span class="o">=</span><span class="s2">&quot;warning&quot;</span><span class="p">,</span>
                    <span class="n">component</span><span class="o">=</span><span class="s2">&quot;compression&quot;</span><span class="p">,</span>
                    <span class="n">recommendation</span><span class="o">=</span><span class="s2">&quot;Consider allowing higher compression ratios for legitimate files&quot;</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">limits</span><span class="o">.</span><span class="n">max_compression_ratio</span> <span class="o">&gt;</span> <span class="mi">1000</span><span class="p">:</span>
            <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">ConfigValidationError</span><span class="p">(</span>
                    <span class="n">error_type</span><span class="o">=</span><span class="s2">&quot;too_permissive_compression&quot;</span><span class="p">,</span>
                    <span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;max_compression_ratio (</span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="n">limits</span><span class="o">.</span><span class="n">max_compression_ratio</span><span class="si">}</span><span class="s2">) may allow zip bombs&quot;</span><span class="p">,</span>
                    <span class="n">severity</span><span class="o">=</span><span class="s2">&quot;warning&quot;</span><span class="p">,</span>
                    <span class="n">component</span><span class="o">=</span><span class="s2">&quot;compression&quot;</span><span class="p">,</span>
                    <span class="n">recommendation</span><span class="o">=</span><span class="s2">&quot;Reduce compression ratio limit to prevent zip bomb attacks&quot;</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="c1"># Validate uncompressed size limit</span>
        <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">limits</span><span class="o">.</span><span class="n">max_uncompressed_size</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">ConfigValidationError</span><span class="p">(</span>
                    <span class="n">error_type</span><span class="o">=</span><span class="s2">&quot;invalid_uncompressed_size&quot;</span><span class="p">,</span>
                    <span class="n">message</span><span class="o">=</span><span class="s2">&quot;max_uncompressed_size must be greater than 0&quot;</span><span class="p">,</span>
                    <span class="n">severity</span><span class="o">=</span><span class="s2">&quot;error&quot;</span><span class="p">,</span>
                    <span class="n">component</span><span class="o">=</span><span class="s2">&quot;compression&quot;</span><span class="p">,</span>
                    <span class="n">recommendation</span><span class="o">=</span><span class="s2">&quot;Set a reasonable uncompressed size limit&quot;</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="c1"># Validate individual file size limit</span>
        <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">limits</span><span class="o">.</span><span class="n">max_individual_file_size</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">ConfigValidationError</span><span class="p">(</span>
                    <span class="n">error_type</span><span class="o">=</span><span class="s2">&quot;invalid_individual_file_size&quot;</span><span class="p">,</span>
                    <span class="n">message</span><span class="o">=</span><span class="s2">&quot;max_individual_file_size must be greater than 0&quot;</span><span class="p">,</span>
                    <span class="n">severity</span><span class="o">=</span><span class="s2">&quot;error&quot;</span><span class="p">,</span>
                    <span class="n">component</span><span class="o">=</span><span class="s2">&quot;compression&quot;</span><span class="p">,</span>
                    <span class="n">recommendation</span><span class="o">=</span><span class="s2">&quot;Set a reasonable individual file size limit&quot;</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="c1"># Check individual file size doesn&#39;t exceed total uncompressed size</span>
        <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">limits</span><span class="o">.</span><span class="n">max_individual_file_size</span> <span class="o">&gt;</span> <span class="bp">cls</span><span class="o">.</span><span class="n">limits</span><span class="o">.</span><span class="n">max_uncompressed_size</span><span class="p">:</span>
            <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">ConfigValidationError</span><span class="p">(</span>
                    <span class="n">error_type</span><span class="o">=</span><span class="s2">&quot;inconsistent_size_limits&quot;</span><span class="p">,</span>
                    <span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;max_individual_file_size (</span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="n">limits</span><span class="o">.</span><span class="n">max_individual_file_size</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="p">(</span><span class="mi">1024</span><span class="o">*</span><span class="mi">1024</span><span class="p">)</span><span class="si">}</span><span class="s2">MB) &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;exceeds max_uncompressed_size (</span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="n">limits</span><span class="o">.</span><span class="n">max_uncompressed_size</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="p">(</span><span class="mi">1024</span><span class="o">*</span><span class="mi">1024</span><span class="p">)</span><span class="si">}</span><span class="s2">MB)&quot;</span><span class="p">,</span>
                    <span class="n">severity</span><span class="o">=</span><span class="s2">&quot;warning&quot;</span><span class="p">,</span>
                    <span class="n">component</span><span class="o">=</span><span class="s2">&quot;compression&quot;</span><span class="p">,</span>
                    <span class="n">recommendation</span><span class="o">=</span><span class="s2">&quot;Individual file size limit should not exceed total uncompressed size limit&quot;</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="c1"># Validate ZIP entry limits</span>
        <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">limits</span><span class="o">.</span><span class="n">max_zip_entries</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">ConfigValidationError</span><span class="p">(</span>
                    <span class="n">error_type</span><span class="o">=</span><span class="s2">&quot;invalid_zip_entries&quot;</span><span class="p">,</span>
                    <span class="n">message</span><span class="o">=</span><span class="s2">&quot;max_zip_entries must be greater than 0&quot;</span><span class="p">,</span>
                    <span class="n">severity</span><span class="o">=</span><span class="s2">&quot;error&quot;</span><span class="p">,</span>
                    <span class="n">component</span><span class="o">=</span><span class="s2">&quot;compression&quot;</span><span class="p">,</span>
                    <span class="n">recommendation</span><span class="o">=</span><span class="s2">&quot;Set a reasonable limit for ZIP file entries&quot;</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">limits</span><span class="o">.</span><span class="n">max_zip_entries</span> <span class="o">&gt;</span> <span class="mi">100000</span><span class="p">:</span>
            <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">ConfigValidationError</span><span class="p">(</span>
                    <span class="n">error_type</span><span class="o">=</span><span class="s2">&quot;excessive_zip_entries&quot;</span><span class="p">,</span>
                    <span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;max_zip_entries (</span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="n">limits</span><span class="o">.</span><span class="n">max_zip_entries</span><span class="si">}</span><span class="s2">) is very high&quot;</span><span class="p">,</span>
                    <span class="n">severity</span><span class="o">=</span><span class="s2">&quot;warning&quot;</span><span class="p">,</span>
                    <span class="n">component</span><span class="o">=</span><span class="s2">&quot;compression&quot;</span><span class="p">,</span>
                    <span class="n">recommendation</span><span class="o">=</span><span class="s2">&quot;High entry limits may impact performance&quot;</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="c1"># Validate timeout settings</span>
        <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">limits</span><span class="o">.</span><span class="n">zip_analysis_timeout</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">ConfigValidationError</span><span class="p">(</span>
                    <span class="n">error_type</span><span class="o">=</span><span class="s2">&quot;invalid_timeout&quot;</span><span class="p">,</span>
                    <span class="n">message</span><span class="o">=</span><span class="s2">&quot;zip_analysis_timeout must be greater than 0&quot;</span><span class="p">,</span>
                    <span class="n">severity</span><span class="o">=</span><span class="s2">&quot;error&quot;</span><span class="p">,</span>
                    <span class="n">component</span><span class="o">=</span><span class="s2">&quot;compression&quot;</span><span class="p">,</span>
                    <span class="n">recommendation</span><span class="o">=</span><span class="s2">&quot;Set a reasonable timeout for ZIP analysis&quot;</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">limits</span><span class="o">.</span><span class="n">zip_analysis_timeout</span> <span class="o">&gt;</span> <span class="mi">30</span><span class="p">:</span>
            <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">ConfigValidationError</span><span class="p">(</span>
                    <span class="n">error_type</span><span class="o">=</span><span class="s2">&quot;excessive_timeout&quot;</span><span class="p">,</span>
                    <span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;zip_analysis_timeout (</span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="n">limits</span><span class="o">.</span><span class="n">zip_analysis_timeout</span><span class="si">}</span><span class="s2">s) is very long&quot;</span><span class="p">,</span>
                    <span class="n">severity</span><span class="o">=</span><span class="s2">&quot;warning&quot;</span><span class="p">,</span>
                    <span class="n">component</span><span class="o">=</span><span class="s2">&quot;compression&quot;</span><span class="p">,</span>
                    <span class="n">recommendation</span><span class="o">=</span><span class="s2">&quot;Long timeouts may impact user experience&quot;</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">errors</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_validate_enum_consistency</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">ConfigValidationError</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validate enum categories for emptiness and overlaps.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of detected configuration issues.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Check for empty enum categories</span>
        <span class="k">for</span> <span class="n">category</span> <span class="ow">in</span> <span class="n">DangerousExtensionCategory</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">category</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
                <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">ConfigValidationError</span><span class="p">(</span>
                        <span class="n">error_type</span><span class="o">=</span><span class="s2">&quot;empty_enum_category&quot;</span><span class="p">,</span>
                        <span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Extension category </span><span class="si">{</span><span class="n">category</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> is empty&quot;</span><span class="p">,</span>
                        <span class="n">severity</span><span class="o">=</span><span class="s2">&quot;warning&quot;</span><span class="p">,</span>
                        <span class="n">component</span><span class="o">=</span><span class="s2">&quot;enums&quot;</span><span class="p">,</span>
                        <span class="n">recommendation</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Add extensions to </span><span class="si">{</span><span class="n">category</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> or remove unused category&quot;</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="p">)</span>

        <span class="k">for</span> <span class="n">category</span> <span class="ow">in</span> <span class="n">CompoundExtensionCategory</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">category</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
                <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">ConfigValidationError</span><span class="p">(</span>
                        <span class="n">error_type</span><span class="o">=</span><span class="s2">&quot;empty_enum_category&quot;</span><span class="p">,</span>
                        <span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Compound extension category </span><span class="si">{</span><span class="n">category</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> is empty&quot;</span><span class="p">,</span>
                        <span class="n">severity</span><span class="o">=</span><span class="s2">&quot;warning&quot;</span><span class="p">,</span>
                        <span class="n">component</span><span class="o">=</span><span class="s2">&quot;enums&quot;</span><span class="p">,</span>
                        <span class="n">recommendation</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Add extensions to </span><span class="si">{</span><span class="n">category</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> or remove unused category&quot;</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="p">)</span>

        <span class="k">for</span> <span class="n">category</span> <span class="ow">in</span> <span class="n">UnicodeAttackCategory</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">category</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
                <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">ConfigValidationError</span><span class="p">(</span>
                        <span class="n">error_type</span><span class="o">=</span><span class="s2">&quot;empty_enum_category&quot;</span><span class="p">,</span>
                        <span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Unicode attack category </span><span class="si">{</span><span class="n">category</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> is empty&quot;</span><span class="p">,</span>
                        <span class="n">severity</span><span class="o">=</span><span class="s2">&quot;warning&quot;</span><span class="p">,</span>
                        <span class="n">component</span><span class="o">=</span><span class="s2">&quot;enums&quot;</span><span class="p">,</span>
                        <span class="n">recommendation</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Add Unicode characters to </span><span class="si">{</span><span class="n">category</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> or remove unused category&quot;</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="p">)</span>

        <span class="c1"># Check for overlapping extensions between categories</span>
        <span class="n">all_extensions_by_category</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">category</span> <span class="ow">in</span> <span class="n">DangerousExtensionCategory</span><span class="p">:</span>
            <span class="n">all_extensions_by_category</span><span class="p">[</span><span class="n">category</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">category</span><span class="o">.</span><span class="n">value</span>

        <span class="k">for</span> <span class="n">cat1_name</span><span class="p">,</span> <span class="n">cat1_exts</span> <span class="ow">in</span> <span class="n">all_extensions_by_category</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">cat2_name</span><span class="p">,</span> <span class="n">cat2_exts</span> <span class="ow">in</span> <span class="n">all_extensions_by_category</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">cat1_name</span> <span class="o">!=</span> <span class="n">cat2_name</span><span class="p">:</span>
                    <span class="n">overlap</span> <span class="o">=</span> <span class="n">cat1_exts</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">cat2_exts</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">overlap</span><span class="p">:</span>
                        <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="n">ConfigValidationError</span><span class="p">(</span>
                                <span class="n">error_type</span><span class="o">=</span><span class="s2">&quot;category_overlap&quot;</span><span class="p">,</span>
                                <span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Categories </span><span class="si">{</span><span class="n">cat1_name</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">cat2_name</span><span class="si">}</span><span class="s2"> share extensions: </span><span class="si">{</span><span class="n">overlap</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                                <span class="n">severity</span><span class="o">=</span><span class="s2">&quot;info&quot;</span><span class="p">,</span>
                                <span class="n">component</span><span class="o">=</span><span class="s2">&quot;enums&quot;</span><span class="p">,</span>
                                <span class="n">recommendation</span><span class="o">=</span><span class="s2">&quot;Consider if extensions should belong to multiple categories&quot;</span><span class="p">,</span>
                            <span class="p">)</span>
                        <span class="p">)</span>

        <span class="k">return</span> <span class="n">errors</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_validate_cross_dependencies</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">ConfigValidationError</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validate cross-field configuration constraints.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of detected configuration issues.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Check Windows reserved names format</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">WINDOWS_RESERVED_NAMES</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span><span class="o">.</span><span class="n">islower</span><span class="p">():</span>
                <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">ConfigValidationError</span><span class="p">(</span>
                        <span class="n">error_type</span><span class="o">=</span><span class="s2">&quot;case_sensitive_reserved_name&quot;</span><span class="p">,</span>
                        <span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Windows reserved name &#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; should be lowercase&quot;</span><span class="p">,</span>
                        <span class="n">severity</span><span class="o">=</span><span class="s2">&quot;warning&quot;</span><span class="p">,</span>
                        <span class="n">component</span><span class="o">=</span><span class="s2">&quot;reserved_names&quot;</span><span class="p">,</span>
                        <span class="n">recommendation</span><span class="o">=</span><span class="s2">&quot;Use lowercase for consistent case-insensitive matching&quot;</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="p">)</span>

        <span class="c1"># Validate Unicode character ranges</span>
        <span class="k">for</span> <span class="n">char_code</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">DANGEROUS_UNICODE_CHARS</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">char_code</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">ConfigValidationError</span><span class="p">(</span>
                        <span class="n">error_type</span><span class="o">=</span><span class="s2">&quot;invalid_unicode_char&quot;</span><span class="p">,</span>
                        <span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Unicode character code </span><span class="si">{</span><span class="n">char_code</span><span class="si">}</span><span class="s2"> is not an integer&quot;</span><span class="p">,</span>
                        <span class="n">severity</span><span class="o">=</span><span class="s2">&quot;error&quot;</span><span class="p">,</span>
                        <span class="n">component</span><span class="o">=</span><span class="s2">&quot;unicode&quot;</span><span class="p">,</span>
                        <span class="n">recommendation</span><span class="o">=</span><span class="s2">&quot;Use integer Unicode code points&quot;</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="n">char_code</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">char_code</span> <span class="o">&gt;</span> <span class="mh">0x10FFFF</span><span class="p">:</span>
                <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">ConfigValidationError</span><span class="p">(</span>
                        <span class="n">error_type</span><span class="o">=</span><span class="s2">&quot;invalid_unicode_range&quot;</span><span class="p">,</span>
                        <span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Unicode character code </span><span class="si">{</span><span class="n">char_code</span><span class="si">}</span><span class="s2"> is outside valid range&quot;</span><span class="p">,</span>
                        <span class="n">severity</span><span class="o">=</span><span class="s2">&quot;error&quot;</span><span class="p">,</span>
                        <span class="n">component</span><span class="o">=</span><span class="s2">&quot;unicode&quot;</span><span class="p">,</span>
                        <span class="n">recommendation</span><span class="o">=</span><span class="s2">&quot;Use valid Unicode code points (0-0x10FFFF)&quot;</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="p">)</span>

        <span class="k">return</span> <span class="n">errors</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">validate_and_report</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">strict</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validate configuration and log outcomes.</span>

<span class="sd">        Args:</span>
<span class="sd">            strict: If True, raise on errors/warnings.</span>

<span class="sd">        Raises:</span>
<span class="sd">            FileSecurityConfigurationError: If strict and issues found.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">errors</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">validate_configuration</span><span class="p">(</span><span class="n">strict</span><span class="o">=</span><span class="n">strict</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">errors</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;File security configuration validation passed&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># Separate errors by severity</span>
        <span class="n">error_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">errors</span> <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">severity</span> <span class="o">==</span> <span class="s2">&quot;error&quot;</span><span class="p">]</span>
        <span class="n">warning_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">errors</span> <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">severity</span> <span class="o">==</span> <span class="s2">&quot;warning&quot;</span><span class="p">]</span>
        <span class="n">info_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">errors</span> <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">severity</span> <span class="o">==</span> <span class="s2">&quot;info&quot;</span><span class="p">]</span>

        <span class="c1"># Log validation results</span>
        <span class="k">if</span> <span class="n">error_list</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">error</span> <span class="ow">in</span> <span class="n">error_list</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                    <span class="s2">&quot;Configuration error in </span><span class="si">%s</span><span class="s2">: </span><span class="si">%s</span><span class="s2">. </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="n">error</span><span class="o">.</span><span class="n">component</span><span class="p">,</span>
                    <span class="n">error</span><span class="o">.</span><span class="n">message</span><span class="p">,</span>
                    <span class="n">error</span><span class="o">.</span><span class="n">recommendation</span><span class="p">,</span>
                <span class="p">)</span>

        <span class="k">if</span> <span class="n">warning_list</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">warning</span> <span class="ow">in</span> <span class="n">warning_list</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="s2">&quot;Configuration warning in </span><span class="si">%s</span><span class="s2">: </span><span class="si">%s</span><span class="s2">. </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="n">warning</span><span class="o">.</span><span class="n">component</span><span class="p">,</span>
                    <span class="n">warning</span><span class="o">.</span><span class="n">message</span><span class="p">,</span>
                    <span class="n">warning</span><span class="o">.</span><span class="n">recommendation</span><span class="p">,</span>
                <span class="p">)</span>

        <span class="k">if</span> <span class="n">info_list</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">info</span> <span class="ow">in</span> <span class="n">info_list</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                    <span class="s2">&quot;Configuration info in </span><span class="si">%s</span><span class="s2">: </span><span class="si">%s</span><span class="s2">. </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="n">info</span><span class="o">.</span><span class="n">component</span><span class="p">,</span>
                    <span class="n">info</span><span class="o">.</span><span class="n">message</span><span class="p">,</span>
                    <span class="n">info</span><span class="o">.</span><span class="n">recommendation</span><span class="p">,</span>
                <span class="p">)</span>

        <span class="c1"># Raise exception if there are errors and strict mode is enabled</span>
        <span class="k">if</span> <span class="n">error_list</span> <span class="ow">and</span> <span class="n">strict</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">FileSecurityConfigurationError</span><span class="p">(</span><span class="n">error_list</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">error_list</span> <span class="ow">or</span> <span class="n">warning_list</span><span class="p">)</span> <span class="ow">and</span> <span class="n">strict</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">FileSecurityConfigurationError</span><span class="p">(</span><span class="n">error_list</span> <span class="o">+</span> <span class="n">warning_list</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="safeuploads.FileSecurityConfig.__init_subclass__" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">__init_subclass__</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">__init_subclass__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Hook for subclass creation to validate configuration.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>**kwargs</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Subclass initialization arguments.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>safeuploads/config.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">__init_subclass__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Hook for subclass creation to validate configuration.</span>

<span class="sd">    Args:</span>
<span class="sd">        **kwargs: Subclass initialization arguments.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init_subclass__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="c1"># Perform validation with warnings allowed (non-strict mode)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">validate_and_report</span><span class="p">(</span><span class="n">strict</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Configuration validation failed: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="safeuploads.FileSecurityConfig.get_compound_extensions_by_category" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">get_compound_extensions_by_category</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">get_compound_extensions_by_category</span><span class="p">(</span><span class="n">category</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Return compound extensions for a category.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>category</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="CompoundExtensionCategory (safeuploads.enums.CompoundExtensionCategory)" href="#safeuploads.CompoundExtensionCategory">CompoundExtensionCategory</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The compound extension category.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="set">set</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Copy of compound extensions in the specified category.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>safeuploads/config.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_compound_extensions_by_category</span><span class="p">(</span>
    <span class="bp">cls</span><span class="p">,</span> <span class="n">category</span><span class="p">:</span> <span class="n">CompoundExtensionCategory</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return compound extensions for a category.</span>

<span class="sd">    Args:</span>
<span class="sd">        category: The compound extension category.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Copy of compound extensions in the specified category.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">category</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="safeuploads.FileSecurityConfig.get_extension_category" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">get_extension_category</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">get_extension_category</span><span class="p">(</span><span class="n">extension</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Return the dangerous extension category for an extension.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>extension</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The file extension to evaluate.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="DangerousExtensionCategory (safeuploads.enums.DangerousExtensionCategory)" href="#safeuploads.DangerousExtensionCategory">DangerousExtensionCategory</a> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Matching category if dangerous, None otherwise.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>safeuploads/config.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_extension_category</span><span class="p">(</span>
    <span class="bp">cls</span><span class="p">,</span> <span class="n">extension</span><span class="p">:</span> <span class="nb">str</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DangerousExtensionCategory</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the dangerous extension category for an extension.</span>

<span class="sd">    Args:</span>
<span class="sd">        extension: The file extension to evaluate.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Matching category if dangerous, None otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">extension_lower</span> <span class="o">=</span> <span class="n">extension</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">category</span> <span class="ow">in</span> <span class="n">DangerousExtensionCategory</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">extension_lower</span> <span class="ow">in</span> <span class="n">category</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">category</span>
    <span class="k">return</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="safeuploads.FileSecurityConfig.get_extensions_by_category" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">get_extensions_by_category</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">get_extensions_by_category</span><span class="p">(</span><span class="n">category</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Return extensions for a dangerous extension category.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>category</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="DangerousExtensionCategory (safeuploads.enums.DangerousExtensionCategory)" href="#safeuploads.DangerousExtensionCategory">DangerousExtensionCategory</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The dangerous extension category.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="set">set</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Copy of extensions in the specified category.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>safeuploads/config.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_extensions_by_category</span><span class="p">(</span>
    <span class="bp">cls</span><span class="p">,</span> <span class="n">category</span><span class="p">:</span> <span class="n">DangerousExtensionCategory</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return extensions for a dangerous extension category.</span>

<span class="sd">    Args:</span>
<span class="sd">        category: The dangerous extension category.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Copy of extensions in the specified category.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">category</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="safeuploads.FileSecurityConfig.get_unicode_chars_by_category" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">get_unicode_chars_by_category</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">get_unicode_chars_by_category</span><span class="p">(</span><span class="n">category</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Return Unicode code points for an attack category.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>category</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="UnicodeAttackCategory (safeuploads.enums.UnicodeAttackCategory)" href="#safeuploads.UnicodeAttackCategory">UnicodeAttackCategory</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The Unicode attack category.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="set">set</span>[<span title="int">int</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Copy of code points in the specified category.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>safeuploads/config.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_unicode_chars_by_category</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">category</span><span class="p">:</span> <span class="n">UnicodeAttackCategory</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">set</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return Unicode code points for an attack category.</span>

<span class="sd">    Args:</span>
<span class="sd">        category: The Unicode attack category.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Copy of code points in the specified category.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">category</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="safeuploads.FileSecurityConfig.is_extension_in_category" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">is_extension_in_category</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">is_extension_in_category</span><span class="p">(</span><span class="n">extension</span><span class="p">,</span> <span class="n">category</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Check if extension belongs to a dangerous category.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>extension</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>File extension to evaluate.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>category</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="DangerousExtensionCategory (safeuploads.enums.DangerousExtensionCategory)" href="#safeuploads.DangerousExtensionCategory">DangerousExtensionCategory</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Category to check against.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if extension is in the category, False otherwise.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>safeuploads/config.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">is_extension_in_category</span><span class="p">(</span>
    <span class="bp">cls</span><span class="p">,</span> <span class="n">extension</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">category</span><span class="p">:</span> <span class="n">DangerousExtensionCategory</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check if extension belongs to a dangerous category.</span>

<span class="sd">    Args:</span>
<span class="sd">        extension: File extension to evaluate.</span>
<span class="sd">        category: Category to check against.</span>

<span class="sd">    Returns:</span>
<span class="sd">        True if extension is in the category, False otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">extension</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">category</span><span class="o">.</span><span class="n">value</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="safeuploads.FileSecurityConfig.validate_and_report" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">validate_and_report</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">validate_and_report</span><span class="p">(</span><span class="n">strict</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Validate configuration and log outcomes.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>strict</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, raise on errors/warnings.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="FileSecurityConfigurationError (safeuploads.exceptions.FileSecurityConfigurationError)" href="#safeuploads.FileSecurityConfigurationError">FileSecurityConfigurationError</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If strict and issues found.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>safeuploads/config.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">validate_and_report</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">strict</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validate configuration and log outcomes.</span>

<span class="sd">    Args:</span>
<span class="sd">        strict: If True, raise on errors/warnings.</span>

<span class="sd">    Raises:</span>
<span class="sd">        FileSecurityConfigurationError: If strict and issues found.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">errors</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">validate_configuration</span><span class="p">(</span><span class="n">strict</span><span class="o">=</span><span class="n">strict</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">errors</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;File security configuration validation passed&quot;</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="c1"># Separate errors by severity</span>
    <span class="n">error_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">errors</span> <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">severity</span> <span class="o">==</span> <span class="s2">&quot;error&quot;</span><span class="p">]</span>
    <span class="n">warning_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">errors</span> <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">severity</span> <span class="o">==</span> <span class="s2">&quot;warning&quot;</span><span class="p">]</span>
    <span class="n">info_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">errors</span> <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">severity</span> <span class="o">==</span> <span class="s2">&quot;info&quot;</span><span class="p">]</span>

    <span class="c1"># Log validation results</span>
    <span class="k">if</span> <span class="n">error_list</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">error</span> <span class="ow">in</span> <span class="n">error_list</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                <span class="s2">&quot;Configuration error in </span><span class="si">%s</span><span class="s2">: </span><span class="si">%s</span><span class="s2">. </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">error</span><span class="o">.</span><span class="n">component</span><span class="p">,</span>
                <span class="n">error</span><span class="o">.</span><span class="n">message</span><span class="p">,</span>
                <span class="n">error</span><span class="o">.</span><span class="n">recommendation</span><span class="p">,</span>
            <span class="p">)</span>

    <span class="k">if</span> <span class="n">warning_list</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">warning</span> <span class="ow">in</span> <span class="n">warning_list</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">&quot;Configuration warning in </span><span class="si">%s</span><span class="s2">: </span><span class="si">%s</span><span class="s2">. </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">warning</span><span class="o">.</span><span class="n">component</span><span class="p">,</span>
                <span class="n">warning</span><span class="o">.</span><span class="n">message</span><span class="p">,</span>
                <span class="n">warning</span><span class="o">.</span><span class="n">recommendation</span><span class="p">,</span>
            <span class="p">)</span>

    <span class="k">if</span> <span class="n">info_list</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">info</span> <span class="ow">in</span> <span class="n">info_list</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s2">&quot;Configuration info in </span><span class="si">%s</span><span class="s2">: </span><span class="si">%s</span><span class="s2">. </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">info</span><span class="o">.</span><span class="n">component</span><span class="p">,</span>
                <span class="n">info</span><span class="o">.</span><span class="n">message</span><span class="p">,</span>
                <span class="n">info</span><span class="o">.</span><span class="n">recommendation</span><span class="p">,</span>
            <span class="p">)</span>

    <span class="c1"># Raise exception if there are errors and strict mode is enabled</span>
    <span class="k">if</span> <span class="n">error_list</span> <span class="ow">and</span> <span class="n">strict</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">FileSecurityConfigurationError</span><span class="p">(</span><span class="n">error_list</span><span class="p">)</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">error_list</span> <span class="ow">or</span> <span class="n">warning_list</span><span class="p">)</span> <span class="ow">and</span> <span class="n">strict</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">FileSecurityConfigurationError</span><span class="p">(</span><span class="n">error_list</span> <span class="o">+</span> <span class="n">warning_list</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="safeuploads.FileSecurityConfig.validate_configuration" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">validate_configuration</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">validate_configuration</span><span class="p">(</span><span class="n">strict</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Run all configuration validation routines.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>strict</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Reserved for future behavior adjustments.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<a class="autorefs autorefs-internal" title="ConfigValidationError


  
      dataclass
   (safeuploads.exceptions.ConfigValidationError)" href="#safeuploads.ConfigValidationError">ConfigValidationError</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of detected validation errors.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>safeuploads/config.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">validate_configuration</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">strict</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">ConfigValidationError</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Run all configuration validation routines.</span>

<span class="sd">    Args:</span>
<span class="sd">        strict: Reserved for future behavior adjustments.</span>

<span class="sd">    Returns:</span>
<span class="sd">        List of detected validation errors.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Validate file size limits</span>
    <span class="n">errors</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">_validate_file_size_limits</span><span class="p">())</span>

    <span class="c1"># Validate MIME type configurations</span>
    <span class="n">errors</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">_validate_mime_configurations</span><span class="p">())</span>

    <span class="c1"># Validate file extension configurations</span>
    <span class="n">errors</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">_validate_extension_configurations</span><span class="p">())</span>

    <span class="c1"># Validate ZIP compression settings</span>
    <span class="n">errors</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">_validate_compression_settings</span><span class="p">())</span>

    <span class="c1"># Validate enum consistency</span>
    <span class="n">errors</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">_validate_enum_consistency</span><span class="p">())</span>

    <span class="c1"># Validate cross-configuration dependencies</span>
    <span class="n">errors</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">_validate_cross_dependencies</span><span class="p">())</span>

    <span class="k">return</span> <span class="n">errors</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="safeuploads.FileSecurityConfigurationError" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">FileSecurityConfigurationError</span>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="Exception">Exception</span></code></p>


        <p>Configuration validation failed with aggregated errors.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>errors</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<a class="autorefs autorefs-internal" title="ConfigValidationError


  
      dataclass
   (safeuploads.exceptions.ConfigValidationError)" href="#safeuploads.ConfigValidationError">ConfigValidationError</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of ConfigValidationError instances.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="safeuploads.FileSecurityConfigurationError.errors">errors</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of validation errors that caused failure.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="quote">
                <summary>Source code in <code>safeuploads/exceptions.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">FileSecurityConfigurationError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Configuration validation failed with aggregated errors.</span>

<span class="sd">    Args:</span>
<span class="sd">        errors: List of ConfigValidationError instances.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        errors: List of validation errors that caused failure.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">errors</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">ConfigValidationError</span><span class="p">]):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">errors</span> <span class="o">=</span> <span class="n">errors</span>
        <span class="n">error_messages</span> <span class="o">=</span> <span class="p">[</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">error</span><span class="o">.</span><span class="n">severity</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">error</span><span class="o">.</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">error</span> <span class="ow">in</span> <span class="n">errors</span>
        <span class="p">]</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Configuration validation failed: </span><span class="si">{</span><span class="s1">&#39;; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">error_messages</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="safeuploads.FileSecurityError" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">FileSecurityError</span>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="Exception">Exception</span></code></p>


        <p>Base exception for all file security validation failures.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>message</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Human-readable error description.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>error_code</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional machine-readable error code.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="safeuploads.FileSecurityError.message">message</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Human-readable error message.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="safeuploads.FileSecurityError.error_code">error_code</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Machine-readable error code from ErrorCode.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="quote">
                <summary>Source code in <code>safeuploads/exceptions.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">FileSecurityError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Base exception for all file security validation failures.</span>

<span class="sd">    Args:</span>
<span class="sd">        message: Human-readable error description.</span>
<span class="sd">        error_code: Optional machine-readable error code.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        message: Human-readable error message.</span>
<span class="sd">        error_code: Machine-readable error code from ErrorCode.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">error_code</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">message</span> <span class="o">=</span> <span class="n">message</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">error_code</span> <span class="o">=</span> <span class="n">error_code</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="safeuploads.FileSignatureError" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">FileSignatureError</span>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="FileValidationError (safeuploads.exceptions.FileValidationError)" href="#safeuploads.FileValidationError">FileValidationError</a></code></p>


        <p>File header signature invalid or mismatched.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>message</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Human-readable error description.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>filename</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional filename with signature issue.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>expected_type</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional expected file type based on extension.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="safeuploads.FileSignatureError.expected_type">expected_type</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The expected file type based on extension.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="quote">
                <summary>Source code in <code>safeuploads/exceptions.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">FileSignatureError</span><span class="p">(</span><span class="n">FileValidationError</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    File header signature invalid or mismatched.</span>

<span class="sd">    Args:</span>
<span class="sd">        message: Human-readable error description.</span>
<span class="sd">        filename: Optional filename with signature issue.</span>
<span class="sd">        expected_type: Optional expected file type based on extension.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        expected_type: The expected file type based on extension.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">message</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">expected_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">expected_type</span> <span class="o">=</span> <span class="n">expected_type</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">message</span><span class="p">,</span>
            <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span>
            <span class="n">error_code</span><span class="o">=</span><span class="n">ErrorCode</span><span class="o">.</span><span class="n">FILE_SIGNATURE_MISMATCH</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="safeuploads.FileSizeError" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">FileSizeError</span>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="FileValidationError (safeuploads.exceptions.FileValidationError)" href="#safeuploads.FileValidationError">FileValidationError</a></code></p>


        <p>File exceeds configured size limits.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>message</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Human-readable error description.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>filename</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional filename that exceeded size limits.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>size</code>
            </td>
            <td>
                  <code><span title="int">int</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional actual file size in bytes.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_size</code>
            </td>
            <td>
                  <code><span title="int">int</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional maximum allowed size in bytes.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="safeuploads.FileSizeError.size">size</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The actual file size in bytes.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="safeuploads.FileSizeError.max_size">max_size</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The maximum allowed size in bytes.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="quote">
                <summary>Source code in <code>safeuploads/exceptions.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">FileSizeError</span><span class="p">(</span><span class="n">FileValidationError</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    File exceeds configured size limits.</span>

<span class="sd">    Args:</span>
<span class="sd">        message: Human-readable error description.</span>
<span class="sd">        filename: Optional filename that exceeded size limits.</span>
<span class="sd">        size: Optional actual file size in bytes.</span>
<span class="sd">        max_size: Optional maximum allowed size in bytes.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        size: The actual file size in bytes.</span>
<span class="sd">        max_size: The maximum allowed size in bytes.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">message</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">max_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="n">size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_size</span> <span class="o">=</span> <span class="n">max_size</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">message</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span> <span class="n">error_code</span><span class="o">=</span><span class="n">ErrorCode</span><span class="o">.</span><span class="n">FILE_TOO_LARGE</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="safeuploads.FileValidationError" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">FileValidationError</span>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="FileSecurityError (safeuploads.exceptions.FileSecurityError)" href="#safeuploads.FileSecurityError">FileSecurityError</a></code></p>


        <p>File validation failed.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>message</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Human-readable error description.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>filename</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional name of the file that failed validation.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>error_code</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional machine-readable error code.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="safeuploads.FileValidationError.filename">filename</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the file that failed validation.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="quote">
                <summary>Source code in <code>safeuploads/exceptions.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">FileValidationError</span><span class="p">(</span><span class="n">FileSecurityError</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    File validation failed.</span>

<span class="sd">    Args:</span>
<span class="sd">        message: Human-readable error description.</span>
<span class="sd">        filename: Optional name of the file that failed validation.</span>
<span class="sd">        error_code: Optional machine-readable error code.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        filename: Name of the file that failed validation.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">message</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">error_code</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">error_code</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="safeuploads.FileValidator" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">FileValidator</span>


</h2>


    <div class="doc doc-contents ">


        <p>Coordinated security validation for uploaded files.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="safeuploads.FileValidator.config">config</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Active security configuration.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="safeuploads.FileValidator.unicode_validator">unicode_validator</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Validator for Unicode-related checks.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="safeuploads.FileValidator.extension_validator">extension_validator</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Validator for file extension rules.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="safeuploads.FileValidator.windows_validator">windows_validator</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Validator enforcing Windows-specific constraints.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="safeuploads.FileValidator.compression_validator">compression_validator</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Validator handling compressed file limits.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="safeuploads.FileValidator.zip_inspector">zip_inspector</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Inspector for ZIP archive contents.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="safeuploads.FileValidator.magic_mime">magic_mime</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>MIME type detector based on python-magic.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="safeuploads.FileValidator.magic_available">magic_available</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether python-magic was successfully initialized.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="quote">
                <summary>Source code in <code>safeuploads/file_validator.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">FileValidator</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Coordinated security validation for uploaded files.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        config: Active security configuration.</span>
<span class="sd">        unicode_validator: Validator for Unicode-related checks.</span>
<span class="sd">        extension_validator: Validator for file extension rules.</span>
<span class="sd">        windows_validator: Validator enforcing Windows-specific constraints.</span>
<span class="sd">        compression_validator: Validator handling compressed file limits.</span>
<span class="sd">        zip_inspector: Inspector for ZIP archive contents.</span>
<span class="sd">        magic_mime: MIME type detector based on python-magic.</span>
<span class="sd">        magic_available: Whether python-magic was successfully initialized.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">FileSecurityConfig</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize file validator with configuration and detection utilities.</span>

<span class="sd">        Args:</span>
<span class="sd">            config: Optional configuration object defining file security</span>
<span class="sd">                rules. Defaults to new FileSecurityConfig instance.</span>

<span class="sd">        Attributes:</span>
<span class="sd">            config: Active security configuration.</span>
<span class="sd">            unicode_validator: Validator for Unicode-related checks.</span>
<span class="sd">            extension_validator: Validator for file extension rules.</span>
<span class="sd">            windows_validator: Validator enforcing Windows constraints.</span>
<span class="sd">            compression_validator: Validator for compressed file limits.</span>
<span class="sd">            zip_inspector: Inspector for ZIP archive contents.</span>
<span class="sd">            magic_mime: MIME type detector based on python-magic.</span>
<span class="sd">            magic_available: Whether python-magic initialized successfully.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">config</span> <span class="ow">or</span> <span class="n">FileSecurityConfig</span><span class="p">()</span>

        <span class="c1"># Initialize specialized validators</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unicode_validator</span> <span class="o">=</span> <span class="n">UnicodeSecurityValidator</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">extension_validator</span> <span class="o">=</span> <span class="n">ExtensionSecurityValidator</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">windows_validator</span> <span class="o">=</span> <span class="n">WindowsSecurityValidator</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compression_validator</span> <span class="o">=</span> <span class="n">CompressionSecurityValidator</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zip_inspector</span> <span class="o">=</span> <span class="n">ZipContentInspector</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">)</span>

        <span class="c1"># Initialize python-magic for content-based detection</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">magic_mime</span> <span class="o">=</span> <span class="n">magic</span><span class="o">.</span><span class="n">Magic</span><span class="p">(</span><span class="n">mime</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">magic_available</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;File content detection (python-magic) initialized&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">magic_available</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">&quot;python-magic not available for content detection: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">err</span><span class="p">,</span>
            <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_detect_mime_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_content</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Determine MIME type for file content.</span>

<span class="sd">        Args:</span>
<span class="sd">            file_content: Raw bytes of the file to inspect.</span>
<span class="sd">            filename: Original filename for fallback MIME detection.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Detected MIME type or &quot;application/octet-stream&quot; if detection</span>
<span class="sd">            fails.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">detected_mime</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Content-based detection using python-magic (most reliable)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">magic_available</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">detected_mime</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">magic_mime</span><span class="o">.</span><span class="n">from_buffer</span><span class="p">(</span><span class="n">file_content</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Magic MIME detection failed: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>

        <span class="c1"># Fallback to filename-based detection</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">detected_mime</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Fallback to filename-based MIME detection&quot;</span><span class="p">)</span>
            <span class="n">detected_mime</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">mimetypes</span><span class="o">.</span><span class="n">guess_type</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">detected_mime</span> <span class="ow">or</span> <span class="s2">&quot;application/octet-stream&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_validate_file_signature</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_content</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">expected_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Verify file content begins with known signature for expected type.</span>

<span class="sd">        Args:</span>
<span class="sd">            file_content: Raw bytes of the uploaded file.</span>
<span class="sd">            expected_type: Logical file category (&quot;image&quot; or &quot;zip&quot;).</span>

<span class="sd">        Raises:</span>
<span class="sd">            FileSignatureError: File header doesn&#39;t match expected type</span>
<span class="sd">                signatures.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">file_content</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">FileSignatureError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;File too small to verify </span><span class="si">{</span><span class="n">expected_type</span><span class="si">}</span><span class="s2"> signature&quot;</span><span class="p">,</span>
                <span class="n">expected_type</span><span class="o">=</span><span class="n">expected_type</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="c1"># Common file signatures</span>
        <span class="n">signatures</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;image&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\xff\xd8\xff</span><span class="s2">&quot;</span><span class="p">,</span>  <span class="c1"># JPEG</span>
                <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\xff\xd8\xff\xe1</span><span class="s2">&quot;</span><span class="p">,</span>  <span class="c1"># JPEG EXIF (additional JPEG variant)</span>
                <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x89</span><span class="s2">PNG</span><span class="se">\r\n\x1a\n</span><span class="s2">&quot;</span><span class="p">,</span>  <span class="c1"># PNG</span>
            <span class="p">],</span>
            <span class="s2">&quot;zip&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="sa">b</span><span class="s2">&quot;PK</span><span class="se">\x03\x04</span><span class="s2">&quot;</span><span class="p">,</span>  <span class="c1"># ZIP file</span>
                <span class="sa">b</span><span class="s2">&quot;PK</span><span class="se">\x05\x06</span><span class="s2">&quot;</span><span class="p">,</span>  <span class="c1"># Empty ZIP</span>
                <span class="sa">b</span><span class="s2">&quot;PK</span><span class="se">\x07\x08</span><span class="s2">&quot;</span><span class="p">,</span>  <span class="c1"># ZIP with spanning</span>
            <span class="p">],</span>
        <span class="p">}</span>

        <span class="n">expected_signatures</span> <span class="o">=</span> <span class="n">signatures</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">expected_type</span><span class="p">,</span> <span class="p">[])</span>

        <span class="k">for</span> <span class="n">signature</span> <span class="ow">in</span> <span class="n">expected_signatures</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">file_content</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">signature</span><span class="p">):</span>
                <span class="k">return</span>  <span class="c1"># Signature matched</span>

        <span class="c1"># No matching signature found</span>
        <span class="k">raise</span> <span class="n">FileSignatureError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;File content does not match expected </span><span class="si">{</span><span class="n">expected_type</span><span class="si">}</span><span class="s2"> format&quot;</span><span class="p">,</span>
            <span class="n">expected_type</span><span class="o">=</span><span class="n">expected_type</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_sanitize_filename</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sanitize user-provided filename to prevent security risks.</span>

<span class="sd">        Args:</span>
<span class="sd">            filename: Original filename supplied by the user.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Sanitized filename safe for storage and processing.</span>

<span class="sd">        Raises:</span>
<span class="sd">            UnicodeSecurityError: Filename contains dangerous Unicode</span>
<span class="sd">                characters or fails normalization checks.</span>
<span class="sd">            WindowsReservedNameError: Filename uses Windows reserved</span>
<span class="sd">                device names.</span>
<span class="sd">            ExtensionSecurityError: Filename contains blocked or</span>
<span class="sd">                dangerous file extensions.</span>
<span class="sd">            ValueError: Filename is empty string.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">filename</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Filename cannot be empty&quot;</span><span class="p">)</span>

        <span class="c1"># Unicode security validation (must be first)</span>
        <span class="c1"># This detects and blocks Unicode-based attacks before any other processing</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unicode_validator</span><span class="o">.</span><span class="n">validate_unicode_security</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

        <span class="c1"># Remove path components to prevent directory traversal</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

        <span class="c1"># Remove null bytes and control characters</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">char</span> <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">filename</span> <span class="k">if</span> <span class="nb">ord</span><span class="p">(</span><span class="n">char</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">32</span> <span class="ow">and</span> <span class="n">char</span> <span class="o">!=</span> <span class="s2">&quot;</span><span class="se">\x7f</span><span class="s2">&quot;</span>
        <span class="p">)</span>

        <span class="c1"># Remove dangerous characters that could be used for path traversal or command injection</span>
        <span class="n">dangerous_chars</span> <span class="o">=</span> <span class="s1">&#39;&lt;&gt;:&quot;/</span><span class="se">\\</span><span class="s1">|?*</span><span class="se">\x00</span><span class="s1">&#39;</span>
        <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">dangerous_chars</span><span class="p">:</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">char</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span>

        <span class="c1"># Check for Windows reserved names before any other processing</span>
        <span class="c1"># This must be done early to prevent reserved names from being created</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">windows_validator</span><span class="o">.</span><span class="n">validate_windows_reserved_names</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

        <span class="c1"># Handle compound and double extensions security risk</span>
        <span class="c1"># This also checks all dangerous extensions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">extension_validator</span><span class="o">.</span><span class="n">validate_extensions</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

        <span class="c1"># Limit filename length (preserve extension)</span>
        <span class="n">name_part</span><span class="p">,</span> <span class="n">ext_part</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">name_part</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">:</span>
            <span class="n">name_part</span> <span class="o">=</span> <span class="n">name_part</span><span class="p">[:</span><span class="mi">100</span><span class="p">]</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">name_part</span> <span class="o">+</span> <span class="n">ext_part</span>

        <span class="c1"># Ensure we don&#39;t end up with just an extension or empty name</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">name_part</span> <span class="ow">or</span> <span class="n">name_part</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;file_</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span><span class="si">}{</span><span class="n">ext_part</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="c1"># Final check: ensure the sanitized filename doesn&#39;t become a reserved name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">windows_validator</span><span class="o">.</span><span class="n">validate_windows_reserved_names</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="s2">&quot;Filename sanitized: original=&#39;</span><span class="si">%s</span><span class="s2">&#39; -&gt; sanitized=&#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span><span class="p">,</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">filename</span> <span class="k">if</span> <span class="n">filename</span> <span class="k">else</span> <span class="s2">&quot;None&quot;</span><span class="p">),</span>
            <span class="n">filename</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">filename</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_validate_filename</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="p">:</span> <span class="n">UploadFile</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validate filename of uploaded file and sanitize it in place.</span>

<span class="sd">        Args:</span>
<span class="sd">            file: Uploaded file whose filename should be validated and</span>
<span class="sd">                sanitized.</span>

<span class="sd">        Raises:</span>
<span class="sd">            FilenameSecurityError: Filename is empty, invalid, or fails</span>
<span class="sd">                sanitization.</span>
<span class="sd">            FileProcessingError: Unexpected error during filename</span>
<span class="sd">                validation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Check filename</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">file</span><span class="o">.</span><span class="n">filename</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">FilenameSecurityError</span><span class="p">(</span>
                <span class="s2">&quot;Filename is required&quot;</span><span class="p">,</span>
                <span class="n">error_code</span><span class="o">=</span><span class="n">ErrorCode</span><span class="o">.</span><span class="n">FILENAME_EMPTY</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="c1"># Sanitize the filename to prevent security issues</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">sanitized_filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sanitize_filename</span><span class="p">(</span><span class="n">file</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>

            <span class="c1"># Update the file object with sanitized filename</span>
            <span class="n">file</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">sanitized_filename</span>

            <span class="c1"># Additional validation after sanitization</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">sanitized_filename</span> <span class="ow">or</span> <span class="n">sanitized_filename</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">FilenameSecurityError</span><span class="p">(</span>
                    <span class="s2">&quot;Invalid filename after sanitization&quot;</span><span class="p">,</span>
                    <span class="n">filename</span><span class="o">=</span><span class="n">file</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span>
                    <span class="n">error_code</span><span class="o">=</span><span class="n">ErrorCode</span><span class="o">.</span><span class="n">FILENAME_INVALID</span><span class="p">,</span>
                <span class="p">)</span>
        <span class="k">except</span> <span class="n">FileValidationError</span><span class="p">:</span>
            <span class="c1"># Let FileValidationError and subclasses propagate</span>
            <span class="k">raise</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Unexpected error during filename validation: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">FileProcessingError</span><span class="p">(</span>
                <span class="s2">&quot;Filename validation failed due to internal error&quot;</span><span class="p">,</span>
                <span class="n">original_error</span><span class="o">=</span><span class="n">err</span><span class="p">,</span>
            <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">err</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_validate_file_extension</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="p">:</span> <span class="n">UploadFile</span><span class="p">,</span> <span class="n">allowed_extensions</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validate extension of uploaded file against allowed and blocked lists.</span>

<span class="sd">        Args:</span>
<span class="sd">            file: File whose extension will be validated.</span>
<span class="sd">            allowed_extensions: Set of allowed file extensions.</span>

<span class="sd">        Raises:</span>
<span class="sd">            FilenameSecurityError: Filename is missing.</span>
<span class="sd">            ExtensionSecurityError: Extension is not allowed or is blocked.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Check file extension</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">file</span><span class="o">.</span><span class="n">filename</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">FilenameSecurityError</span><span class="p">(</span>
                <span class="s2">&quot;Filename is required for extension validation&quot;</span><span class="p">,</span>
                <span class="n">error_code</span><span class="o">=</span><span class="n">ErrorCode</span><span class="o">.</span><span class="n">FILENAME_EMPTY</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="n">_</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">file</span><span class="o">.</span><span class="n">filename</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">ext</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">allowed_extensions</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ExtensionSecurityError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Invalid file extension. Allowed: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">allowed_extensions</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">filename</span><span class="o">=</span><span class="n">file</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span>
                <span class="n">extension</span><span class="o">=</span><span class="n">ext</span><span class="p">,</span>
                <span class="n">error_code</span><span class="o">=</span><span class="n">ErrorCode</span><span class="o">.</span><span class="n">EXTENSION_NOT_ALLOWED</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="c1"># Check for blocked extensions</span>
        <span class="k">if</span> <span class="n">ext</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">BLOCKED_EXTENSIONS</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ExtensionSecurityError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;File extension </span><span class="si">{</span><span class="n">ext</span><span class="si">}</span><span class="s2"> is blocked for security reasons&quot;</span><span class="p">,</span>
                <span class="n">filename</span><span class="o">=</span><span class="n">file</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span>
                <span class="n">extension</span><span class="o">=</span><span class="n">ext</span><span class="p">,</span>
                <span class="n">error_code</span><span class="o">=</span><span class="n">ErrorCode</span><span class="o">.</span><span class="n">EXTENSION_BLOCKED</span><span class="p">,</span>
            <span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_validate_file_size</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="p">:</span> <span class="n">UploadFile</span><span class="p">,</span> <span class="n">max_file_size</span><span class="p">:</span> <span class="nb">int</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">bytes</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validate uploaded file size by sampling content and determining total bytes.</span>

<span class="sd">        Args:</span>
<span class="sd">            file: Uploaded file supporting asynchronous read and seek.</span>
<span class="sd">            max_file_size: Maximum allowed file size in bytes.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Tuple containing first 8 KB of file content and detected file</span>
<span class="sd">            size in bytes.</span>

<span class="sd">        Raises:</span>
<span class="sd">            FileSizeError: File size exceeds maximum or file is empty.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Read first chunk for content analysis</span>
        <span class="n">file_content</span> <span class="o">=</span> <span class="k">await</span> <span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">8192</span><span class="p">)</span>  <span class="c1"># Read first 8KB</span>

        <span class="c1"># Reset file position</span>
        <span class="k">await</span> <span class="n">file</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="c1"># Check file size</span>
        <span class="n">file_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">file_content</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="s2">&quot;size&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">file</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
            <span class="n">file_size</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">size</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Estimate size by reading the rest</span>
            <span class="n">remaining</span> <span class="o">=</span> <span class="k">await</span> <span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="n">file_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">file_content</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">remaining</span><span class="p">)</span>
            <span class="k">await</span> <span class="n">file</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">file_size</span> <span class="o">&gt;</span> <span class="n">max_file_size</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">FileSizeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;File too large. File size: </span><span class="si">{</span><span class="n">file_size</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="p">(</span><span class="mi">1024</span><span class="o">*</span><span class="mi">1024</span><span class="p">)</span><span class="si">}</span><span class="s2">MB, maximum: </span><span class="si">{</span><span class="n">max_file_size</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="p">(</span><span class="mi">1024</span><span class="o">*</span><span class="mi">1024</span><span class="p">)</span><span class="si">}</span><span class="s2">MB&quot;</span><span class="p">,</span>
                <span class="n">size</span><span class="o">=</span><span class="n">file_size</span><span class="p">,</span>
                <span class="n">max_size</span><span class="o">=</span><span class="n">max_file_size</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">file_size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">FileSizeError</span><span class="p">(</span>
                <span class="s2">&quot;Empty file not allowed&quot;</span><span class="p">,</span>
                <span class="n">size</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">max_size</span><span class="o">=</span><span class="n">max_file_size</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">file_content</span><span class="p">,</span> <span class="n">file_size</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">validate_image_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="p">:</span> <span class="n">UploadFile</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validate uploaded image by checking filename, extension, size, MIME type, and signature.</span>

<span class="sd">        Args:</span>
<span class="sd">            file: Uploaded file to validate.</span>

<span class="sd">        Raises:</span>
<span class="sd">            FilenameSecurityError: Filename is empty, invalid, or fails</span>
<span class="sd">                security checks.</span>
<span class="sd">            ExtensionSecurityError: File extension is not allowed or is</span>
<span class="sd">                blocked.</span>
<span class="sd">            FileSizeError: File size exceeds maximum or file is empty.</span>
<span class="sd">            MimeTypeError: MIME type is not in allowed image types.</span>
<span class="sd">            FileSignatureError: File signature doesn&#39;t match expected image</span>
<span class="sd">                format.</span>
<span class="sd">            FileProcessingError: Unexpected error during validation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Validate filename (raises exceptions on failure)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_validate_filename</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>

            <span class="c1"># Validate file extension (raises exceptions on failure)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_validate_file_extension</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">ALLOWED_IMAGE_EXTENSIONS</span><span class="p">)</span>

            <span class="c1"># Validate file size (raises exceptions on failure, returns content and size on success)</span>
            <span class="n">file_content</span><span class="p">,</span> <span class="n">file_size</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_file_size</span><span class="p">(</span>
                <span class="n">file</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">limits</span><span class="o">.</span><span class="n">max_image_size</span>
            <span class="p">)</span>

            <span class="c1"># Detect MIME type</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">filename</span> <span class="ow">or</span> <span class="s2">&quot;unknown&quot;</span>
            <span class="n">detected_mime</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_detect_mime_type</span><span class="p">(</span><span class="n">file_content</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">detected_mime</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">ALLOWED_IMAGE_MIMES</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">MimeTypeError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Invalid file type. Detected: </span><span class="si">{</span><span class="n">detected_mime</span><span class="si">}</span><span class="s2">. Allowed: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">ALLOWED_IMAGE_MIMES</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span>
                    <span class="n">detected_mime</span><span class="o">=</span><span class="n">detected_mime</span><span class="p">,</span>
                    <span class="n">allowed_mimes</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">ALLOWED_IMAGE_MIMES</span><span class="p">),</span>
                <span class="p">)</span>

            <span class="c1"># Validate file signature (raises exceptions on failure)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_validate_file_signature</span><span class="p">(</span><span class="n">file_content</span><span class="p">,</span> <span class="s2">&quot;image&quot;</span><span class="p">)</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                <span class="s2">&quot;Image file validation passed: </span><span class="si">%s</span><span class="s2"> (</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2"> bytes)&quot;</span><span class="p">,</span>
                <span class="n">filename</span><span class="p">,</span>
                <span class="n">detected_mime</span><span class="p">,</span>
                <span class="n">file_size</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="n">FileValidationError</span><span class="p">:</span>
            <span class="c1"># Let FileValidationError and subclasses propagate</span>
            <span class="k">raise</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Error during image file validation: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">FileProcessingError</span><span class="p">(</span>
                <span class="s2">&quot;File validation failed due to internal error&quot;</span><span class="p">,</span>
                <span class="n">original_error</span><span class="o">=</span><span class="n">err</span><span class="p">,</span>
            <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">err</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">validate_zip_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="p">:</span> <span class="n">UploadFile</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validate uploaded ZIP archive against service configuration.</span>

<span class="sd">        Args:</span>
<span class="sd">            file: Incoming ZIP file-like object to validate.</span>

<span class="sd">        Raises:</span>
<span class="sd">            FilenameSecurityError: Filename is empty, invalid, or fails</span>
<span class="sd">                security checks.</span>
<span class="sd">            ExtensionSecurityError: File extension is not allowed or is</span>
<span class="sd">                blocked.</span>
<span class="sd">            FileSizeError: File size exceeds maximum or file is empty.</span>
<span class="sd">            MimeTypeError: MIME type is not in allowed ZIP types.</span>
<span class="sd">            FileSignatureError: File signature doesn&#39;t match expected ZIP</span>
<span class="sd">                format.</span>
<span class="sd">            CompressionSecurityError: ZIP compression validation failed</span>
<span class="sd">                (zip bomb detected).</span>
<span class="sd">            FileProcessingError: Unexpected error during validation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Validate filename (raises exceptions on failure)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_validate_filename</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>

            <span class="c1"># Validate file extension (raises exceptions on failure)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_validate_file_extension</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">ALLOWED_ZIP_EXTENSIONS</span><span class="p">)</span>

            <span class="c1"># Validate file size (raises exceptions on failure, returns content and size on success)</span>
            <span class="n">file_content</span><span class="p">,</span> <span class="n">file_size</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_file_size</span><span class="p">(</span>
                <span class="n">file</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">limits</span><span class="o">.</span><span class="n">max_zip_size</span>
            <span class="p">)</span>

            <span class="c1"># Detect MIME type using first 8KB</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">filename</span> <span class="ow">or</span> <span class="s2">&quot;unknown&quot;</span>
            <span class="n">detected_mime</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_detect_mime_type</span><span class="p">(</span><span class="n">file_content</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>

            <span class="c1"># Validate ZIP file signature first (most reliable check)</span>
            <span class="c1"># This will raise FileSignatureError if signature doesn&#39;t match</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_validate_file_signature</span><span class="p">(</span><span class="n">file_content</span><span class="p">,</span> <span class="s2">&quot;zip&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">FileSignatureError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                <span class="c1"># Re-raise with more specific message</span>
                <span class="k">raise</span> <span class="n">FileSignatureError</span><span class="p">(</span>
                    <span class="s2">&quot;File content does not match ZIP format&quot;</span><span class="p">,</span>
                    <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span>
                    <span class="n">expected_type</span><span class="o">=</span><span class="s2">&quot;zip&quot;</span><span class="p">,</span>
                <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">err</span>

            <span class="c1"># Check MIME type, but allow application/octet-stream if signature is valid</span>
            <span class="c1"># Some ZIP files are detected as octet-stream, but signature check ensures it&#39;s really a ZIP</span>
            <span class="k">if</span> <span class="n">detected_mime</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">ALLOWED_ZIP_MIMES</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">detected_mime</span> <span class="o">==</span> <span class="s2">&quot;application/octet-stream&quot;</span><span class="p">:</span>
                    <span class="c1"># Valid ZIP file, just detected as generic binary</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                        <span class="s2">&quot;ZIP file detected as application/octet-stream, but signature is valid: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
                        <span class="n">filename</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">MimeTypeError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Invalid file type. Detected: </span><span class="si">{</span><span class="n">detected_mime</span><span class="si">}</span><span class="s2">. Expected ZIP file.&quot;</span><span class="p">,</span>
                        <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span>
                        <span class="n">detected_mime</span><span class="o">=</span><span class="n">detected_mime</span><span class="p">,</span>
                        <span class="n">allowed_mimes</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">ALLOWED_ZIP_MIMES</span><span class="p">),</span>
                    <span class="p">)</span>

            <span class="c1"># For ZIP validation (compression ratio and content inspection), we need the full file</span>
            <span class="c1"># Read the entire file content for proper ZIP analysis</span>
            <span class="k">await</span> <span class="n">file</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">full_file_content</span> <span class="o">=</span> <span class="k">await</span> <span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="n">file_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">full_file_content</span><span class="p">)</span>

            <span class="c1"># Reset file position for any subsequent operations</span>
            <span class="k">await</span> <span class="n">file</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

            <span class="c1"># Validate ZIP compression ratio to detect zip bombs</span>
            <span class="k">if</span> <span class="n">file_size</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">compression_validator</span><span class="o">.</span><span class="n">validate_zip_compression_ratio</span><span class="p">(</span>
                    <span class="n">full_file_content</span><span class="p">,</span> <span class="n">file_size</span>
                <span class="p">)</span>

            <span class="c1"># Perform ZIP content inspection if enabled</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">limits</span><span class="o">.</span><span class="n">scan_zip_content</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">zip_inspector</span><span class="o">.</span><span class="n">inspect_zip_content</span><span class="p">(</span><span class="n">full_file_content</span><span class="p">)</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                <span class="s2">&quot;ZIP file validation passed: </span><span class="si">%s</span><span class="s2"> (</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2"> bytes)&quot;</span><span class="p">,</span>
                <span class="n">filename</span><span class="p">,</span>
                <span class="n">detected_mime</span><span class="p">,</span>
                <span class="n">file_size</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="n">FileValidationError</span><span class="p">:</span>
            <span class="c1"># Let FileValidationError and subclasses propagate</span>
            <span class="k">raise</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Error during ZIP file validation: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">FileProcessingError</span><span class="p">(</span>
                <span class="s2">&quot;File validation failed due to internal error&quot;</span><span class="p">,</span>
                <span class="n">original_error</span><span class="o">=</span><span class="n">err</span><span class="p">,</span>
            <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">err</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="safeuploads.FileValidator.__init__" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">__init__</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">__init__</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Initialize file validator with configuration and detection utilities.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>config</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="FileSecurityConfig (safeuploads.config.FileSecurityConfig)" href="#safeuploads.FileSecurityConfig">FileSecurityConfig</a> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional configuration object defining file security
rules. Defaults to new FileSecurityConfig instance.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="safeuploads.FileValidator.__init__.config">config</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Active security configuration.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="safeuploads.FileValidator.__init__.unicode_validator">unicode_validator</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Validator for Unicode-related checks.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="safeuploads.FileValidator.__init__.extension_validator">extension_validator</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Validator for file extension rules.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="safeuploads.FileValidator.__init__.windows_validator">windows_validator</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Validator enforcing Windows constraints.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="safeuploads.FileValidator.__init__.compression_validator">compression_validator</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Validator for compressed file limits.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="safeuploads.FileValidator.__init__.zip_inspector">zip_inspector</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Inspector for ZIP archive contents.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="safeuploads.FileValidator.__init__.magic_mime">magic_mime</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>MIME type detector based on python-magic.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="safeuploads.FileValidator.__init__.magic_available">magic_available</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether python-magic initialized successfully.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>safeuploads/file_validator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">FileSecurityConfig</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Initialize file validator with configuration and detection utilities.</span>

<span class="sd">    Args:</span>
<span class="sd">        config: Optional configuration object defining file security</span>
<span class="sd">            rules. Defaults to new FileSecurityConfig instance.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        config: Active security configuration.</span>
<span class="sd">        unicode_validator: Validator for Unicode-related checks.</span>
<span class="sd">        extension_validator: Validator for file extension rules.</span>
<span class="sd">        windows_validator: Validator enforcing Windows constraints.</span>
<span class="sd">        compression_validator: Validator for compressed file limits.</span>
<span class="sd">        zip_inspector: Inspector for ZIP archive contents.</span>
<span class="sd">        magic_mime: MIME type detector based on python-magic.</span>
<span class="sd">        magic_available: Whether python-magic initialized successfully.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">config</span> <span class="ow">or</span> <span class="n">FileSecurityConfig</span><span class="p">()</span>

    <span class="c1"># Initialize specialized validators</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">unicode_validator</span> <span class="o">=</span> <span class="n">UnicodeSecurityValidator</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">extension_validator</span> <span class="o">=</span> <span class="n">ExtensionSecurityValidator</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">windows_validator</span> <span class="o">=</span> <span class="n">WindowsSecurityValidator</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">compression_validator</span> <span class="o">=</span> <span class="n">CompressionSecurityValidator</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">zip_inspector</span> <span class="o">=</span> <span class="n">ZipContentInspector</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">)</span>

    <span class="c1"># Initialize python-magic for content-based detection</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">magic_mime</span> <span class="o">=</span> <span class="n">magic</span><span class="o">.</span><span class="n">Magic</span><span class="p">(</span><span class="n">mime</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">magic_available</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;File content detection (python-magic) initialized&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">magic_available</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
            <span class="s2">&quot;python-magic not available for content detection: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">err</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="safeuploads.FileValidator.validate_image_file" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">validate_image_file</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">validate_image_file</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Validate uploaded image by checking filename, extension, size, MIME type, and signature.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>file</code>
            </td>
            <td>
                  <code><span title="safeuploads.protocols.UploadFileProtocol">UploadFileProtocol</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Uploaded file to validate.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="FilenameSecurityError (safeuploads.exceptions.FilenameSecurityError)" href="#safeuploads.FilenameSecurityError">FilenameSecurityError</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Filename is empty, invalid, or fails
security checks.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="ExtensionSecurityError (safeuploads.exceptions.ExtensionSecurityError)" href="#safeuploads.ExtensionSecurityError">ExtensionSecurityError</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>File extension is not allowed or is
blocked.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="FileSizeError (safeuploads.exceptions.FileSizeError)" href="#safeuploads.FileSizeError">FileSizeError</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>File size exceeds maximum or file is empty.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="MimeTypeError (safeuploads.exceptions.MimeTypeError)" href="#safeuploads.MimeTypeError">MimeTypeError</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>MIME type is not in allowed image types.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="FileSignatureError (safeuploads.exceptions.FileSignatureError)" href="#safeuploads.FileSignatureError">FileSignatureError</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>File signature doesn't match expected image
format.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="FileProcessingError (safeuploads.exceptions.FileProcessingError)" href="#safeuploads.FileProcessingError">FileProcessingError</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Unexpected error during validation.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>safeuploads/file_validator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">validate_image_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="p">:</span> <span class="n">UploadFile</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validate uploaded image by checking filename, extension, size, MIME type, and signature.</span>

<span class="sd">    Args:</span>
<span class="sd">        file: Uploaded file to validate.</span>

<span class="sd">    Raises:</span>
<span class="sd">        FilenameSecurityError: Filename is empty, invalid, or fails</span>
<span class="sd">            security checks.</span>
<span class="sd">        ExtensionSecurityError: File extension is not allowed or is</span>
<span class="sd">            blocked.</span>
<span class="sd">        FileSizeError: File size exceeds maximum or file is empty.</span>
<span class="sd">        MimeTypeError: MIME type is not in allowed image types.</span>
<span class="sd">        FileSignatureError: File signature doesn&#39;t match expected image</span>
<span class="sd">            format.</span>
<span class="sd">        FileProcessingError: Unexpected error during validation.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Validate filename (raises exceptions on failure)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_filename</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>

        <span class="c1"># Validate file extension (raises exceptions on failure)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_file_extension</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">ALLOWED_IMAGE_EXTENSIONS</span><span class="p">)</span>

        <span class="c1"># Validate file size (raises exceptions on failure, returns content and size on success)</span>
        <span class="n">file_content</span><span class="p">,</span> <span class="n">file_size</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_file_size</span><span class="p">(</span>
            <span class="n">file</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">limits</span><span class="o">.</span><span class="n">max_image_size</span>
        <span class="p">)</span>

        <span class="c1"># Detect MIME type</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">filename</span> <span class="ow">or</span> <span class="s2">&quot;unknown&quot;</span>
        <span class="n">detected_mime</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_detect_mime_type</span><span class="p">(</span><span class="n">file_content</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">detected_mime</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">ALLOWED_IMAGE_MIMES</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">MimeTypeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Invalid file type. Detected: </span><span class="si">{</span><span class="n">detected_mime</span><span class="si">}</span><span class="s2">. Allowed: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">ALLOWED_IMAGE_MIMES</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span>
                <span class="n">detected_mime</span><span class="o">=</span><span class="n">detected_mime</span><span class="p">,</span>
                <span class="n">allowed_mimes</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">ALLOWED_IMAGE_MIMES</span><span class="p">),</span>
            <span class="p">)</span>

        <span class="c1"># Validate file signature (raises exceptions on failure)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_file_signature</span><span class="p">(</span><span class="n">file_content</span><span class="p">,</span> <span class="s2">&quot;image&quot;</span><span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="s2">&quot;Image file validation passed: </span><span class="si">%s</span><span class="s2"> (</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2"> bytes)&quot;</span><span class="p">,</span>
            <span class="n">filename</span><span class="p">,</span>
            <span class="n">detected_mime</span><span class="p">,</span>
            <span class="n">file_size</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">except</span> <span class="n">FileValidationError</span><span class="p">:</span>
        <span class="c1"># Let FileValidationError and subclasses propagate</span>
        <span class="k">raise</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Error during image file validation: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">FileProcessingError</span><span class="p">(</span>
            <span class="s2">&quot;File validation failed due to internal error&quot;</span><span class="p">,</span>
            <span class="n">original_error</span><span class="o">=</span><span class="n">err</span><span class="p">,</span>
        <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">err</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="safeuploads.FileValidator.validate_zip_file" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">validate_zip_file</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">validate_zip_file</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Validate uploaded ZIP archive against service configuration.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>file</code>
            </td>
            <td>
                  <code><span title="safeuploads.protocols.UploadFileProtocol">UploadFileProtocol</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Incoming ZIP file-like object to validate.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="FilenameSecurityError (safeuploads.exceptions.FilenameSecurityError)" href="#safeuploads.FilenameSecurityError">FilenameSecurityError</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Filename is empty, invalid, or fails
security checks.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="ExtensionSecurityError (safeuploads.exceptions.ExtensionSecurityError)" href="#safeuploads.ExtensionSecurityError">ExtensionSecurityError</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>File extension is not allowed or is
blocked.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="FileSizeError (safeuploads.exceptions.FileSizeError)" href="#safeuploads.FileSizeError">FileSizeError</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>File size exceeds maximum or file is empty.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="MimeTypeError (safeuploads.exceptions.MimeTypeError)" href="#safeuploads.MimeTypeError">MimeTypeError</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>MIME type is not in allowed ZIP types.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="FileSignatureError (safeuploads.exceptions.FileSignatureError)" href="#safeuploads.FileSignatureError">FileSignatureError</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>File signature doesn't match expected ZIP
format.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="CompressionSecurityError (safeuploads.exceptions.CompressionSecurityError)" href="#safeuploads.CompressionSecurityError">CompressionSecurityError</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>ZIP compression validation failed
(zip bomb detected).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="FileProcessingError (safeuploads.exceptions.FileProcessingError)" href="#safeuploads.FileProcessingError">FileProcessingError</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Unexpected error during validation.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>safeuploads/file_validator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">validate_zip_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="p">:</span> <span class="n">UploadFile</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validate uploaded ZIP archive against service configuration.</span>

<span class="sd">    Args:</span>
<span class="sd">        file: Incoming ZIP file-like object to validate.</span>

<span class="sd">    Raises:</span>
<span class="sd">        FilenameSecurityError: Filename is empty, invalid, or fails</span>
<span class="sd">            security checks.</span>
<span class="sd">        ExtensionSecurityError: File extension is not allowed or is</span>
<span class="sd">            blocked.</span>
<span class="sd">        FileSizeError: File size exceeds maximum or file is empty.</span>
<span class="sd">        MimeTypeError: MIME type is not in allowed ZIP types.</span>
<span class="sd">        FileSignatureError: File signature doesn&#39;t match expected ZIP</span>
<span class="sd">            format.</span>
<span class="sd">        CompressionSecurityError: ZIP compression validation failed</span>
<span class="sd">            (zip bomb detected).</span>
<span class="sd">        FileProcessingError: Unexpected error during validation.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Validate filename (raises exceptions on failure)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_filename</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>

        <span class="c1"># Validate file extension (raises exceptions on failure)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_file_extension</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">ALLOWED_ZIP_EXTENSIONS</span><span class="p">)</span>

        <span class="c1"># Validate file size (raises exceptions on failure, returns content and size on success)</span>
        <span class="n">file_content</span><span class="p">,</span> <span class="n">file_size</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_file_size</span><span class="p">(</span>
            <span class="n">file</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">limits</span><span class="o">.</span><span class="n">max_zip_size</span>
        <span class="p">)</span>

        <span class="c1"># Detect MIME type using first 8KB</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">filename</span> <span class="ow">or</span> <span class="s2">&quot;unknown&quot;</span>
        <span class="n">detected_mime</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_detect_mime_type</span><span class="p">(</span><span class="n">file_content</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>

        <span class="c1"># Validate ZIP file signature first (most reliable check)</span>
        <span class="c1"># This will raise FileSignatureError if signature doesn&#39;t match</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_validate_file_signature</span><span class="p">(</span><span class="n">file_content</span><span class="p">,</span> <span class="s2">&quot;zip&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">FileSignatureError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="c1"># Re-raise with more specific message</span>
            <span class="k">raise</span> <span class="n">FileSignatureError</span><span class="p">(</span>
                <span class="s2">&quot;File content does not match ZIP format&quot;</span><span class="p">,</span>
                <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span>
                <span class="n">expected_type</span><span class="o">=</span><span class="s2">&quot;zip&quot;</span><span class="p">,</span>
            <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">err</span>

        <span class="c1"># Check MIME type, but allow application/octet-stream if signature is valid</span>
        <span class="c1"># Some ZIP files are detected as octet-stream, but signature check ensures it&#39;s really a ZIP</span>
        <span class="k">if</span> <span class="n">detected_mime</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">ALLOWED_ZIP_MIMES</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">detected_mime</span> <span class="o">==</span> <span class="s2">&quot;application/octet-stream&quot;</span><span class="p">:</span>
                <span class="c1"># Valid ZIP file, just detected as generic binary</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                    <span class="s2">&quot;ZIP file detected as application/octet-stream, but signature is valid: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="n">filename</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">MimeTypeError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Invalid file type. Detected: </span><span class="si">{</span><span class="n">detected_mime</span><span class="si">}</span><span class="s2">. Expected ZIP file.&quot;</span><span class="p">,</span>
                    <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span>
                    <span class="n">detected_mime</span><span class="o">=</span><span class="n">detected_mime</span><span class="p">,</span>
                    <span class="n">allowed_mimes</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">ALLOWED_ZIP_MIMES</span><span class="p">),</span>
                <span class="p">)</span>

        <span class="c1"># For ZIP validation (compression ratio and content inspection), we need the full file</span>
        <span class="c1"># Read the entire file content for proper ZIP analysis</span>
        <span class="k">await</span> <span class="n">file</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">full_file_content</span> <span class="o">=</span> <span class="k">await</span> <span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="n">file_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">full_file_content</span><span class="p">)</span>

        <span class="c1"># Reset file position for any subsequent operations</span>
        <span class="k">await</span> <span class="n">file</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="c1"># Validate ZIP compression ratio to detect zip bombs</span>
        <span class="k">if</span> <span class="n">file_size</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">compression_validator</span><span class="o">.</span><span class="n">validate_zip_compression_ratio</span><span class="p">(</span>
                <span class="n">full_file_content</span><span class="p">,</span> <span class="n">file_size</span>
            <span class="p">)</span>

        <span class="c1"># Perform ZIP content inspection if enabled</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">limits</span><span class="o">.</span><span class="n">scan_zip_content</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">zip_inspector</span><span class="o">.</span><span class="n">inspect_zip_content</span><span class="p">(</span><span class="n">full_file_content</span><span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="s2">&quot;ZIP file validation passed: </span><span class="si">%s</span><span class="s2"> (</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2"> bytes)&quot;</span><span class="p">,</span>
            <span class="n">filename</span><span class="p">,</span>
            <span class="n">detected_mime</span><span class="p">,</span>
            <span class="n">file_size</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">except</span> <span class="n">FileValidationError</span><span class="p">:</span>
        <span class="c1"># Let FileValidationError and subclasses propagate</span>
        <span class="k">raise</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Error during ZIP file validation: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">FileProcessingError</span><span class="p">(</span>
            <span class="s2">&quot;File validation failed due to internal error&quot;</span><span class="p">,</span>
            <span class="n">original_error</span><span class="o">=</span><span class="n">err</span><span class="p">,</span>
        <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">err</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="safeuploads.FilenameSecurityError" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">FilenameSecurityError</span>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="FileValidationError (safeuploads.exceptions.FileValidationError)" href="#safeuploads.FileValidationError">FileValidationError</a></code></p>


        <p>Filename failed security checks.</p>








              <details class="quote">
                <summary>Source code in <code>safeuploads/exceptions.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">FilenameSecurityError</span><span class="p">(</span><span class="n">FileValidationError</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Filename failed security checks.&quot;&quot;&quot;</span>

    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="safeuploads.MimeTypeError" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">MimeTypeError</span>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="FileValidationError (safeuploads.exceptions.FileValidationError)" href="#safeuploads.FileValidationError">FileValidationError</a></code></p>


        <p>File MIME type not allowed or mismatches extension.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>message</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Human-readable error description.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>filename</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional filename with MIME type issue.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>detected_mime</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional detected MIME type string.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>allowed_mimes</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional list of allowed MIME types.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>error_code</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional error code (defaults to
MIME_TYPE_INVALID).</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="safeuploads.MimeTypeError.detected_mime">detected_mime</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The detected MIME type string.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="safeuploads.MimeTypeError.allowed_mimes">allowed_mimes</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of allowed MIME types.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="quote">
                <summary>Source code in <code>safeuploads/exceptions.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">MimeTypeError</span><span class="p">(</span><span class="n">FileValidationError</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    File MIME type not allowed or mismatches extension.</span>

<span class="sd">    Args:</span>
<span class="sd">        message: Human-readable error description.</span>
<span class="sd">        filename: Optional filename with MIME type issue.</span>
<span class="sd">        detected_mime: Optional detected MIME type string.</span>
<span class="sd">        allowed_mimes: Optional list of allowed MIME types.</span>
<span class="sd">        error_code: Optional error code (defaults to</span>
<span class="sd">            MIME_TYPE_INVALID).</span>

<span class="sd">    Attributes:</span>
<span class="sd">        detected_mime: The detected MIME type string.</span>
<span class="sd">        allowed_mimes: List of allowed MIME types.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">message</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">detected_mime</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">allowed_mimes</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">error_code</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">detected_mime</span> <span class="o">=</span> <span class="n">detected_mime</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">allowed_mimes</span> <span class="o">=</span> <span class="n">allowed_mimes</span> <span class="ow">or</span> <span class="p">[]</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">message</span><span class="p">,</span>
            <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span>
            <span class="n">error_code</span><span class="o">=</span><span class="n">error_code</span> <span class="ow">or</span> <span class="n">ErrorCode</span><span class="o">.</span><span class="n">MIME_TYPE_INVALID</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="safeuploads.SecurityLimits" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">SecurityLimits</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h2>


    <div class="doc doc-contents ">


        <p>Security constraints for file submissions.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="safeuploads.SecurityLimits.max_image_size">max_image_size</span></code></td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum size in bytes for image files.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="safeuploads.SecurityLimits.max_zip_size">max_zip_size</span></code></td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum size in bytes for ZIP archives.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="safeuploads.SecurityLimits.max_compression_ratio">max_compression_ratio</span></code></td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum expansion ratio for ZIP files.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="safeuploads.SecurityLimits.max_uncompressed_size">max_uncompressed_size</span></code></td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum cumulative size of ZIP contents.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="safeuploads.SecurityLimits.max_individual_file_size">max_individual_file_size</span></code></td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum size of single file in ZIP.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="safeuploads.SecurityLimits.max_zip_entries">max_zip_entries</span></code></td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum number of file entries in ZIP.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="safeuploads.SecurityLimits.zip_analysis_timeout">zip_analysis_timeout</span></code></td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum seconds for ZIP analysis.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="safeuploads.SecurityLimits.max_zip_depth">max_zip_depth</span></code></td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum directory nesting depth in ZIP.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="safeuploads.SecurityLimits.max_filename_length">max_filename_length</span></code></td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum length for filenames in ZIP.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="safeuploads.SecurityLimits.max_path_length">max_path_length</span></code></td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum length for full paths in ZIP.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="safeuploads.SecurityLimits.allow_nested_archives">allow_nested_archives</span></code></td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether nested archives are permitted.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="safeuploads.SecurityLimits.allow_symlinks">allow_symlinks</span></code></td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether symbolic links are permitted.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="safeuploads.SecurityLimits.allow_absolute_paths">allow_absolute_paths</span></code></td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether absolute paths are permitted.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="safeuploads.SecurityLimits.scan_zip_content">scan_zip_content</span></code></td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether deep content inspection is enabled.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="quote">
                <summary>Source code in <code>safeuploads/config.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">SecurityLimits</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Security constraints for file submissions.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        max_image_size: Maximum size in bytes for image files.</span>
<span class="sd">        max_zip_size: Maximum size in bytes for ZIP archives.</span>
<span class="sd">        max_compression_ratio: Maximum expansion ratio for ZIP files.</span>
<span class="sd">        max_uncompressed_size: Maximum cumulative size of ZIP contents.</span>
<span class="sd">        max_individual_file_size: Maximum size of single file in ZIP.</span>
<span class="sd">        max_zip_entries: Maximum number of file entries in ZIP.</span>
<span class="sd">        zip_analysis_timeout: Maximum seconds for ZIP analysis.</span>
<span class="sd">        max_zip_depth: Maximum directory nesting depth in ZIP.</span>
<span class="sd">        max_filename_length: Maximum length for filenames in ZIP.</span>
<span class="sd">        max_path_length: Maximum length for full paths in ZIP.</span>
<span class="sd">        allow_nested_archives: Whether nested archives are permitted.</span>
<span class="sd">        allow_symlinks: Whether symbolic links are permitted.</span>
<span class="sd">        allow_absolute_paths: Whether absolute paths are permitted.</span>
<span class="sd">        scan_zip_content: Whether deep content inspection is enabled.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># File size limits (in bytes)</span>
    <span class="n">max_image_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">20</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span>  <span class="c1"># 20MB for images</span>
    <span class="n">max_zip_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">500</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span>  <span class="c1"># 500MB for ZIP files</span>

    <span class="c1"># ZIP compression security settings</span>
    <span class="n">max_compression_ratio</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span>  <span class="c1"># Maximum allowed expansion ratio (e.g., 100:1)</span>
    <span class="n">max_uncompressed_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span>  <span class="c1"># 1GB max uncompressed size</span>
    <span class="n">max_individual_file_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="p">(</span>
        <span class="mi">500</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span>
    <span class="p">)</span>  <span class="c1"># 500MB max per individual file in ZIP</span>
    <span class="n">max_zip_entries</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10000</span>  <span class="c1"># Maximum number of files in ZIP archive</span>
    <span class="n">zip_analysis_timeout</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="p">(</span>
        <span class="mf">5.0</span>  <span class="c1"># Maximum seconds to spend analyzing ZIP structure</span>
    <span class="p">)</span>

    <span class="c1"># ZIP content inspection settings</span>
    <span class="n">max_zip_depth</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span>  <span class="c1"># Maximum nesting depth for directories in ZIP</span>
    <span class="n">max_filename_length</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">255</span>  <span class="c1"># Maximum length for individual file names</span>
    <span class="n">max_path_length</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1024</span>  <span class="c1"># Maximum length for full file paths</span>
    <span class="n">allow_nested_archives</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># Whether to allow nested archive files</span>
    <span class="n">allow_symlinks</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># Whether to allow symbolic links in ZIP</span>
    <span class="n">allow_absolute_paths</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># Whether to allow absolute paths in ZIP</span>
    <span class="n">scan_zip_content</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># Whether to perform deep content inspection</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="safeuploads.SuspiciousFilePattern" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">SuspiciousFilePattern</span>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="enum.Enum">Enum</span></code></p>


        <p>Categorized patterns used to flag potentially malicious uploads.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="safeuploads.SuspiciousFilePattern.DIRECTORY_TRAVERSAL">DIRECTORY_TRAVERSAL</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Directory traversal attack patterns.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="safeuploads.SuspiciousFilePattern.SUSPICIOUS_NAMES">SUSPICIOUS_NAMES</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Suspicious filename patterns.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="safeuploads.SuspiciousFilePattern.EXECUTABLE_SIGNATURES">EXECUTABLE_SIGNATURES</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dangerous file content signatures.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="safeuploads.SuspiciousFilePattern.SUSPICIOUS_PATHS">SUSPICIOUS_PATHS</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Suspicious path components.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="quote">
                <summary>Source code in <code>safeuploads/enums.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">SuspiciousFilePattern</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Categorized patterns used to flag potentially malicious uploads.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        DIRECTORY_TRAVERSAL: Directory traversal attack patterns.</span>
<span class="sd">        SUSPICIOUS_NAMES: Suspicious filename patterns.</span>
<span class="sd">        EXECUTABLE_SIGNATURES: Dangerous file content signatures.</span>
<span class="sd">        SUSPICIOUS_PATHS: Suspicious path components.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Directory traversal attack patterns</span>
    <span class="n">DIRECTORY_TRAVERSAL</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;../&quot;</span><span class="p">,</span>
        <span class="s2">&quot;..</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.../&quot;</span><span class="p">,</span>
        <span class="s2">&quot;...</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="s2">&quot;....//&quot;</span><span class="p">,</span>
        <span class="s2">&quot;....</span><span class="se">\\\\</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="s2">&quot;</span><span class="si">%2e%2e%2f</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="s2">&quot;</span><span class="si">%2e%2e%5c</span><span class="s2">&quot;</span><span class="p">,</span>  <span class="c1"># URL encoded ../ and ..\</span>
        <span class="s2">&quot;</span><span class="si">%252e%252e%252f</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="s2">&quot;</span><span class="si">%252e%252e%255c</span><span class="s2">&quot;</span><span class="p">,</span>  <span class="c1"># Double URL encoded</span>
    <span class="p">}</span>

    <span class="c1"># Suspicious filename patterns</span>
    <span class="n">SUSPICIOUS_NAMES</span> <span class="o">=</span> <span class="p">{</span>
        <span class="c1"># Windows system files that shouldn&#39;t be in user uploads</span>
        <span class="s2">&quot;autorun.inf&quot;</span><span class="p">,</span>
        <span class="s2">&quot;desktop.ini&quot;</span><span class="p">,</span>
        <span class="s2">&quot;thumbs.db&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.ds_store&quot;</span><span class="p">,</span>
        <span class="c1"># Common malware names</span>
        <span class="s2">&quot;install.exe&quot;</span><span class="p">,</span>
        <span class="s2">&quot;setup.exe&quot;</span><span class="p">,</span>
        <span class="s2">&quot;update.exe&quot;</span><span class="p">,</span>
        <span class="s2">&quot;patch.exe&quot;</span><span class="p">,</span>
        <span class="s2">&quot;crack.exe&quot;</span><span class="p">,</span>
        <span class="s2">&quot;keygen.exe&quot;</span><span class="p">,</span>
        <span class="s2">&quot;loader.exe&quot;</span><span class="p">,</span>
        <span class="s2">&quot;activator.exe&quot;</span><span class="p">,</span>
        <span class="c1"># Hidden or system-like files</span>
        <span class="s2">&quot;.htaccess&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.htpasswd&quot;</span><span class="p">,</span>
        <span class="s2">&quot;web.config&quot;</span><span class="p">,</span>
        <span class="s2">&quot;robots.txt&quot;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="c1"># Dangerous file content signatures (magic bytes)</span>
    <span class="n">EXECUTABLE_SIGNATURES</span> <span class="o">=</span> <span class="p">{</span>
        <span class="c1"># Windows PE executables</span>
        <span class="sa">b</span><span class="s2">&quot;MZ&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;PE</span><span class="se">\x00\x00</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="c1"># ELF executables (Linux)</span>
        <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x7f</span><span class="s2">ELF&quot;</span><span class="p">,</span>
        <span class="c1"># Mach-O executables (macOS)</span>
        <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\xfe\xed\xfa\xce</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\xfe\xed\xfa\xcf</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\xce\xfa\xed\xfe</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\xcf\xfa\xed\xfe</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="c1"># Java class files</span>
        <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\xca\xfe\xba\xbe</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="c1"># Windows shortcuts (.lnk)</span>
        <span class="sa">b</span><span class="s2">&quot;L</span><span class="se">\x00\x00\x00</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="c1"># Suspicious path components</span>
    <span class="n">SUSPICIOUS_PATHS</span> <span class="o">=</span> <span class="p">{</span>
        <span class="c1"># Windows system directories</span>
        <span class="s2">&quot;windows/&quot;</span><span class="p">,</span>
        <span class="s2">&quot;system32/&quot;</span><span class="p">,</span>
        <span class="s2">&quot;syswow64/&quot;</span><span class="p">,</span>
        <span class="s2">&quot;programfiles/&quot;</span><span class="p">,</span>
        <span class="c1"># Unix system directories</span>
        <span class="s2">&quot;/bin/&quot;</span><span class="p">,</span>
        <span class="s2">&quot;/sbin/&quot;</span><span class="p">,</span>
        <span class="s2">&quot;/usr/bin/&quot;</span><span class="p">,</span>
        <span class="s2">&quot;/usr/sbin/&quot;</span><span class="p">,</span>
        <span class="s2">&quot;/etc/&quot;</span><span class="p">,</span>
        <span class="c1"># Web server directories</span>
        <span class="s2">&quot;cgi-bin/&quot;</span><span class="p">,</span>
        <span class="s2">&quot;htdocs/&quot;</span><span class="p">,</span>
        <span class="s2">&quot;www/&quot;</span><span class="p">,</span>
        <span class="s2">&quot;wwwroot/&quot;</span><span class="p">,</span>
        <span class="c1"># Development/build directories</span>
        <span class="s2">&quot;.git/&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.svn/&quot;</span><span class="p">,</span>
        <span class="s2">&quot;node_modules/&quot;</span><span class="p">,</span>
        <span class="s2">&quot;__pycache__/&quot;</span><span class="p">,</span>
    <span class="p">}</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="safeuploads.UnicodeAttackCategory" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">UnicodeAttackCategory</span>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="enum.Enum">Enum</span></code></p>


        <p>Categorized Unicode code points used in obfuscation attacks.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="safeuploads.UnicodeAttackCategory.DIRECTIONAL_OVERRIDES">DIRECTIONAL_OVERRIDES</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Right-to-left and directional controls.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="safeuploads.UnicodeAttackCategory.ZERO_WIDTH_CHARACTERS">ZERO_WIDTH_CHARACTERS</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Zero-width and invisible characters.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="safeuploads.UnicodeAttackCategory.LANGUAGE_MARKS">LANGUAGE_MARKS</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Language and format specific characters.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="safeuploads.UnicodeAttackCategory.CONFUSING_PUNCTUATION">CONFUSING_PUNCTUATION</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Punctuation that can disguise extensions.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="quote">
                <summary>Source code in <code>safeuploads/enums.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">UnicodeAttackCategory</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Categorized Unicode code points used in obfuscation attacks.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        DIRECTIONAL_OVERRIDES: Right-to-left and directional controls.</span>
<span class="sd">        ZERO_WIDTH_CHARACTERS: Zero-width and invisible characters.</span>
<span class="sd">        LANGUAGE_MARKS: Language and format specific characters.</span>
<span class="sd">        CONFUSING_PUNCTUATION: Punctuation that can disguise extensions.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Right-to-Left and directional override characters</span>
    <span class="n">DIRECTIONAL_OVERRIDES</span> <span class="o">=</span> <span class="p">{</span>
        <span class="mh">0x202E</span><span class="p">,</span>  <span class="c1"># U+202E RIGHT-TO-LEFT OVERRIDE</span>
        <span class="mh">0x202D</span><span class="p">,</span>  <span class="c1"># U+202D LEFT-TO-RIGHT OVERRIDE</span>
        <span class="mh">0x202A</span><span class="p">,</span>  <span class="c1"># U+202A LEFT-TO-RIGHT EMBEDDING</span>
        <span class="mh">0x202B</span><span class="p">,</span>  <span class="c1"># U+202B RIGHT-TO-LEFT EMBEDDING</span>
        <span class="mh">0x202C</span><span class="p">,</span>  <span class="c1"># U+202C POP DIRECTIONAL FORMATTING</span>
        <span class="mh">0x2066</span><span class="p">,</span>  <span class="c1"># U+2066 LEFT-TO-RIGHT ISOLATE</span>
        <span class="mh">0x2067</span><span class="p">,</span>  <span class="c1"># U+2067 RIGHT-TO-LEFT ISOLATE</span>
        <span class="mh">0x2068</span><span class="p">,</span>  <span class="c1"># U+2068 FIRST STRONG ISOLATE</span>
        <span class="mh">0x2069</span><span class="p">,</span>  <span class="c1"># U+2069 POP DIRECTIONAL ISOLATE</span>
    <span class="p">}</span>

    <span class="c1"># Zero-width and invisible characters</span>
    <span class="n">ZERO_WIDTH_CHARACTERS</span> <span class="o">=</span> <span class="p">{</span>
        <span class="mh">0x200B</span><span class="p">,</span>  <span class="c1"># U+200B ZERO WIDTH SPACE</span>
        <span class="mh">0x200C</span><span class="p">,</span>  <span class="c1"># U+200C ZERO WIDTH NON-JOINER</span>
        <span class="mh">0x200D</span><span class="p">,</span>  <span class="c1"># U+200D ZERO WIDTH JOINER</span>
        <span class="mh">0x2060</span><span class="p">,</span>  <span class="c1"># U+2060 WORD JOINER</span>
        <span class="mh">0xFEFF</span><span class="p">,</span>  <span class="c1"># U+FEFF ZERO WIDTH NO-BREAK SPACE (BOM)</span>
        <span class="mh">0x034F</span><span class="p">,</span>  <span class="c1"># U+034F COMBINING GRAPHEME JOINER</span>
    <span class="p">}</span>

    <span class="c1"># Language and format specific characters</span>
    <span class="n">LANGUAGE_MARKS</span> <span class="o">=</span> <span class="p">{</span>
        <span class="mh">0x061C</span><span class="p">,</span>  <span class="c1"># U+061C ARABIC LETTER MARK</span>
        <span class="mh">0x180E</span><span class="p">,</span>  <span class="c1"># U+180E MONGOLIAN VOWEL SEPARATOR</span>
    <span class="p">}</span>

    <span class="c1"># Confusing punctuation that can disguise extensions</span>
    <span class="n">CONFUSING_PUNCTUATION</span> <span class="o">=</span> <span class="p">{</span>
        <span class="mh">0x2024</span><span class="p">,</span>  <span class="c1"># U+2024 ONE DOT LEADER</span>
        <span class="mh">0x2025</span><span class="p">,</span>  <span class="c1"># U+2025 TWO DOT LEADER</span>
        <span class="mh">0x2026</span><span class="p">,</span>  <span class="c1"># U+2026 HORIZONTAL ELLIPSIS</span>
        <span class="mh">0xFF0E</span><span class="p">,</span>  <span class="c1"># U+FF0E FULLWIDTH FULL STOP</span>
    <span class="p">}</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="safeuploads.UnicodeSecurityError" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">UnicodeSecurityError</span>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="FilenameSecurityError (safeuploads.exceptions.FilenameSecurityError)" href="#safeuploads.FilenameSecurityError">FilenameSecurityError</a></code></p>


        <p>Dangerous Unicode characters detected in filename.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>message</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Human-readable error description.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>filename</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional filename containing dangerous Unicode.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>dangerous_chars</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="tuple">tuple</span>[<span title="str">str</span>, <span title="int">int</span>, <span title="int">int</span>]] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional list of (char, code_point, position)
tuples for each dangerous character found.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="safeuploads.UnicodeSecurityError.dangerous_chars">dangerous_chars</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of dangerous character tuples.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="quote">
                <summary>Source code in <code>safeuploads/exceptions.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">UnicodeSecurityError</span><span class="p">(</span><span class="n">FilenameSecurityError</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Dangerous Unicode characters detected in filename.</span>

<span class="sd">    Args:</span>
<span class="sd">        message: Human-readable error description.</span>
<span class="sd">        filename: Optional filename containing dangerous Unicode.</span>
<span class="sd">        dangerous_chars: Optional list of (char, code_point, position)</span>
<span class="sd">            tuples for each dangerous character found.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        dangerous_chars: List of dangerous character tuples.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">message</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">dangerous_chars</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dangerous_chars</span> <span class="o">=</span> <span class="n">dangerous_chars</span> <span class="ow">or</span> <span class="p">[]</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">message</span><span class="p">,</span>
            <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span>
            <span class="n">error_code</span><span class="o">=</span><span class="n">ErrorCode</span><span class="o">.</span><span class="n">UNICODE_DANGEROUS_CHARS</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="safeuploads.UnicodeSecurityValidator" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">UnicodeSecurityValidator</span>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="BaseValidator (safeuploads.validators.base.BaseValidator)" href="#safeuploads.BaseValidator">BaseValidator</a></code></p>


        <p>Validates filenames for Unicode security threats.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="safeuploads.UnicodeSecurityValidator.config">config</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Runtime configuration for file security rules.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="quote">
                <summary>Source code in <code>safeuploads/validators/unicode_validator.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">UnicodeSecurityValidator</span><span class="p">(</span><span class="n">BaseValidator</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validates filenames for Unicode security threats.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        config: Runtime configuration for file security rules.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">FileSecurityConfig</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize the Unicode validator.</span>

<span class="sd">        Args:</span>
<span class="sd">            config: Runtime configuration that controls file security rules.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">validate_unicode_security</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validate filename for unsafe Unicode characters.</span>

<span class="sd">        Args:</span>
<span class="sd">            filename: The filename to validate and normalize.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The NFC-normalized filename.</span>

<span class="sd">        Raises:</span>
<span class="sd">            UnicodeSecurityError: If dangerous Unicode characters are</span>
<span class="sd">                detected in the filename or result from normalization.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">filename</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">filename</span>

        <span class="c1"># Check for dangerous Unicode characters</span>
        <span class="n">dangerous_chars_found</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">char</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
            <span class="n">char_code</span> <span class="o">=</span> <span class="nb">ord</span><span class="p">(</span><span class="n">char</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">char_code</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">DANGEROUS_UNICODE_CHARS</span><span class="p">:</span>
                <span class="n">dangerous_chars_found</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">char</span><span class="p">,</span> <span class="n">char_code</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span>

        <span class="c1"># If dangerous characters found, reject the file entirely</span>
        <span class="k">if</span> <span class="n">dangerous_chars_found</span><span class="p">:</span>
            <span class="n">char_details</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">char</span><span class="p">,</span> <span class="n">code</span><span class="p">,</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">dangerous_chars_found</span><span class="p">:</span>
                <span class="n">char_name</span> <span class="o">=</span> <span class="n">unicodedata</span><span class="o">.</span><span class="n">name</span><span class="p">(</span><span class="n">char</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;U+</span><span class="si">{</span><span class="n">code</span><span class="si">:</span><span class="s2">04X</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">char_details</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="n">char</span><span class="si">}</span><span class="s2">&#39; (U+</span><span class="si">{</span><span class="n">code</span><span class="si">:</span><span class="s2">04X</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">char_name</span><span class="si">}</span><span class="s2">) at position </span><span class="si">{</span><span class="n">pos</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">&quot;Dangerous Unicode characters detected&quot;</span><span class="p">,</span>
                <span class="n">extra</span><span class="o">=</span><span class="p">{</span>
                    <span class="s2">&quot;error_type&quot;</span><span class="p">:</span> <span class="s2">&quot;unicode_security&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;file_name&quot;</span><span class="p">:</span> <span class="n">filename</span><span class="p">,</span>
                    <span class="s2">&quot;char_codes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">code</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">code</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">dangerous_chars_found</span><span class="p">],</span>
                    <span class="s2">&quot;positions&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">pos</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">dangerous_chars_found</span><span class="p">],</span>
                <span class="p">},</span>
            <span class="p">)</span>
            <span class="k">raise</span> <span class="n">UnicodeSecurityError</span><span class="p">(</span>
                <span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Dangerous Unicode characters detected in filename: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">char_details</span><span class="p">)</span><span class="si">}</span><span class="s2">. &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;These characters can be used to disguise file extensions or create security vulnerabilities.&quot;</span><span class="p">,</span>
                <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span>
                <span class="n">dangerous_chars</span><span class="o">=</span><span class="n">dangerous_chars_found</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="c1"># Normalize Unicode to prevent normalization attacks</span>
        <span class="c1"># Use NFC (Canonical Decomposition, followed by Canonical Composition)</span>
        <span class="c1"># This prevents attacks where different Unicode representations of the same text are used</span>
        <span class="n">normalized_filename</span> <span class="o">=</span> <span class="n">unicodedata</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span><span class="s2">&quot;NFC&quot;</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>

        <span class="c1"># Check if normalization changed the filename significantly</span>
        <span class="k">if</span> <span class="n">normalized_filename</span> <span class="o">!=</span> <span class="n">filename</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s2">&quot;Unicode normalization applied: &#39;</span><span class="si">%s</span><span class="s2">&#39; -&gt; &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span><span class="p">,</span>
                <span class="n">filename</span><span class="p">,</span>
                <span class="n">normalized_filename</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="c1"># Additional check: ensure normalized filename doesn&#39;t contain dangerous chars</span>
        <span class="c1"># (some normalization attacks might introduce them)</span>
        <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">normalized_filename</span><span class="p">:</span>
            <span class="n">char_code</span> <span class="o">=</span> <span class="nb">ord</span><span class="p">(</span><span class="n">char</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">char_code</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">DANGEROUS_UNICODE_CHARS</span><span class="p">:</span>
                <span class="n">char_name</span> <span class="o">=</span> <span class="n">unicodedata</span><span class="o">.</span><span class="n">name</span><span class="p">(</span><span class="n">char</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;U+</span><span class="si">{</span><span class="n">char_code</span><span class="si">:</span><span class="s2">04X</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                    <span class="s2">&quot;Unicode normalization resulted in dangerous character&quot;</span><span class="p">,</span>
                    <span class="n">extra</span><span class="o">=</span><span class="p">{</span>
                        <span class="s2">&quot;error_type&quot;</span><span class="p">:</span> <span class="s2">&quot;unicode_normalization_error&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;file_name&quot;</span><span class="p">:</span> <span class="n">filename</span><span class="p">,</span>
                        <span class="s2">&quot;normalized_filename&quot;</span><span class="p">:</span> <span class="n">normalized_filename</span><span class="p">,</span>
                        <span class="s2">&quot;char_code&quot;</span><span class="p">:</span> <span class="n">char_code</span><span class="p">,</span>
                    <span class="p">},</span>
                <span class="p">)</span>
                <span class="k">raise</span> <span class="n">UnicodeSecurityError</span><span class="p">(</span>
                    <span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Unicode normalization resulted in dangerous character: &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="n">char</span><span class="si">}</span><span class="s2">&#39; (U+</span><span class="si">{</span><span class="n">char_code</span><span class="si">:</span><span class="s2">04X</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">char_name</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span>
                    <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span>
                    <span class="n">dangerous_chars</span><span class="o">=</span><span class="p">[(</span><span class="n">char</span><span class="p">,</span> <span class="n">char_code</span><span class="p">,</span> <span class="mi">0</span><span class="p">)],</span>
                <span class="p">)</span>

        <span class="k">return</span> <span class="n">normalized_filename</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validate a filename for Unicode security issues.</span>

<span class="sd">        Args:</span>
<span class="sd">            filename: The name of the file to assess.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The validated and normalized filename.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate_unicode_security</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="safeuploads.UnicodeSecurityValidator.__init__" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">__init__</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">__init__</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Initialize the Unicode validator.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>config</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="FileSecurityConfig (safeuploads.config.FileSecurityConfig)" href="#safeuploads.FileSecurityConfig">FileSecurityConfig</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Runtime configuration that controls file security rules.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>safeuploads/validators/unicode_validator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">FileSecurityConfig</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Initialize the Unicode validator.</span>

<span class="sd">    Args:</span>
<span class="sd">        config: Runtime configuration that controls file security rules.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="safeuploads.UnicodeSecurityValidator.validate" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">validate</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">validate</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Validate a filename for Unicode security issues.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>filename</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name of the file to assess.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The validated and normalized filename.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>safeuploads/validators/unicode_validator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validate a filename for Unicode security issues.</span>

<span class="sd">    Args:</span>
<span class="sd">        filename: The name of the file to assess.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The validated and normalized filename.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate_unicode_security</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="safeuploads.UnicodeSecurityValidator.validate_unicode_security" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">validate_unicode_security</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">validate_unicode_security</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Validate filename for unsafe Unicode characters.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>filename</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The filename to validate and normalize.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The NFC-normalized filename.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="UnicodeSecurityError (safeuploads.exceptions.UnicodeSecurityError)" href="#safeuploads.UnicodeSecurityError">UnicodeSecurityError</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If dangerous Unicode characters are
detected in the filename or result from normalization.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>safeuploads/validators/unicode_validator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">validate_unicode_security</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validate filename for unsafe Unicode characters.</span>

<span class="sd">    Args:</span>
<span class="sd">        filename: The filename to validate and normalize.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The NFC-normalized filename.</span>

<span class="sd">    Raises:</span>
<span class="sd">        UnicodeSecurityError: If dangerous Unicode characters are</span>
<span class="sd">            detected in the filename or result from normalization.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">filename</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">filename</span>

    <span class="c1"># Check for dangerous Unicode characters</span>
    <span class="n">dangerous_chars_found</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">char</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
        <span class="n">char_code</span> <span class="o">=</span> <span class="nb">ord</span><span class="p">(</span><span class="n">char</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">char_code</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">DANGEROUS_UNICODE_CHARS</span><span class="p">:</span>
            <span class="n">dangerous_chars_found</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">char</span><span class="p">,</span> <span class="n">char_code</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span>

    <span class="c1"># If dangerous characters found, reject the file entirely</span>
    <span class="k">if</span> <span class="n">dangerous_chars_found</span><span class="p">:</span>
        <span class="n">char_details</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">char</span><span class="p">,</span> <span class="n">code</span><span class="p">,</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">dangerous_chars_found</span><span class="p">:</span>
            <span class="n">char_name</span> <span class="o">=</span> <span class="n">unicodedata</span><span class="o">.</span><span class="n">name</span><span class="p">(</span><span class="n">char</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;U+</span><span class="si">{</span><span class="n">code</span><span class="si">:</span><span class="s2">04X</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">char_details</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="n">char</span><span class="si">}</span><span class="s2">&#39; (U+</span><span class="si">{</span><span class="n">code</span><span class="si">:</span><span class="s2">04X</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">char_name</span><span class="si">}</span><span class="s2">) at position </span><span class="si">{</span><span class="n">pos</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
            <span class="s2">&quot;Dangerous Unicode characters detected&quot;</span><span class="p">,</span>
            <span class="n">extra</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;error_type&quot;</span><span class="p">:</span> <span class="s2">&quot;unicode_security&quot;</span><span class="p">,</span>
                <span class="s2">&quot;file_name&quot;</span><span class="p">:</span> <span class="n">filename</span><span class="p">,</span>
                <span class="s2">&quot;char_codes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">code</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">code</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">dangerous_chars_found</span><span class="p">],</span>
                <span class="s2">&quot;positions&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">pos</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">dangerous_chars_found</span><span class="p">],</span>
            <span class="p">},</span>
        <span class="p">)</span>
        <span class="k">raise</span> <span class="n">UnicodeSecurityError</span><span class="p">(</span>
            <span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Dangerous Unicode characters detected in filename: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">char_details</span><span class="p">)</span><span class="si">}</span><span class="s2">. &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;These characters can be used to disguise file extensions or create security vulnerabilities.&quot;</span><span class="p">,</span>
            <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span>
            <span class="n">dangerous_chars</span><span class="o">=</span><span class="n">dangerous_chars_found</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="c1"># Normalize Unicode to prevent normalization attacks</span>
    <span class="c1"># Use NFC (Canonical Decomposition, followed by Canonical Composition)</span>
    <span class="c1"># This prevents attacks where different Unicode representations of the same text are used</span>
    <span class="n">normalized_filename</span> <span class="o">=</span> <span class="n">unicodedata</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span><span class="s2">&quot;NFC&quot;</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>

    <span class="c1"># Check if normalization changed the filename significantly</span>
    <span class="k">if</span> <span class="n">normalized_filename</span> <span class="o">!=</span> <span class="n">filename</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s2">&quot;Unicode normalization applied: &#39;</span><span class="si">%s</span><span class="s2">&#39; -&gt; &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span><span class="p">,</span>
            <span class="n">filename</span><span class="p">,</span>
            <span class="n">normalized_filename</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="c1"># Additional check: ensure normalized filename doesn&#39;t contain dangerous chars</span>
    <span class="c1"># (some normalization attacks might introduce them)</span>
    <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">normalized_filename</span><span class="p">:</span>
        <span class="n">char_code</span> <span class="o">=</span> <span class="nb">ord</span><span class="p">(</span><span class="n">char</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">char_code</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">DANGEROUS_UNICODE_CHARS</span><span class="p">:</span>
            <span class="n">char_name</span> <span class="o">=</span> <span class="n">unicodedata</span><span class="o">.</span><span class="n">name</span><span class="p">(</span><span class="n">char</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;U+</span><span class="si">{</span><span class="n">char_code</span><span class="si">:</span><span class="s2">04X</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                <span class="s2">&quot;Unicode normalization resulted in dangerous character&quot;</span><span class="p">,</span>
                <span class="n">extra</span><span class="o">=</span><span class="p">{</span>
                    <span class="s2">&quot;error_type&quot;</span><span class="p">:</span> <span class="s2">&quot;unicode_normalization_error&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;file_name&quot;</span><span class="p">:</span> <span class="n">filename</span><span class="p">,</span>
                    <span class="s2">&quot;normalized_filename&quot;</span><span class="p">:</span> <span class="n">normalized_filename</span><span class="p">,</span>
                    <span class="s2">&quot;char_code&quot;</span><span class="p">:</span> <span class="n">char_code</span><span class="p">,</span>
                <span class="p">},</span>
            <span class="p">)</span>
            <span class="k">raise</span> <span class="n">UnicodeSecurityError</span><span class="p">(</span>
                <span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Unicode normalization resulted in dangerous character: &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="n">char</span><span class="si">}</span><span class="s2">&#39; (U+</span><span class="si">{</span><span class="n">char_code</span><span class="si">:</span><span class="s2">04X</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">char_name</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span>
                <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span>
                <span class="n">dangerous_chars</span><span class="o">=</span><span class="p">[(</span><span class="n">char</span><span class="p">,</span> <span class="n">char_code</span><span class="p">,</span> <span class="mi">0</span><span class="p">)],</span>
            <span class="p">)</span>

    <span class="k">return</span> <span class="n">normalized_filename</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="safeuploads.WindowsReservedNameError" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">WindowsReservedNameError</span>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="FilenameSecurityError (safeuploads.exceptions.FilenameSecurityError)" href="#safeuploads.FilenameSecurityError">FilenameSecurityError</a></code></p>


        <p>Windows reserved device name used.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>message</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Human-readable error description.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>filename</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional filename using a reserved name.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>reserved_name</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional specific reserved name detected.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="safeuploads.WindowsReservedNameError.reserved_name">reserved_name</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The specific reserved name that was detected.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="quote">
                <summary>Source code in <code>safeuploads/exceptions.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">WindowsReservedNameError</span><span class="p">(</span><span class="n">FilenameSecurityError</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Windows reserved device name used.</span>

<span class="sd">    Args:</span>
<span class="sd">        message: Human-readable error description.</span>
<span class="sd">        filename: Optional filename using a reserved name.</span>
<span class="sd">        reserved_name: Optional specific reserved name detected.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        reserved_name: The specific reserved name that was detected.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">message</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">reserved_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reserved_name</span> <span class="o">=</span> <span class="n">reserved_name</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">message</span><span class="p">,</span>
            <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span>
            <span class="n">error_code</span><span class="o">=</span><span class="n">ErrorCode</span><span class="o">.</span><span class="n">WINDOWS_RESERVED_NAME</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="safeuploads.WindowsSecurityValidator" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">WindowsSecurityValidator</span>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="BaseValidator (safeuploads.validators.base.BaseValidator)" href="#safeuploads.BaseValidator">BaseValidator</a></code></p>


        <p>Validator for Windows reserved device names.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="safeuploads.WindowsSecurityValidator.config">config</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>File security configuration settings.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="quote">
                <summary>Source code in <code>safeuploads/validators/windows_validator.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">WindowsSecurityValidator</span><span class="p">(</span><span class="n">BaseValidator</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validator for Windows reserved device names.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        config: File security configuration settings.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">FileSecurityConfig</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize the validator.</span>

<span class="sd">        Args:</span>
<span class="sd">            config: File security configuration settings.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">validate_windows_reserved_names</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validate filename against Windows reserved device names.</span>

<span class="sd">        Args:</span>
<span class="sd">            filename: The filename to validate.</span>

<span class="sd">        Raises:</span>
<span class="sd">            WindowsReservedNameError: If filename matches a Windows</span>
<span class="sd">                reserved device name.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Check iteratively by removing extensions to handle compound extensions</span>
        <span class="c1"># e.g., &quot;CON.tar.gz&quot; -&gt; check &quot;con.tar&quot; and &quot;con&quot;</span>
        <span class="n">current_name</span> <span class="o">=</span> <span class="n">filename</span>

        <span class="k">while</span> <span class="n">current_name</span><span class="p">:</span>
            <span class="c1"># Get basename without extension</span>
            <span class="n">name_without_ext</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">current_name</span><span class="p">)</span>

            <span class="c1"># Normalize: lowercase, strip whitespace</span>
            <span class="n">name_to_check</span> <span class="o">=</span> <span class="n">name_without_ext</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="c1"># Remove leading dots to handle hidden files like &quot;.CON.jpg&quot;</span>
            <span class="n">name_to_check</span> <span class="o">=</span> <span class="n">name_to_check</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
            <span class="c1"># Remove trailing dots to handle cases like &quot;con.&quot; or &quot;con..&quot;</span>
            <span class="n">name_to_check</span> <span class="o">=</span> <span class="n">name_to_check</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">name_to_check</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">WINDOWS_RESERVED_NAMES</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="s2">&quot;Windows reserved name detected&quot;</span><span class="p">,</span>
                    <span class="n">extra</span><span class="o">=</span><span class="p">{</span>
                        <span class="s2">&quot;error_type&quot;</span><span class="p">:</span> <span class="s2">&quot;windows_reserved_name&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;file_name&quot;</span><span class="p">:</span> <span class="n">filename</span><span class="p">,</span>
                        <span class="s2">&quot;reserved_name&quot;</span><span class="p">:</span> <span class="n">name_to_check</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span>
                    <span class="p">},</span>
                <span class="p">)</span>
                <span class="k">raise</span> <span class="n">WindowsReservedNameError</span><span class="p">(</span>
                    <span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Filename &#39;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&#39; uses Windows reserved name &#39;</span><span class="si">{</span><span class="n">name_to_check</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2">&#39;. &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;Reserved names: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">WINDOWS_RESERVED_NAMES</span><span class="p">))</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span>
                    <span class="n">reserved_name</span><span class="o">=</span><span class="n">name_to_check</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span>
                <span class="p">)</span>

            <span class="c1"># If no extension was removed, we&#39;re done</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">ext</span> <span class="ow">or</span> <span class="n">name_without_ext</span> <span class="o">==</span> <span class="n">current_name</span><span class="p">:</span>
                <span class="k">break</span>

            <span class="n">current_name</span> <span class="o">=</span> <span class="n">name_without_ext</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validate filename against Windows reserved naming rules.</span>

<span class="sd">        Args:</span>
<span class="sd">            filename: The filename to validate.</span>

<span class="sd">        Raises:</span>
<span class="sd">            WindowsReservedNameError: If filename matches a Windows</span>
<span class="sd">                reserved device name.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate_windows_reserved_names</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="safeuploads.WindowsSecurityValidator.__init__" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">__init__</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">__init__</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Initialize the validator.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>config</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="FileSecurityConfig (safeuploads.config.FileSecurityConfig)" href="#safeuploads.FileSecurityConfig">FileSecurityConfig</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>File security configuration settings.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>safeuploads/validators/windows_validator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">FileSecurityConfig</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Initialize the validator.</span>

<span class="sd">    Args:</span>
<span class="sd">        config: File security configuration settings.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="safeuploads.WindowsSecurityValidator.validate" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">validate</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">validate</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Validate filename against Windows reserved naming rules.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>filename</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The filename to validate.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="WindowsReservedNameError (safeuploads.exceptions.WindowsReservedNameError)" href="#safeuploads.WindowsReservedNameError">WindowsReservedNameError</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If filename matches a Windows
reserved device name.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>safeuploads/validators/windows_validator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validate filename against Windows reserved naming rules.</span>

<span class="sd">    Args:</span>
<span class="sd">        filename: The filename to validate.</span>

<span class="sd">    Raises:</span>
<span class="sd">        WindowsReservedNameError: If filename matches a Windows</span>
<span class="sd">            reserved device name.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate_windows_reserved_names</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="safeuploads.WindowsSecurityValidator.validate_windows_reserved_names" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">validate_windows_reserved_names</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">validate_windows_reserved_names</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Validate filename against Windows reserved device names.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>filename</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The filename to validate.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="WindowsReservedNameError (safeuploads.exceptions.WindowsReservedNameError)" href="#safeuploads.WindowsReservedNameError">WindowsReservedNameError</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If filename matches a Windows
reserved device name.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>safeuploads/validators/windows_validator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">validate_windows_reserved_names</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validate filename against Windows reserved device names.</span>

<span class="sd">    Args:</span>
<span class="sd">        filename: The filename to validate.</span>

<span class="sd">    Raises:</span>
<span class="sd">        WindowsReservedNameError: If filename matches a Windows</span>
<span class="sd">            reserved device name.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Check iteratively by removing extensions to handle compound extensions</span>
    <span class="c1"># e.g., &quot;CON.tar.gz&quot; -&gt; check &quot;con.tar&quot; and &quot;con&quot;</span>
    <span class="n">current_name</span> <span class="o">=</span> <span class="n">filename</span>

    <span class="k">while</span> <span class="n">current_name</span><span class="p">:</span>
        <span class="c1"># Get basename without extension</span>
        <span class="n">name_without_ext</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">current_name</span><span class="p">)</span>

        <span class="c1"># Normalize: lowercase, strip whitespace</span>
        <span class="n">name_to_check</span> <span class="o">=</span> <span class="n">name_without_ext</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="c1"># Remove leading dots to handle hidden files like &quot;.CON.jpg&quot;</span>
        <span class="n">name_to_check</span> <span class="o">=</span> <span class="n">name_to_check</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
        <span class="c1"># Remove trailing dots to handle cases like &quot;con.&quot; or &quot;con..&quot;</span>
        <span class="n">name_to_check</span> <span class="o">=</span> <span class="n">name_to_check</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">name_to_check</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">WINDOWS_RESERVED_NAMES</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">&quot;Windows reserved name detected&quot;</span><span class="p">,</span>
                <span class="n">extra</span><span class="o">=</span><span class="p">{</span>
                    <span class="s2">&quot;error_type&quot;</span><span class="p">:</span> <span class="s2">&quot;windows_reserved_name&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;file_name&quot;</span><span class="p">:</span> <span class="n">filename</span><span class="p">,</span>
                    <span class="s2">&quot;reserved_name&quot;</span><span class="p">:</span> <span class="n">name_to_check</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span>
                <span class="p">},</span>
            <span class="p">)</span>
            <span class="k">raise</span> <span class="n">WindowsReservedNameError</span><span class="p">(</span>
                <span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Filename &#39;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&#39; uses Windows reserved name &#39;</span><span class="si">{</span><span class="n">name_to_check</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2">&#39;. &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;Reserved names: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">WINDOWS_RESERVED_NAMES</span><span class="p">))</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span>
                <span class="n">reserved_name</span><span class="o">=</span><span class="n">name_to_check</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span>
            <span class="p">)</span>

        <span class="c1"># If no extension was removed, we&#39;re done</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ext</span> <span class="ow">or</span> <span class="n">name_without_ext</span> <span class="o">==</span> <span class="n">current_name</span><span class="p">:</span>
            <span class="k">break</span>

        <span class="n">current_name</span> <span class="o">=</span> <span class="n">name_without_ext</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="safeuploads.ZipBombError" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">ZipBombError</span>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="CompressionSecurityError (safeuploads.exceptions.CompressionSecurityError)" href="#safeuploads.CompressionSecurityError">CompressionSecurityError</a></code></p>


        <p>Zip archive exceeds compression ratio or uncompressed size limits.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>message</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Human-readable error description.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>filename</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional filename of zip bomb.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>compression_ratio</code>
            </td>
            <td>
                  <code><span title="float">float</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional actual compression ratio detected.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>uncompressed_size</code>
            </td>
            <td>
                  <code><span title="int">int</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional total uncompressed size in bytes.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_ratio</code>
            </td>
            <td>
                  <code><span title="float">float</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional maximum allowed compression ratio.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_size</code>
            </td>
            <td>
                  <code><span title="int">int</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional maximum allowed uncompressed size in bytes.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="safeuploads.ZipBombError.compression_ratio">compression_ratio</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Actual compression ratio detected.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="safeuploads.ZipBombError.uncompressed_size">uncompressed_size</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Total uncompressed size in bytes.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="safeuploads.ZipBombError.max_ratio">max_ratio</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum allowed compression ratio.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="safeuploads.ZipBombError.max_size">max_size</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum allowed uncompressed size in bytes.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="quote">
                <summary>Source code in <code>safeuploads/exceptions.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ZipBombError</span><span class="p">(</span><span class="n">CompressionSecurityError</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Zip archive exceeds compression ratio or uncompressed size limits.</span>

<span class="sd">    Args:</span>
<span class="sd">        message: Human-readable error description.</span>
<span class="sd">        filename: Optional filename of zip bomb.</span>
<span class="sd">        compression_ratio: Optional actual compression ratio detected.</span>
<span class="sd">        uncompressed_size: Optional total uncompressed size in bytes.</span>
<span class="sd">        max_ratio: Optional maximum allowed compression ratio.</span>
<span class="sd">        max_size: Optional maximum allowed uncompressed size in bytes.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        compression_ratio: Actual compression ratio detected.</span>
<span class="sd">        uncompressed_size: Total uncompressed size in bytes.</span>
<span class="sd">        max_ratio: Maximum allowed compression ratio.</span>
<span class="sd">        max_size: Maximum allowed uncompressed size in bytes.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">message</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">compression_ratio</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">uncompressed_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">max_ratio</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">max_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compression_ratio</span> <span class="o">=</span> <span class="n">compression_ratio</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">uncompressed_size</span> <span class="o">=</span> <span class="n">uncompressed_size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_ratio</span> <span class="o">=</span> <span class="n">max_ratio</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_size</span> <span class="o">=</span> <span class="n">max_size</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">message</span><span class="p">,</span>
            <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span>
            <span class="n">error_code</span><span class="o">=</span><span class="n">ErrorCode</span><span class="o">.</span><span class="n">ZIP_BOMB_DETECTED</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="safeuploads.ZipContentError" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">ZipContentError</span>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="CompressionSecurityError (safeuploads.exceptions.CompressionSecurityError)" href="#safeuploads.CompressionSecurityError">CompressionSecurityError</a></code></p>


        <p>Zip archive contains dangerous content or structure.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>message</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Human-readable error description.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>filename</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional filename of problematic archive.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>threats</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional list of detected threat descriptions.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>error_code</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional error code (defaults to
ZIP_CONTENT_THREAT).</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="safeuploads.ZipContentError.threats">threats</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of detected threat descriptions.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="quote">
                <summary>Source code in <code>safeuploads/exceptions.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ZipContentError</span><span class="p">(</span><span class="n">CompressionSecurityError</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Zip archive contains dangerous content or structure.</span>

<span class="sd">    Args:</span>
<span class="sd">        message: Human-readable error description.</span>
<span class="sd">        filename: Optional filename of problematic archive.</span>
<span class="sd">        threats: Optional list of detected threat descriptions.</span>
<span class="sd">        error_code: Optional error code (defaults to</span>
<span class="sd">            ZIP_CONTENT_THREAT).</span>

<span class="sd">    Attributes:</span>
<span class="sd">        threats: List of detected threat descriptions.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">message</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">threats</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">error_code</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">threats</span> <span class="o">=</span> <span class="n">threats</span> <span class="ow">or</span> <span class="p">[]</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">message</span><span class="p">,</span>
            <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span>
            <span class="n">error_code</span><span class="o">=</span><span class="n">error_code</span> <span class="ow">or</span> <span class="n">ErrorCode</span><span class="o">.</span><span class="n">ZIP_CONTENT_THREAT</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="safeuploads.ZipContentInspector" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">ZipContentInspector</span>


</h2>


    <div class="doc doc-contents ">


        <p>Inspects ZIP archive contents for security threats.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="safeuploads.ZipContentInspector.config">config</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>File security configuration.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="quote">
                <summary>Source code in <code>safeuploads/inspectors/zip_inspector.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ZipContentInspector</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Inspects ZIP archive contents for security threats.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        config: File security configuration.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">FileSecurityConfig</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize ZIP inspector with configuration.</span>

<span class="sd">        Args:</span>
<span class="sd">            config: File security configuration.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">config</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">inspect_zip_content</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_content</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Inspect ZIP archive for potential security threats.</span>

<span class="sd">        Args:</span>
<span class="sd">            file_content: Raw bytes of ZIP archive.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ZipContentError: If security threats are detected in ZIP</span>
<span class="sd">                content such as directory traversal, symlinks, nested</span>
<span class="sd">                archives, or suspicious patterns.</span>
<span class="sd">            FileProcessingError: If ZIP structure is invalid or</span>
<span class="sd">                unexpected error occurs during inspection.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">zip_bytes</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">file_content</span><span class="p">)</span>
            <span class="n">threats_found</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="c1"># Start analysis timer</span>
            <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

            <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">zip_bytes</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zip_file</span><span class="p">:</span>
                <span class="n">zip_entries</span> <span class="o">=</span> <span class="n">zip_file</span><span class="o">.</span><span class="n">infolist</span><span class="p">()</span>

                <span class="c1"># Analyze each entry in the ZIP</span>
                <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">zip_entries</span><span class="p">:</span>
                    <span class="c1"># Check for timeout</span>
                    <span class="k">if</span> <span class="p">(</span>
                        <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>
                        <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">limits</span><span class="o">.</span><span class="n">zip_analysis_timeout</span>
                    <span class="p">):</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                            <span class="s2">&quot;ZIP content inspection timeout&quot;</span><span class="p">,</span>
                            <span class="n">extra</span><span class="o">=</span><span class="p">{</span>
                                <span class="s2">&quot;error_type&quot;</span><span class="p">:</span> <span class="s2">&quot;zip_analysis_timeout&quot;</span><span class="p">,</span>
                                <span class="s2">&quot;timeout&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">limits</span><span class="o">.</span><span class="n">zip_analysis_timeout</span><span class="p">,</span>
                            <span class="p">},</span>
                        <span class="p">)</span>
                        <span class="k">raise</span> <span class="n">ZipContentError</span><span class="p">(</span>
                            <span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;ZIP content inspection timeout after </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">limits</span><span class="o">.</span><span class="n">zip_analysis_timeout</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">,</span>
                            <span class="n">threats</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Analysis timeout - potential zip bomb&quot;</span><span class="p">],</span>
                            <span class="n">error_code</span><span class="o">=</span><span class="n">ErrorCode</span><span class="o">.</span><span class="n">ZIP_ANALYSIS_TIMEOUT</span><span class="p">,</span>
                        <span class="p">)</span>

                    <span class="c1"># Inspect individual entry</span>
                    <span class="n">entry_threats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inspect_zip_entry</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">zip_file</span><span class="p">)</span>
                    <span class="n">threats_found</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">entry_threats</span><span class="p">)</span>

                <span class="c1"># Check for ZIP structure threats</span>
                <span class="n">structure_threats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inspect_zip_structure</span><span class="p">(</span><span class="n">zip_entries</span><span class="p">)</span>
                <span class="n">threats_found</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">structure_threats</span><span class="p">)</span>

                <span class="c1"># Return results</span>
                <span class="k">if</span> <span class="n">threats_found</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                        <span class="s2">&quot;ZIP content threats detected&quot;</span><span class="p">,</span>
                        <span class="n">extra</span><span class="o">=</span><span class="p">{</span>
                            <span class="s2">&quot;error_type&quot;</span><span class="p">:</span> <span class="s2">&quot;zip_content_threat&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;threats&quot;</span><span class="p">:</span> <span class="n">threats_found</span><span class="p">,</span>
                            <span class="s2">&quot;threat_count&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">threats_found</span><span class="p">),</span>
                        <span class="p">},</span>
                    <span class="p">)</span>
                    <span class="k">raise</span> <span class="n">ZipContentError</span><span class="p">(</span>
                        <span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;ZIP content threats detected: </span><span class="si">{</span><span class="s1">&#39;; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">threats_found</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                        <span class="n">threats</span><span class="o">=</span><span class="n">threats_found</span><span class="p">,</span>
                    <span class="p">)</span>

                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                    <span class="s2">&quot;ZIP content inspection passed: </span><span class="si">%s</span><span class="s2"> entries analyzed&quot;</span><span class="p">,</span>
                    <span class="nb">len</span><span class="p">(</span><span class="n">zip_entries</span><span class="p">),</span>
                <span class="p">)</span>

        <span class="k">except</span> <span class="n">ZipContentError</span><span class="p">:</span>
            <span class="c1"># Re-raise our own exceptions</span>
            <span class="k">raise</span>
        <span class="k">except</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">BadZipFile</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Invalid or corrupted ZIP file structure&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">FileProcessingError</span><span class="p">(</span>
                <span class="n">message</span><span class="o">=</span><span class="s2">&quot;Invalid or corrupted ZIP file structure&quot;</span><span class="p">,</span>
                <span class="n">original_error</span><span class="o">=</span><span class="n">err</span><span class="p">,</span>
            <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">err</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                <span class="s2">&quot;Unexpected error during ZIP content inspection&quot;</span><span class="p">,</span>
                <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">raise</span> <span class="n">FileProcessingError</span><span class="p">(</span>
                <span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;ZIP content inspection failed: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">original_error</span><span class="o">=</span><span class="n">err</span><span class="p">,</span>
            <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">err</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_inspect_zip_entry</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">entry</span><span class="p">:</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipInfo</span><span class="p">,</span> <span class="n">zip_file</span><span class="p">:</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Inspect single ZIP entry for security threats.</span>

<span class="sd">        Args:</span>
<span class="sd">            entry: ZIP entry metadata.</span>
<span class="sd">            zip_file: Parent ZIP archive.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of threat descriptions.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">threats</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">filename</span>

        <span class="c1"># 1. Check for directory traversal attacks</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_has_directory_traversal</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
            <span class="n">threats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Directory traversal attack in &#39;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>

        <span class="c1"># 2. Check for absolute paths</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">limits</span><span class="o">.</span><span class="n">allow_absolute_paths</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_has_absolute_path</span><span class="p">(</span>
            <span class="n">filename</span>
        <span class="p">):</span>
            <span class="n">threats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Absolute path detected in &#39;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>

        <span class="c1"># 3. Check for symbolic links</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">limits</span><span class="o">.</span><span class="n">allow_symlinks</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_symlink</span><span class="p">(</span><span class="n">entry</span><span class="p">):</span>
            <span class="n">threats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Symbolic link detected: &#39;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>

        <span class="c1"># 4. Check filename length limits</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">limits</span><span class="o">.</span><span class="n">max_filename_length</span><span class="p">:</span>
            <span class="n">threats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Filename too long: &#39;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&#39; (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span><span class="si">}</span><span class="s2"> chars)&quot;</span>
            <span class="p">)</span>

        <span class="c1"># 5. Check path length limits</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">limits</span><span class="o">.</span><span class="n">max_path_length</span><span class="p">:</span>
            <span class="n">threats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Path too long: &#39;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&#39; (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span><span class="si">}</span><span class="s2"> chars)&quot;</span><span class="p">)</span>

        <span class="c1"># 6. Check for suspicious filename patterns</span>
        <span class="n">suspicious_patterns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_suspicious_patterns</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="n">threats</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">suspicious_patterns</span><span class="p">)</span>

        <span class="c1"># 7. Check for nested archives</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">limits</span><span class="o">.</span><span class="n">allow_nested_archives</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_nested_archive</span><span class="p">(</span>
            <span class="n">filename</span>
        <span class="p">):</span>
            <span class="n">threats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Nested archive detected: &#39;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>

        <span class="c1"># 8. Check file content if enabled and entry is small enough</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">limits</span><span class="o">.</span><span class="n">scan_zip_content</span>
            <span class="ow">and</span> <span class="ow">not</span> <span class="n">entry</span><span class="o">.</span><span class="n">is_dir</span><span class="p">()</span>
            <span class="ow">and</span> <span class="n">entry</span><span class="o">.</span><span class="n">file_size</span> <span class="o">&lt;</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span>
        <span class="p">):</span>  <span class="c1"># 1MB limit for content scan</span>
            <span class="n">content_threats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inspect_entry_content</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">zip_file</span><span class="p">)</span>
            <span class="n">threats</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">content_threats</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">threats</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_inspect_zip_structure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entries</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">zipfile</span><span class="o">.</span><span class="n">ZipInfo</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Inspect ZIP structure for anomalies.</span>

<span class="sd">        Args:</span>
<span class="sd">            entries: All ZIP entries to analyze.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of structural threat descriptions.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">threats</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Check directory depth</span>
        <span class="n">max_depth</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entries</span><span class="p">:</span>
            <span class="n">depth</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">filename</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="n">entry</span><span class="o">.</span><span class="n">filename</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">max_depth</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">max_depth</span><span class="p">,</span> <span class="n">depth</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">max_depth</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">limits</span><span class="o">.</span><span class="n">max_zip_depth</span><span class="p">:</span>
            <span class="n">threats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Excessive directory depth: </span><span class="si">{</span><span class="n">max_depth</span><span class="si">}</span><span class="s2"> (max: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">limits</span><span class="o">.</span><span class="n">max_zip_depth</span><span class="si">}</span><span class="s2">)&quot;</span>
            <span class="p">)</span>

        <span class="c1"># Check for suspicious file distribution</span>
        <span class="n">file_types</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entries</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">entry</span><span class="o">.</span><span class="n">is_dir</span><span class="p">():</span>
                <span class="n">ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">filename</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                <span class="n">file_types</span><span class="p">[</span><span class="n">ext</span><span class="p">]</span> <span class="o">=</span> <span class="n">file_types</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ext</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="c1"># Check for excessive number of same-type files (potential spam/bomb)</span>
        <span class="k">for</span> <span class="n">ext</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">file_types</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">count</span> <span class="o">&gt;</span> <span class="mi">1000</span><span class="p">:</span>  <span class="c1"># More than 1000 files of same type</span>
                <span class="n">threats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Excessive number of </span><span class="si">{</span><span class="n">ext</span><span class="si">}</span><span class="s2"> files: </span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">threats</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_has_directory_traversal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check for directory traversal indicators.</span>

<span class="sd">        Args:</span>
<span class="sd">            filename: Filename to check.</span>

<span class="sd">        Returns:</span>
<span class="sd">            True if traversal detected.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">filename_lower</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">category</span> <span class="ow">in</span> <span class="n">SuspiciousFilePattern</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">category</span> <span class="o">==</span> <span class="n">SuspiciousFilePattern</span><span class="o">.</span><span class="n">DIRECTORY_TRAVERSAL</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="n">category</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">pattern</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">filename_lower</span><span class="p">:</span>
                        <span class="k">return</span> <span class="kc">True</span>

        <span class="c1"># Additional checks for normalized paths</span>
        <span class="n">normalized</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">normalized</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;..&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="s2">&quot;/..&quot;</span> <span class="ow">in</span> <span class="n">normalized</span> <span class="ow">or</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">..&quot;</span> <span class="ow">in</span> <span class="n">normalized</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_has_absolute_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check if filename is an absolute path.</span>

<span class="sd">        Args:</span>
<span class="sd">            filename: Path to check.</span>

<span class="sd">        Returns:</span>
<span class="sd">            True if absolute path detected.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="n">filename</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>  <span class="c1"># Unix absolute path</span>
            <span class="ow">or</span> <span class="n">filename</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">)</span>  <span class="c1"># Windows UNC path</span>
            <span class="ow">or</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">filename</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;:&quot;</span><span class="p">)</span>  <span class="c1"># Windows drive path</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_is_symlink</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entry</span><span class="p">:</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipInfo</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check if entry is a symbolic link.</span>

<span class="sd">        Args:</span>
<span class="sd">            entry: ZIP entry to check.</span>

<span class="sd">        Returns:</span>
<span class="sd">            True if entry is a symlink.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Check if entry has symlink attributes</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">external_attr</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mo">0o120000</span> <span class="o">==</span> <span class="mo">0o120000</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_check_suspicious_patterns</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check filename for suspicious patterns.</span>

<span class="sd">        Args:</span>
<span class="sd">            filename: Filename to check.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of pattern warnings.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">threats</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">filename_lower</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">basename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">filename_lower</span><span class="p">)</span>

        <span class="c1"># Check suspicious names</span>
        <span class="k">for</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="n">SuspiciousFilePattern</span><span class="o">.</span><span class="n">SUSPICIOUS_NAMES</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">basename</span> <span class="o">==</span> <span class="n">pattern</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                <span class="n">threats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Suspicious filename pattern: &#39;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
                <span class="k">break</span>

        <span class="c1"># Check suspicious path components</span>
        <span class="k">for</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="n">SuspiciousFilePattern</span><span class="o">.</span><span class="n">SUSPICIOUS_PATHS</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">pattern</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">filename_lower</span><span class="p">:</span>
                <span class="n">threats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Suspicious path component: &#39;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&#39; contains &#39;</span><span class="si">{</span><span class="n">pattern</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
                <span class="p">)</span>
                <span class="k">break</span>

        <span class="k">return</span> <span class="n">threats</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_is_nested_archive</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check if filename represents a nested archive.</span>

<span class="sd">        Args:</span>
<span class="sd">            filename: Filename to check.</span>

<span class="sd">        Returns:</span>
<span class="sd">            True if nested archive detected.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">filename</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">category</span> <span class="ow">in</span> <span class="n">ZipThreatCategory</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">category</span> <span class="o">==</span> <span class="n">ZipThreatCategory</span><span class="o">.</span><span class="n">NESTED_ARCHIVES</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">ext</span> <span class="ow">in</span> <span class="n">category</span><span class="o">.</span><span class="n">value</span>

        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_inspect_entry_content</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">entry</span><span class="p">:</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipInfo</span><span class="p">,</span> <span class="n">zip_file</span><span class="p">:</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Inspect ZIP entry content for malicious signatures.</span>

<span class="sd">        Args:</span>
<span class="sd">            entry: ZIP entry to inspect.</span>
<span class="sd">            zip_file: Parent ZIP archive.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of content threat descriptions.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">threats</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Read first few bytes to check for executable signatures</span>
            <span class="k">with</span> <span class="n">zip_file</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                <span class="n">content_sample</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">512</span><span class="p">)</span>  <span class="c1"># Read first 512 bytes</span>

                <span class="c1"># Check for executable signatures</span>
                <span class="k">for</span> <span class="n">signature</span> <span class="ow">in</span> <span class="n">SuspiciousFilePattern</span><span class="o">.</span><span class="n">EXECUTABLE_SIGNATURES</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">content_sample</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">signature</span><span class="p">):</span>
                        <span class="n">threats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;Executable content detected in &#39;</span><span class="si">{</span><span class="n">entry</span><span class="o">.</span><span class="n">filename</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
                        <span class="p">)</span>
                        <span class="k">break</span>

                <span class="c1"># Check for script content patterns</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_contains_script_patterns</span><span class="p">(</span><span class="n">content_sample</span><span class="p">,</span> <span class="n">entry</span><span class="o">.</span><span class="n">filename</span><span class="p">):</span>
                    <span class="n">threats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Script content detected in &#39;</span><span class="si">{</span><span class="n">entry</span><span class="o">.</span><span class="n">filename</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">&quot;Could not inspect content of &#39;</span><span class="si">%s</span><span class="s2">&#39;: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">entry</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span>
                <span class="n">err</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">threats</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_contains_script_patterns</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">content</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check content for malicious script patterns.</span>

<span class="sd">        Args:</span>
<span class="sd">            content: Raw bytes to inspect.</span>
<span class="sd">            filename: Filename for context.</span>

<span class="sd">        Returns:</span>
<span class="sd">            True if script patterns found.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Try to decode as text</span>
            <span class="n">text_content</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

            <span class="c1"># Check for common script patterns</span>
            <span class="n">script_patterns</span> <span class="o">=</span> <span class="p">[</span>
                <span class="s2">&quot;#!/bin/&quot;</span><span class="p">,</span>
                <span class="s2">&quot;#!/usr/bin/&quot;</span><span class="p">,</span>
                <span class="s2">&quot;powershell&quot;</span><span class="p">,</span>
                <span class="s2">&quot;cmd.exe&quot;</span><span class="p">,</span>
                <span class="s2">&quot;eval(&quot;</span><span class="p">,</span>
                <span class="s2">&quot;exec(&quot;</span><span class="p">,</span>
                <span class="s2">&quot;system(&quot;</span><span class="p">,</span>
                <span class="s2">&quot;shell_exec(&quot;</span><span class="p">,</span>
                <span class="s2">&quot;&lt;script&quot;</span><span class="p">,</span>
                <span class="s2">&quot;&lt;?php&quot;</span><span class="p">,</span>
                <span class="s2">&quot;&lt;%&quot;</span><span class="p">,</span>
                <span class="s2">&quot;import os&quot;</span><span class="p">,</span>
                <span class="s2">&quot;import subprocess&quot;</span><span class="p">,</span>
            <span class="p">]</span>

            <span class="k">for</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="n">script_patterns</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="n">text_content</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">True</span>

        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="c1"># If we can&#39;t decode as text, it&#39;s probably binary</span>
            <span class="k">pass</span>

        <span class="k">return</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="safeuploads.ZipContentInspector.__init__" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">__init__</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">__init__</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Initialize ZIP inspector with configuration.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>config</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="FileSecurityConfig (safeuploads.config.FileSecurityConfig)" href="#safeuploads.FileSecurityConfig">FileSecurityConfig</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>File security configuration.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>safeuploads/inspectors/zip_inspector.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">FileSecurityConfig</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Initialize ZIP inspector with configuration.</span>

<span class="sd">    Args:</span>
<span class="sd">        config: File security configuration.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">config</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="safeuploads.ZipContentInspector.inspect_zip_content" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">inspect_zip_content</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">inspect_zip_content</span><span class="p">(</span><span class="n">file_content</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Inspect ZIP archive for potential security threats.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>file_content</code>
            </td>
            <td>
                  <code><span title="bytes">bytes</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Raw bytes of ZIP archive.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="ZipContentError (safeuploads.exceptions.ZipContentError)" href="#safeuploads.ZipContentError">ZipContentError</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If security threats are detected in ZIP
content such as directory traversal, symlinks, nested
archives, or suspicious patterns.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="FileProcessingError (safeuploads.exceptions.FileProcessingError)" href="#safeuploads.FileProcessingError">FileProcessingError</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If ZIP structure is invalid or
unexpected error occurs during inspection.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>safeuploads/inspectors/zip_inspector.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">inspect_zip_content</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_content</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Inspect ZIP archive for potential security threats.</span>

<span class="sd">    Args:</span>
<span class="sd">        file_content: Raw bytes of ZIP archive.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ZipContentError: If security threats are detected in ZIP</span>
<span class="sd">            content such as directory traversal, symlinks, nested</span>
<span class="sd">            archives, or suspicious patterns.</span>
<span class="sd">        FileProcessingError: If ZIP structure is invalid or</span>
<span class="sd">            unexpected error occurs during inspection.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">zip_bytes</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">file_content</span><span class="p">)</span>
        <span class="n">threats_found</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Start analysis timer</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

        <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">zip_bytes</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zip_file</span><span class="p">:</span>
            <span class="n">zip_entries</span> <span class="o">=</span> <span class="n">zip_file</span><span class="o">.</span><span class="n">infolist</span><span class="p">()</span>

            <span class="c1"># Analyze each entry in the ZIP</span>
            <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">zip_entries</span><span class="p">:</span>
                <span class="c1"># Check for timeout</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>
                    <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">limits</span><span class="o">.</span><span class="n">zip_analysis_timeout</span>
                <span class="p">):</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                        <span class="s2">&quot;ZIP content inspection timeout&quot;</span><span class="p">,</span>
                        <span class="n">extra</span><span class="o">=</span><span class="p">{</span>
                            <span class="s2">&quot;error_type&quot;</span><span class="p">:</span> <span class="s2">&quot;zip_analysis_timeout&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;timeout&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">limits</span><span class="o">.</span><span class="n">zip_analysis_timeout</span><span class="p">,</span>
                        <span class="p">},</span>
                    <span class="p">)</span>
                    <span class="k">raise</span> <span class="n">ZipContentError</span><span class="p">(</span>
                        <span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;ZIP content inspection timeout after </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">limits</span><span class="o">.</span><span class="n">zip_analysis_timeout</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">,</span>
                        <span class="n">threats</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Analysis timeout - potential zip bomb&quot;</span><span class="p">],</span>
                        <span class="n">error_code</span><span class="o">=</span><span class="n">ErrorCode</span><span class="o">.</span><span class="n">ZIP_ANALYSIS_TIMEOUT</span><span class="p">,</span>
                    <span class="p">)</span>

                <span class="c1"># Inspect individual entry</span>
                <span class="n">entry_threats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inspect_zip_entry</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">zip_file</span><span class="p">)</span>
                <span class="n">threats_found</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">entry_threats</span><span class="p">)</span>

            <span class="c1"># Check for ZIP structure threats</span>
            <span class="n">structure_threats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inspect_zip_structure</span><span class="p">(</span><span class="n">zip_entries</span><span class="p">)</span>
            <span class="n">threats_found</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">structure_threats</span><span class="p">)</span>

            <span class="c1"># Return results</span>
            <span class="k">if</span> <span class="n">threats_found</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="s2">&quot;ZIP content threats detected&quot;</span><span class="p">,</span>
                    <span class="n">extra</span><span class="o">=</span><span class="p">{</span>
                        <span class="s2">&quot;error_type&quot;</span><span class="p">:</span> <span class="s2">&quot;zip_content_threat&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;threats&quot;</span><span class="p">:</span> <span class="n">threats_found</span><span class="p">,</span>
                        <span class="s2">&quot;threat_count&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">threats_found</span><span class="p">),</span>
                    <span class="p">},</span>
                <span class="p">)</span>
                <span class="k">raise</span> <span class="n">ZipContentError</span><span class="p">(</span>
                    <span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;ZIP content threats detected: </span><span class="si">{</span><span class="s1">&#39;; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">threats_found</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="n">threats</span><span class="o">=</span><span class="n">threats_found</span><span class="p">,</span>
                <span class="p">)</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                <span class="s2">&quot;ZIP content inspection passed: </span><span class="si">%s</span><span class="s2"> entries analyzed&quot;</span><span class="p">,</span>
                <span class="nb">len</span><span class="p">(</span><span class="n">zip_entries</span><span class="p">),</span>
            <span class="p">)</span>

    <span class="k">except</span> <span class="n">ZipContentError</span><span class="p">:</span>
        <span class="c1"># Re-raise our own exceptions</span>
        <span class="k">raise</span>
    <span class="k">except</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">BadZipFile</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Invalid or corrupted ZIP file structure&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">FileProcessingError</span><span class="p">(</span>
            <span class="n">message</span><span class="o">=</span><span class="s2">&quot;Invalid or corrupted ZIP file structure&quot;</span><span class="p">,</span>
            <span class="n">original_error</span><span class="o">=</span><span class="n">err</span><span class="p">,</span>
        <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">err</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
            <span class="s2">&quot;Unexpected error during ZIP content inspection&quot;</span><span class="p">,</span>
            <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">raise</span> <span class="n">FileProcessingError</span><span class="p">(</span>
            <span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;ZIP content inspection failed: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">original_error</span><span class="o">=</span><span class="n">err</span><span class="p">,</span>
        <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">err</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="safeuploads.ZipThreatCategory" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">ZipThreatCategory</span>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="enum.Enum">Enum</span></code></p>


        <p>Categories of potentially harmful contents within ZIP archives.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="safeuploads.ZipThreatCategory.NESTED_ARCHIVES">NESTED_ARCHIVES</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Archive format threats.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="safeuploads.ZipThreatCategory.EXECUTABLE_FILES">EXECUTABLE_FILES</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Executable content threats.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="safeuploads.ZipThreatCategory.SCRIPT_FILES">SCRIPT_FILES</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Script and code threats.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="safeuploads.ZipThreatCategory.SYSTEM_FILES">SYSTEM_FILES</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>System and configuration threats.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="quote">
                <summary>Source code in <code>safeuploads/enums.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ZipThreatCategory</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Categories of potentially harmful contents within ZIP archives.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        NESTED_ARCHIVES: Archive format threats.</span>
<span class="sd">        EXECUTABLE_FILES: Executable content threats.</span>
<span class="sd">        SCRIPT_FILES: Script and code threats.</span>
<span class="sd">        SYSTEM_FILES: System and configuration threats.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Archive format threats</span>
    <span class="n">NESTED_ARCHIVES</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;.zip&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.rar&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.7z&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.tar&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.gz&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.bz2&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.xz&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.tar.gz&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.tar.bz2&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.tar.xz&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.tgz&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.tbz2&quot;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="c1"># Executable content threats</span>
    <span class="n">EXECUTABLE_FILES</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;.exe&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.com&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.bat&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.cmd&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.scr&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.pif&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.bin&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.run&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.app&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.deb&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.rpm&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.msi&quot;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="c1"># Script and code threats</span>
    <span class="n">SCRIPT_FILES</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;.js&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.vbs&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.ps1&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.sh&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.bash&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.py&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.php&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.pl&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.rb&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.lua&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.asp&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.jsp&quot;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="c1"># System and configuration threats</span>
    <span class="n">SYSTEM_FILES</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;.dll&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.so&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.dylib&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.sys&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.drv&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.inf&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.reg&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.cfg&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.conf&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.ini&quot;</span><span class="p">,</span>
    <span class="p">}</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>




  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
    
  </body>
</html>